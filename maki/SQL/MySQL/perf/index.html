<!doctype html><html class=no-js lang=en><meta charset=utf-8><meta content="width=device-width,initial-scale=1" name=viewport><link href=https://seanslma.github.io/maki/SQL/MySQL/perf/ rel=canonical><link href=../partition/ rel=prev><link href=../procedure/ rel=next><link href=../../../assets/images/favicon.png rel=icon><meta content="mkdocs-1.6.1, mkdocs-material-9.6.15" name=generator><title>perf - maki</title><link href=../../../assets/stylesheets/main.342714a4.min.css rel=stylesheet><link href=../../../assets/stylesheets/palette.06af60db.min.css rel=stylesheet><link crossorigin href=https://fonts.gstatic.com rel=preconnect><link href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback" rel=stylesheet><style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style><link href=../../../stylesheets/extra.css rel=stylesheet><script>__md_scope=new URL(`../../..`,location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+`.`+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+`.`+e,JSON.stringify(_))}catch{}};</script><body data-md-color-accent=indigo data-md-color-primary=indigo data-md-color-scheme=default dir=ltr><input autocomplete=off class=md-toggle data-md-toggle=drawer id=__drawer type=checkbox><input autocomplete=off class=md-toggle data-md-toggle=search id=__search type=checkbox><label class=md-overlay for=__drawer></label><div data-md-component=skip><a class=md-skip href=#perf> Skip to content </a></div><div data-md-component=announce></div><header class=md-header data-md-component=header><nav class="md-header__inner md-grid" aria-label=Header><a class="md-header__button md-logo" aria-label=maki data-md-component=logo href=../../.. title=maki> <svg viewbox="0 0 24 24" xmlns=http://www.w3.org/2000/svg><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg> </a><label class="md-header__button md-icon" for=__drawer><svg viewbox="0 0 24 24" xmlns=http://www.w3.org/2000/svg><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg></label><div class=md-header__title data-md-component=header-title><div class=md-header__ellipsis><div class=md-header__topic><span class=md-ellipsis> maki </span></div><div class=md-header__topic data-md-component=header-topic><span class=md-ellipsis> perf </span></div></div></div><form class=md-header__option data-md-component=palette><input aria-label="Switch to dark mode" class=md-option data-md-color-accent=indigo data-md-color-media data-md-color-primary=indigo data-md-color-scheme=default id=__palette_0 name=__palette type=radio><label class="md-header__button md-icon" title="Switch to dark mode" for=__palette_1 hidden><svg viewbox="0 0 24 24" xmlns=http://www.w3.org/2000/svg><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg></label><input aria-label="Switch to light mode" class=md-option data-md-color-accent=indigo data-md-color-media data-md-color-primary=indigo data-md-color-scheme=slate id=__palette_1 name=__palette type=radio><label class="md-header__button md-icon" title="Switch to light mode" for=__palette_0 hidden><svg viewbox="0 0 24 24" xmlns=http://www.w3.org/2000/svg><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12s-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg></label></form><script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script><label class="md-header__button md-icon" for=__search><svg viewbox="0 0 24 24" xmlns=http://www.w3.org/2000/svg><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg></label><div class=md-search data-md-component=search role=dialog><label class=md-search__overlay for=__search></label><div class=md-search__inner role=search><form class=md-search__form name=search><input aria-label=Search autocapitalize=off autocomplete=off autocorrect=off class=md-search__input data-md-component=search-query name=query placeholder=Search required spellcheck=false><label class="md-search__icon md-icon" for=__search><svg viewbox="0 0 24 24" xmlns=http://www.w3.org/2000/svg><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg> <svg viewbox="0 0 24 24" xmlns=http://www.w3.org/2000/svg><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg></label><nav aria-label=Search class=md-search__options><button class="md-search__icon md-icon" aria-label=Clear tabindex=-1 title=Clear type=reset><svg viewbox="0 0 24 24" xmlns=http://www.w3.org/2000/svg><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg></button></nav><div class=md-search__suggest data-md-component=search-suggest></div></form><div class=md-search__output><div class=md-search__scrollwrap data-md-scrollfix tabindex=0><div class=md-search-result data-md-component=search-result><div class=md-search-result__meta>Initializing search</div><ol class=md-search-result__list role=presentation></ol></div></div></div></div></div><div class=md-header__source><a title="Go to repository" class=md-source data-md-component=source href=https://github.com/seanslma/maki> <div class="md-source__icon md-icon"><svg viewbox="0 0 448 512" xmlns=http://www.w3.org/2000/svg><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"/></svg></div> <div class=md-source__repository>GitHub</div> </a></div></nav></header><div class=md-container data-md-component=container><nav aria-label=Tabs class=md-tabs data-md-component=tabs><div class=md-grid><ul class=md-tabs__list><li class=md-tabs__item><a class=md-tabs__link href=../../..> About </a><li class=md-tabs__item><a class=md-tabs__link href=../../../AI/ChatGPT/> AI </a><li class=md-tabs__item><a class=md-tabs__link href=../../../AWS/CDN/> AWS </a><li class=md-tabs__item><a class=md-tabs__link href=../../../Azure/Advisor/> Azure </a><li class=md-tabs__item><a class=md-tabs__link href=../../../Coding/Notepad%2B%2B/> Coding </a><li class=md-tabs__item><a class=md-tabs__link href=../../../Cybersecurity/Cybersecurity/> Cybersecurity </a><li class=md-tabs__item><a class=md-tabs__link href=../../../Data/Data/> Data </a><li class=md-tabs__item><a class=md-tabs__link href=../../../DevOps/DevOps/> DevOps </a><li class=md-tabs__item><a class=md-tabs__link href=../../../Documentation/Jira/> Documentation </a><li class=md-tabs__item><a class=md-tabs__link href=../../../Energy/Inertia/> Energy </a><li class=md-tabs__item><a class=md-tabs__link href=../../../Learn/Book/> Learn </a><li class=md-tabs__item><a class=md-tabs__link href=../../../ML/Backtest/> ML </a><li class=md-tabs__item><a class=md-tabs__link href=../../../Optimizaton/Convex/> Optimizaton </a><li class=md-tabs__item><a class=md-tabs__link href=../../../PowerBI/Basic/> PowerBI </a><li class=md-tabs__item><a class=md-tabs__link href=../../../Python/NAN/> Python </a><li class="md-tabs__item md-tabs__item--active"><a class=md-tabs__link href=../../Database/> SQL </a><li class=md-tabs__item><a class=md-tabs__link href=../../../System/Behavior/> System </a></ul></div></nav><main class=md-main data-md-component=main><div class="md-main__inner md-grid"><div class="md-sidebar md-sidebar--primary" data-md-component=sidebar data-md-type=navigation><div class=md-sidebar__scrollwrap><div class=md-sidebar__inner><nav class="md-nav md-nav--primary md-nav--lifted" aria-label=Navigation data-md-level=0><label class=md-nav__title for=__drawer><a class="md-nav__button md-logo" aria-label=maki data-md-component=logo href=../../.. title=maki> <svg viewbox="0 0 24 24" xmlns=http://www.w3.org/2000/svg><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg> </a> maki</label><div class=md-nav__source><a title="Go to repository" class=md-source data-md-component=source href=https://github.com/seanslma/maki> <div class="md-source__icon md-icon"><svg viewbox="0 0 448 512" xmlns=http://www.w3.org/2000/svg><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"/></svg></div> <div class=md-source__repository>GitHub</div> </a></div><ul class=md-nav__list data-md-scrollfix><li class=md-nav__item><a class=md-nav__link href=../../..> <span class=md-ellipsis> About </span> </a><li class="md-nav__item md-nav__item--pruned md-nav__item--nested"><a class=md-nav__link href=../../../AI/ChatGPT/> <span class=md-ellipsis> AI </span> <span class="md-nav__icon md-icon"></span> </a><li class="md-nav__item md-nav__item--pruned md-nav__item--nested"><a class=md-nav__link href=../../../AWS/CDN/> <span class=md-ellipsis> AWS </span> <span class="md-nav__icon md-icon"></span> </a><li class="md-nav__item md-nav__item--pruned md-nav__item--nested"><a class=md-nav__link href=../../../Azure/Advisor/> <span class=md-ellipsis> Azure </span> <span class="md-nav__icon md-icon"></span> </a><li class="md-nav__item md-nav__item--pruned md-nav__item--nested"><a class=md-nav__link href=../../../Coding/Notepad%2B%2B/> <span class=md-ellipsis> Coding </span> <span class="md-nav__icon md-icon"></span> </a><li class="md-nav__item md-nav__item--pruned md-nav__item--nested"><a class=md-nav__link href=../../../Cybersecurity/Cybersecurity/> <span class=md-ellipsis> Cybersecurity </span> <span class="md-nav__icon md-icon"></span> </a><li class="md-nav__item md-nav__item--pruned md-nav__item--nested"><a class=md-nav__link href=../../../Data/Data/> <span class=md-ellipsis> Data </span> <span class="md-nav__icon md-icon"></span> </a><li class="md-nav__item md-nav__item--pruned md-nav__item--nested"><a class=md-nav__link href=../../../DevOps/DevOps/> <span class=md-ellipsis> DevOps </span> <span class="md-nav__icon md-icon"></span> </a><li class="md-nav__item md-nav__item--pruned md-nav__item--nested"><a class=md-nav__link href=../../../Documentation/Jira/> <span class=md-ellipsis> Documentation </span> <span class="md-nav__icon md-icon"></span> </a><li class="md-nav__item md-nav__item--pruned md-nav__item--nested"><a class=md-nav__link href=../../../Energy/Inertia/> <span class=md-ellipsis> Energy </span> <span class="md-nav__icon md-icon"></span> </a><li class="md-nav__item md-nav__item--pruned md-nav__item--nested"><a class=md-nav__link href=../../../Learn/Book/> <span class=md-ellipsis> Learn </span> <span class="md-nav__icon md-icon"></span> </a><li class="md-nav__item md-nav__item--pruned md-nav__item--nested"><a class=md-nav__link href=../../../ML/Backtest/> <span class=md-ellipsis> ML </span> <span class="md-nav__icon md-icon"></span> </a><li class="md-nav__item md-nav__item--pruned md-nav__item--nested"><a class=md-nav__link href=../../../Optimizaton/Convex/> <span class=md-ellipsis> Optimizaton </span> <span class="md-nav__icon md-icon"></span> </a><li class="md-nav__item md-nav__item--pruned md-nav__item--nested"><a class=md-nav__link href=../../../PowerBI/Basic/> <span class=md-ellipsis> PowerBI </span> <span class="md-nav__icon md-icon"></span> </a><li class="md-nav__item md-nav__item--pruned md-nav__item--nested"><a class=md-nav__link href=../../../Python/NAN/> <span class=md-ellipsis> Python </span> <span class="md-nav__icon md-icon"></span> </a><li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested"><input class="md-nav__toggle md-toggle" checked id=__nav_16 type=checkbox> <label class=md-nav__link for=__nav_16 id=__nav_16_label><span class=md-ellipsis> SQL </span> <span class="md-nav__icon md-icon"></span></label> <nav aria-expanded=true aria-labelledby=__nav_16_label class=md-nav data-md-level=1><label class=md-nav__title for=__nav_16><span class="md-nav__icon md-icon"></span> SQL</label><ul class=md-nav__list data-md-scrollfix><li class=md-nav__item><a class=md-nav__link href=../../Database/> <span class=md-ellipsis> Database </span> </a><li class=md-nav__item><a class=md-nav__link href=../../Test/> <span class=md-ellipsis> Test </span> </a><li class="md-nav__item md-nav__item--pruned md-nav__item--nested"><a class=md-nav__link href=../../Access/cs/> <span class=md-ellipsis> Access </span> <span class="md-nav__icon md-icon"></span> </a><li class="md-nav__item md-nav__item--pruned md-nav__item--nested"><a class=md-nav__link href=../../DuckDB/Datetime/> <span class=md-ellipsis> DuckDB </span> <span class="md-nav__icon md-icon"></span> </a><li class="md-nav__item md-nav__item--pruned md-nav__item--nested"><a class=md-nav__link href=../../IoTDB/Cluster/> <span class=md-ellipsis> IoTDB </span> <span class="md-nav__icon md-icon"></span> </a><li class="md-nav__item md-nav__item--pruned md-nav__item--nested"><a class=md-nav__link href=../../MSSQL/ANSI_NULLS/> <span class=md-ellipsis> MSSQL </span> <span class="md-nav__icon md-icon"></span> </a><li class="md-nav__item md-nav__item--pruned md-nav__item--nested"><a class=md-nav__link href=../../MongoDB/Sharding/> <span class=md-ellipsis> MongoDB </span> <span class="md-nav__icon md-icon"></span> </a><li class="md-nav__item md-nav__item--active md-nav__item--nested"><input class="md-nav__toggle md-toggle" checked id=__nav_16_8 type=checkbox> <label class=md-nav__link for=__nav_16_8 id=__nav_16_8_label tabindex=0><span class=md-ellipsis> MySQL </span> <span class="md-nav__icon md-icon"></span></label> <nav aria-expanded=true aria-labelledby=__nav_16_8_label class=md-nav data-md-level=2><label class=md-nav__title for=__nav_16_8><span class="md-nav__icon md-icon"></span> MySQL</label><ul class=md-nav__list data-md-scrollfix><li class=md-nav__item><a class=md-nav__link href=../InnoDB/> <span class=md-ellipsis> InnoDB </span> </a><li class=md-nav__item><a class=md-nav__link href=../PerconaToolkit/> <span class=md-ellipsis> percona-toolkit </span> </a><li class=md-nav__item><a class=md-nav__link href=../adm/> <span class=md-ellipsis> Admin </span> </a><li class=md-nav__item><a class=md-nav__link href=../alter/> <span class=md-ellipsis> alter table </span> </a><li class=md-nav__item><a class=md-nav__link href=../backup/> <span class=md-ellipsis> backup </span> </a><li class=md-nav__item><a class=md-nav__link href=../bakcode/> <span class=md-ellipsis> backup code </span> </a><li class=md-nav__item><a class=md-nav__link href=../basic/> <span class=md-ellipsis> Basic </span> </a><li class=md-nav__item><a class=md-nav__link href=../deadlock/> <span class=md-ellipsis> Deadlock </span> </a><li class=md-nav__item><a class=md-nav__link href=../err/> <span class=md-ellipsis> error </span> </a><li class=md-nav__item><a class=md-nav__link href=../group/> <span class=md-ellipsis> group </span> </a><li class=md-nav__item><a class=md-nav__link href=../io/> <span class=md-ellipsis> IO </span> </a><li class=md-nav__item><a class=md-nav__link href=../keyrepair/> <span class=md-ellipsis> key repair </span> </a><li class=md-nav__item><a class=md-nav__link href=../mem/> <span class=md-ellipsis> memory </span> </a><li class=md-nav__item><a class=md-nav__link href=../myisam2innodb/> <span class=md-ellipsis> MyISAM to InnoDB </span> </a><li class=md-nav__item><a class=md-nav__link href=../other/> <span class=md-ellipsis> other </span> </a><li class=md-nav__item><a class=md-nav__link href=../param/> <span class=md-ellipsis> param </span> </a><li class=md-nav__item><a class=md-nav__link href=../partition/> <span class=md-ellipsis> Partition </span> </a><li class="md-nav__item md-nav__item--active"><input class="md-nav__toggle md-toggle" id=__toc type=checkbox> <label class="md-nav__link md-nav__link--active" for=__toc><span class=md-ellipsis> perf </span> <span class="md-nav__icon md-icon"></span></label> <a class="md-nav__link md-nav__link--active" href=./> <span class=md-ellipsis> perf </span> </a> <nav aria-label="Table of contents" class="md-nav md-nav--secondary"><label class=md-nav__title for=__toc><span class="md-nav__icon md-icon"></span> Table of contents</label><ul class=md-nav__list data-md-component=toc data-md-scrollfix><li class=md-nav__item><a class=md-nav__link href=#show-slow-queries> <span class=md-ellipsis> show slow queries </span> </a><li class=md-nav__item><a class=md-nav__link href=#myisam-optimization> <span class=md-ellipsis> MyISAM optimization </span> </a> <nav aria-label="MyISAM optimization" class=md-nav><ul class=md-nav__list><li class=md-nav__item><a class=md-nav__link href=#key_buffer_size> <span class=md-ellipsis> key_buffer_size </span> </a></ul></nav><li class=md-nav__item><a class=md-nav__link href=#optimize-myisam-settings> <span class=md-ellipsis> optimize MyISAM settings </span> </a><li class=md-nav__item><a class=md-nav__link href=#myisam-2> <span class=md-ellipsis> MyISAM 2 </span> </a><li class=md-nav__item><a class=md-nav__link href=#optimize-innodb-settings> <span class=md-ellipsis> optimize InnoDB settings </span> </a><li class=md-nav__item><a class=md-nav__link href=#innodb-optimization-example> <span class=md-ellipsis> InnoDB optimization example </span> </a><li class=md-nav__item><a class=md-nav__link href=#limitations-of-the-mysql-query-optimizer> <span class=md-ellipsis> Limitations of the MySQL Query Optimizer </span> </a> <nav aria-label="Limitations of the MySQL Query Optimizer" class=md-nav><ul class=md-nav__list><li class=md-nav__item><a class=md-nav__link href=#correlated-subqueries> <span class=md-ellipsis> Correlated subqueries </span> </a><li class=md-nav__item><a class=md-nav__link href=#slow-limit-query> <span class=md-ellipsis> slow limit query </span> </a></ul></nav></ul></nav><li class=md-nav__item><a class=md-nav__link href=../procedure/> <span class=md-ellipsis> Procedure </span> </a><li class=md-nav__item><a class=md-nav__link href=../profile/> <span class=md-ellipsis> Profiling </span> </a><li class=md-nav__item><a class=md-nav__link href=../qry/> <span class=md-ellipsis> query </span> </a><li class=md-nav__item><a class=md-nav__link href=../shadding/> <span class=md-ellipsis> Shadding </span> </a><li class=md-nav__item><a class=md-nav__link href=../tip/> <span class=md-ellipsis> tip </span> </a><li class=md-nav__item><a class=md-nav__link href=../user/> <span class=md-ellipsis> user </span> </a></ul></nav><li class="md-nav__item md-nav__item--pruned md-nav__item--nested"><a class=md-nav__link href=../../Oracle/Admin/> <span class=md-ellipsis> Oracle </span> <span class="md-nav__icon md-icon"></span> </a><li class="md-nav__item md-nav__item--pruned md-nav__item--nested"><a class=md-nav__link href=../../PostgreSQL/Basic/> <span class=md-ellipsis> PostgreSQL </span> <span class="md-nav__icon md-icon"></span> </a><li class="md-nav__item md-nav__item--pruned md-nav__item--nested"><a class=md-nav__link href=../../Security/Encryption/> <span class=md-ellipsis> Security </span> <span class="md-nav__icon md-icon"></span> </a></ul></nav><li class="md-nav__item md-nav__item--pruned md-nav__item--nested"><a class=md-nav__link href=../../../System/Behavior/> <span class=md-ellipsis> System </span> <span class="md-nav__icon md-icon"></span> </a></ul></nav></div></div></div><div class="md-sidebar md-sidebar--secondary" data-md-component=sidebar data-md-type=toc><div class=md-sidebar__scrollwrap><div class=md-sidebar__inner><nav aria-label="Table of contents" class="md-nav md-nav--secondary"><label class=md-nav__title for=__toc><span class="md-nav__icon md-icon"></span> Table of contents</label><ul class=md-nav__list data-md-component=toc data-md-scrollfix><li class=md-nav__item><a class=md-nav__link href=#show-slow-queries> <span class=md-ellipsis> show slow queries </span> </a><li class=md-nav__item><a class=md-nav__link href=#myisam-optimization> <span class=md-ellipsis> MyISAM optimization </span> </a> <nav aria-label="MyISAM optimization" class=md-nav><ul class=md-nav__list><li class=md-nav__item><a class=md-nav__link href=#key_buffer_size> <span class=md-ellipsis> key_buffer_size </span> </a></ul></nav><li class=md-nav__item><a class=md-nav__link href=#optimize-myisam-settings> <span class=md-ellipsis> optimize MyISAM settings </span> </a><li class=md-nav__item><a class=md-nav__link href=#myisam-2> <span class=md-ellipsis> MyISAM 2 </span> </a><li class=md-nav__item><a class=md-nav__link href=#optimize-innodb-settings> <span class=md-ellipsis> optimize InnoDB settings </span> </a><li class=md-nav__item><a class=md-nav__link href=#innodb-optimization-example> <span class=md-ellipsis> InnoDB optimization example </span> </a><li class=md-nav__item><a class=md-nav__link href=#limitations-of-the-mysql-query-optimizer> <span class=md-ellipsis> Limitations of the MySQL Query Optimizer </span> </a> <nav aria-label="Limitations of the MySQL Query Optimizer" class=md-nav><ul class=md-nav__list><li class=md-nav__item><a class=md-nav__link href=#correlated-subqueries> <span class=md-ellipsis> Correlated subqueries </span> </a><li class=md-nav__item><a class=md-nav__link href=#slow-limit-query> <span class=md-ellipsis> slow limit query </span> </a></ul></nav></ul></nav></div></div></div><div class=md-content data-md-component=content><article class="md-content__inner md-typeset"><h1 id=perf>perf<a title="Permanent link" class=headerlink href=#perf>¶</a></h1><h2 id=show-slow-queries>show slow queries<a title="Permanent link" class=headerlink href=#show-slow-queries>¶</a></h2><div class=highlight><pre><span></span><code><a href=#__codelineno-0-1 id=__codelineno-0-1 name=__codelineno-0-1></a><span class=k>select</span><span class=w> </span><span class=n>start_time</span><span class=p>,</span><span class=w> </span><span class=n>time_to_sec</span><span class=p>(</span><span class=n>query_time</span><span class=p>)</span><span class=w> </span><span class=k>as</span><span class=w> </span><span class=n>qry_time_sec</span><span class=p>,</span><span class=w> </span>
<a href=#__codelineno-0-2 id=__codelineno-0-2 name=__codelineno-0-2></a><span class=w>       </span><span class=n>rows_sent</span><span class=p>,</span><span class=w> </span><span class=n>rows_examined</span><span class=p>,</span><span class=w> </span><span class=n>db</span><span class=p>,</span><span class=w> </span><span class=k>CONVERT</span><span class=p>(</span><span class=n>sql_text</span><span class=w> </span><span class=k>USING</span><span class=w> </span><span class=n>utf8</span><span class=p>)</span><span class=w> </span><span class=k>as</span><span class=w> </span><span class=n>qry_text</span>
<a href=#__codelineno-0-3 id=__codelineno-0-3 name=__codelineno-0-3></a><span class=k>from</span><span class=w> </span><span class=n>mysql</span><span class=p>.</span><span class=n>slow_log</span><span class=w> </span>
<a href=#__codelineno-0-4 id=__codelineno-0-4 name=__codelineno-0-4></a><span class=k>order</span><span class=w> </span><span class=k>by</span><span class=w> </span><span class=n>query_time</span><span class=w> </span><span class=k>desc</span><span class=p>;</span>
</code></pre></div><p>when use OPTIMIZE TABLE?<p>https://downloads.mysql.com/presentations/MySQL_Perfornance__Tuning_Overview_jp.pdf<p>http://porthos.ist.utl.pt/docs/mySQL/optimization.html#optimizing-myisam https://www.liquidweb.com/kb/mysql-performance-myisam/<h2 id=myisam-optimization>MyISAM optimization<a title="Permanent link" class=headerlink href=#myisam-optimization>¶</a></h2><h3 id=key_buffer_size>key_buffer_size<a title="Permanent link" class=headerlink href=#key_buffer_size>¶</a></h3><p>usually <strong>25%</strong> of the total RAM<div class=highlight><pre><span></span><code><a href=#__codelineno-1-1 id=__codelineno-1-1 name=__codelineno-1-1></a><span class=k>show</span><span class=w> </span><span class=n>status</span><span class=w> </span><span class=k>like</span><span class=w> </span><span class=s1>'key%'</span><span class=p>;</span>
<a href=#__codelineno-1-2 id=__codelineno-1-2 name=__codelineno-1-2></a>
<a href=#__codelineno-1-3 id=__codelineno-1-3 name=__codelineno-1-3></a><span class=k>show</span><span class=w> </span><span class=k>global</span><span class=w> </span><span class=n>variables</span><span class=w> </span><span class=k>like</span><span class=w> </span><span class=s1>'key%'</span><span class=p>;</span>
<a href=#__codelineno-1-4 id=__codelineno-1-4 name=__codelineno-1-4></a>
<a href=#__codelineno-1-5 id=__codelineno-1-5 name=__codelineno-1-5></a><span class=c1>--calc required key_buffer_size</span>
<a href=#__codelineno-1-6 id=__codelineno-1-6 name=__codelineno-1-6></a><span class=k>select</span><span class=w> </span><span class=k>count</span><span class=p>(</span><span class=n>INDEX_LENGTH</span><span class=p>)</span><span class=w> </span><span class=k>as</span><span class=w> </span><span class=n>Indexes</span><span class=p>,</span>
<a href=#__codelineno-1-7 id=__codelineno-1-7 name=__codelineno-1-7></a><span class=n>floor</span><span class=p>(</span><span class=k>sum</span><span class=p>(</span><span class=n>INDEX_LENGTH</span><span class=p>)</span><span class=o>/</span><span class=mi>1024</span><span class=o>/</span><span class=mi>1024</span><span class=p>)</span><span class=w> </span><span class=k>as</span><span class=w> </span><span class=n>Total_Index_Length_MB</span><span class=p>,</span>
<a href=#__codelineno-1-8 id=__codelineno-1-8 name=__codelineno-1-8></a><span class=n>floor</span><span class=p>(</span><span class=k>sum</span><span class=p>(</span><span class=n>INDEX_LENGTH</span><span class=p>)</span><span class=o>*</span><span class=p>(</span><span class=mi>1</span><span class=o>+</span><span class=mi>0</span><span class=p>.</span><span class=mi>05</span><span class=p>)</span><span class=o>/</span><span class=mi>1024</span><span class=o>/</span><span class=mi>1024</span><span class=p>)</span><span class=w> </span><span class=k>as</span><span class=w> </span><span class=n>key_buffer_size_MB</span>
<a href=#__codelineno-1-9 id=__codelineno-1-9 name=__codelineno-1-9></a><span class=k>FROM</span><span class=w> </span><span class=n>information_schema</span><span class=p>.</span><span class=n>TABLES</span><span class=w> </span><span class=k>WHERE</span><span class=w> </span><span class=n>ENGINE</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s1>'MyISAM'</span><span class=p>;</span>
<a href=#__codelineno-1-10 id=__codelineno-1-10 name=__codelineno-1-10></a>
<a href=#__codelineno-1-11 id=__codelineno-1-11 name=__codelineno-1-11></a><span class=k>SET</span><span class=w> </span><span class=k>GLOBAL</span><span class=w> </span><span class=n>key_buffer_size</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>1024</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=mi>1024</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=mi>1024</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=mi>2</span><span class=p>;</span>
<a href=#__codelineno-1-12 id=__codelineno-1-12 name=__codelineno-1-12></a>
<a href=#__codelineno-1-13 id=__codelineno-1-13 name=__codelineno-1-13></a><span class=c1>--Calculate Key Cache Usage Rate</span>
<a href=#__codelineno-1-14 id=__codelineno-1-14 name=__codelineno-1-14></a><span class=k>select</span><span class=w> </span><span class=n>VARIABLE_VALUE</span><span class=w> </span><span class=k>into</span><span class=w> </span><span class=o>@</span><span class=n>Key_blocks_unused</span><span class=w> </span>
<a href=#__codelineno-1-15 id=__codelineno-1-15 name=__codelineno-1-15></a><span class=k>FROM</span><span class=w> </span><span class=n>information_schema</span><span class=p>.</span><span class=n>global_status</span>
<a href=#__codelineno-1-16 id=__codelineno-1-16 name=__codelineno-1-16></a><span class=k>WHERE</span><span class=w> </span><span class=n>VARIABLE_NAME</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=ss>"Key_blocks_unused"</span><span class=p>;</span>
<a href=#__codelineno-1-17 id=__codelineno-1-17 name=__codelineno-1-17></a><span class=k>select</span><span class=w> </span><span class=o>@</span><span class=n>Key_blocks_unused</span><span class=w> </span><span class=k>as</span><span class=w> </span><span class=n>Key_blocks_unused</span><span class=p>,</span>
<a href=#__codelineno-1-18 id=__codelineno-1-18 name=__codelineno-1-18></a><span class=w>    </span><span class=o>@@</span><span class=n>key_cache_block_size</span><span class=w> </span><span class=k>as</span><span class=w> </span><span class=n>key_cache_block_size</span><span class=p>,</span>
<a href=#__codelineno-1-19 id=__codelineno-1-19 name=__codelineno-1-19></a><span class=w>    </span><span class=o>@@</span><span class=n>key_buffer_size</span><span class=w> </span><span class=k>as</span><span class=w> </span><span class=n>key_buffer_size</span><span class=err>\</span><span class=k>G</span>
<a href=#__codelineno-1-20 id=__codelineno-1-20 name=__codelineno-1-20></a><span class=k>select</span><span class=w> </span><span class=k>truncate</span><span class=p>((</span><span class=mi>1</span><span class=o>-</span><span class=p>((</span><span class=o>@</span><span class=n>Key_blocks_unused</span><span class=o>*@@</span><span class=n>key_cache_block_size</span><span class=p>)</span><span class=o>/@@</span><span class=n>key_buffer_size</span><span class=p>))</span><span class=o>*</span><span class=mi>100</span><span class=p>,</span><span class=w> </span><span class=mi>2</span><span class=p>)</span>
<a href=#__codelineno-1-21 id=__codelineno-1-21 name=__codelineno-1-21></a><span class=w>   </span><span class=k>as</span><span class=w> </span><span class=err>"</span><span class=p>(</span><span class=mi>1</span><span class=o>-</span><span class=p>((</span><span class=n>Key_blocks_unused</span><span class=w> </span><span class=err>×</span><span class=w> </span><span class=n>key_cache_block_size</span><span class=p>)</span><span class=w> </span><span class=o>/</span><span class=w> </span><span class=n>key_buffer_size</span><span class=p>))</span><span class=w> </span><span class=err>×</span><span class=w> </span><span class=mi>100</span><span class=p>;</span>
</code></pre></div><h2 id=optimize-myisam-settings>optimize MyISAM settings<a title="Permanent link" class=headerlink href=#optimize-myisam-settings>¶</a></h2><p>DISABLE KEYS / ENABLE KEYS only works for MyISAM<p><strong>read_rnd_buffer_size</strong> will affect query performance with sorted operations. As it is created per connection it is best to set it temporally<p><strong>key_buffer_size</strong> [affects exporting performance] is for MyISAM. Default size 8 MB. You can increase the value to get better index handling for all reads and multiple writes; on a system whose primary function is to run MySQL using the MyISAM storage engine, <strong>25%</strong> of the machine's total memory is an acceptable value for this variable. Tune this to at least <strong>30%</strong> of your RAM or the re-indexing process will probably be too slow. However, if you make the value too large (for example, more than 50% of the machine's total memory), your system might start to page and become extremely slow.<p>check the usage of the buff: SHOW STATUS LIKE 'Key%';<p><strong>Key Cache Usage Rate</strong>: 1-(key_blocks_unused * key_cache_block_size / key_buffer_size)\ This measures the percentage of the Key Cache that is filled, a helpful detail when determining if the key_buffer_size is large enough or if memory is being wasted.<p><strong>Key Cache Miss Rate</strong>: key_reads / key_read_requests\ This shows how often items that could be in the Key Cache are being read from a physical disk.<p><strong>Key Cache Flush Rate</strong>: key_writes / key_write_requests\ This value measures how frequently the Key Cache is written to disk. Frequent flushing can slow down MyISAM operations as writing data to a physical disk is much slower than writing to the Key Cache in memory.<p>also consider to change '<strong>bulk_insert_buffer_size</strong>' [affects importing performance] to at least 32M: SET GLOBAL bulk_insert_buffer_size = 1024 * 1024 * 256; SET bulk_insert_buffer_size = 1024 * 1024 * 256;<p>show global variables like 'bulk_insert%'; show variables like 'bulk_insert%';<h2 id=myisam-2>MyISAM 2<a title="Permanent link" class=headerlink href=#myisam-2>¶</a></h2><p>For MyIsam i have some recommendations as<p>key_buffer_size Size of the Key Buffer, used to cache index blocks for MyISAM tables. Do not set it larger than 30% of your available memory, as some memory is also required by the OS to cache rows. Even if you're not using MyISAM tables, you should still set it to 8-64M as it will also be used for internal temporary disk tables.So You should set it from 2GB to 3GB.<p>read_buffer_size Size of the buffer used for doing full table scans of MyISAM tables. Allocated per thread, if a full scan is needed..You should set it to 8MB to 16MB .<p>read_rnd_buffer_size When reading rows in sorted order after a sort, the rows are read through this buffer to avoid disk seeks. You can improve ORDER BY performance a lot, if set this to a high value. Allocated per thread, when needed.<p>bulk_insert_buffer_size MyISAM uses special tree-like cache to make bulk inserts (that is, INSERT ... SELECT, INSERT ... VALUES (...), (...), ..., and LOAD DATA INFILE) faster. This variable limits the size of the cache tree in bytes per thread. Setting it to 0 will disable this optimisation. Do not set it larger than "key_buffer_size" for optimal performance. This buffer is allocated when a bulk insert is detected.Set it to 512 MB to 1GB.<p>myisam_sort_buffer_size This buffer is allocated when MySQL needs to rebuild the index in REPAIR, OPTIMIZE, ALTER table statements as well as in LOAD DATA INFILE into an empty table. It is allocated per thread so be careful with large settings.So You should set it to 2M<p>myisam_max_sort_file_size The maximum size of the temporary file MySQL is allowed to use while recreating the index (during REPAIR, ALTER TABLE or LOAD DATA INFILE. If the file-size would be bigger than this, the index will be created through the key cache (which is slower).Set it to as you need.<p>myisam_repair_threads If a table has more than one index, MyISAM can use more than one thread to repair them by sorting in parallel. This makes sense if you have multiple CPUs and plenty of memory.Set it to 1.<p>myisam_recover Automatically check and repair not properly closed MyISAM tables.<h2 id=optimize-innodb-settings>optimize InnoDB settings<a title="Permanent link" class=headerlink href=#optimize-innodb-settings>¶</a></h2><p>For Innodb we need to diable unique_checks and foreign_key_checks using<div class=highlight><pre><span></span><code><a href=#__codelineno-2-1 id=__codelineno-2-1 name=__codelineno-2-1></a>set unique_checks=0; set foreign_key_checks=0; disable auto_commit.
<a href=#__codelineno-2-2 id=__codelineno-2-2 name=__codelineno-2-2></a>inserts......
<a href=#__codelineno-2-3 id=__codelineno-2-3 name=__codelineno-2-3></a>set unique_checks=1; set foreign_key_checks=1; enable auto_commit.
</code></pre></div> Which improves bulk inserts performance. <p>Your process is slow due to heavy disk I/O activity for SQL operations. You need to optimize innodb for intensive operations. Modify your mysql configuration file to have these lines: innodb_buffer_pool_size = 4G innodb_log_buffer_size = 256M innodb_log_file_size = 1G innodb_write_io_threads = 16<p><strong>innodb_buffer_pool_size</strong>: the memory area where InnoDB caches table and index data. When table data is cached in the InnoDB buffer pool, it can be accessed repeatedly by queries without requiring any disk I/O. Data changes are cached rather than immediately written to disk.<p>A larger buffer pool requires less disk I/O to access the same table data more than once. On a dedicated database server, you might set the buffer pool size to 80% of the machine's physical memory else use 50 to 75 percent of system memory. The default buffer pool size is 128MB.<p>To determine the optimal size, do:<div class=highlight><pre><span></span><code><a href=#__codelineno-3-1 id=__codelineno-3-1 name=__codelineno-3-1></a><span class=k>SELECT</span><span class=w> </span><span class=p>(</span><span class=n>PagesData</span><span class=o>*</span><span class=n>PageSize</span><span class=p>)</span><span class=o>/</span><span class=n>POWER</span><span class=p>(</span><span class=mi>1024</span><span class=p>,</span><span class=mi>3</span><span class=p>)</span><span class=w> </span><span class=n>DataGB</span><span class=w> </span>
<a href=#__codelineno-3-2 id=__codelineno-3-2 name=__codelineno-3-2></a><span class=k>FROM</span>
<a href=#__codelineno-3-3 id=__codelineno-3-3 name=__codelineno-3-3></a><span class=p>(</span><span class=k>SELECT</span><span class=w> </span><span class=n>variable_value</span><span class=w> </span><span class=n>PagesData</span>
<a href=#__codelineno-3-4 id=__codelineno-3-4 name=__codelineno-3-4></a><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=n>performance_schema</span><span class=p>.</span><span class=n>global_status</span>
<a href=#__codelineno-3-5 id=__codelineno-3-5 name=__codelineno-3-5></a><span class=w> </span><span class=k>WHERE</span><span class=w> </span><span class=n>variable_name</span><span class=o>=</span><span class=s1>'Innodb_buffer_pool_pages_data'</span><span class=p>)</span><span class=w> </span><span class=n>A</span><span class=p>,</span>
<a href=#__codelineno-3-6 id=__codelineno-3-6 name=__codelineno-3-6></a><span class=p>(</span><span class=k>SELECT</span><span class=w> </span><span class=n>variable_value</span><span class=w> </span><span class=n>PageSize</span>
<a href=#__codelineno-3-7 id=__codelineno-3-7 name=__codelineno-3-7></a><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=n>performance_schema</span><span class=p>.</span><span class=n>global_status</span>
<a href=#__codelineno-3-8 id=__codelineno-3-8 name=__codelineno-3-8></a><span class=w> </span><span class=k>WHERE</span><span class=w> </span><span class=n>variable_name</span><span class=o>=</span><span class=s1>'Innodb_page_size'</span><span class=p>)</span><span class=w> </span><span class=n>B</span><span class=p>;</span>
</code></pre></div><div class=highlight><pre><span></span><code>                    Duration / Fetch
</code></pre></div><p>353 row(s) returned 34.422 sec / 125.797 sec (8MB innodb buffer_pool_size) 353 row(s) returned 0.500 sec / 1.297 sec (1GB innodb buffer_pool_size)<p><strong>innodb_log_buffer_size</strong>: The size in bytes of the buffer that InnoDB uses to write to the log files on disk.<p>A large log buffer enables large transactions to run without the need to write the log to disk before the transactions commit. Thus, if you have transactions that update, insert, or delete many rows, making the log buffer larger saves disk I/O.<p><strong>innodb_log_file_size</strong>: The size in bytes of each log file in a log group. A large size ensures that the server can smooth out peaks and troughs in workload activity, which often means that there is enough redo log space to handle more than an hour of write activity. The larger the value, the less checkpoint flush activity is required in the buffer pool, saving disk I/O.<p><strong>Innodb_write_io_threads</strong>: The number of I/O threads for write operations in InnoDB. The default value is 4. InnoDB uses background threads to service various types of I/O requests. You can configure the number of background threads that service read and write I/O on data pages using the innodb_read_io_threads and innodb_write_io_threads configuration parameters.<p>These parameters signify the number of background threads used for read and write requests, respectively. Each background thread can handle up to 256 pending I/O requests.<p>If you are importing to innodb the single most effective thing you can do is to put <strong>innodb_flush_log_at_trx_commit</strong> = <strong>2</strong> in your my.cnf, temporarily while the import is running. you can put it back to <strong>1</strong> if you need ACID. Your hint with innodb_flush_log_at_trx_commit = 2 saved my day. Importing a 600 MB dump (as a single big transaction) would have needed 6 hours, but with this temporary setting, it was done in 30 minutes! someone suggested a performance gain of 100x faster<p>https://dev.mysql.com/doc/refman/5.7/en/optimizing-innodb-bulk-data-loading.html<p>https://www.oreilly.com/library/view/high-performance-mysql/9780596101718/ch04.html<p>replace In subquery with inner join will be much faster<p>creating temporal table is faster than directly using inner join statement<h2 id=innodb-optimization-example>InnoDB optimization example<a title="Permanent link" class=headerlink href=#innodb-optimization-example>¶</a></h2><p>https://dba.stackexchange.com/questions/227742/extreme-performance-loss-due-to-moving-from-mysql-5-7-23-to-mysql-8-0-status-c Big update Spent half a day reading into internas, taking your suggestions in consideration and what I was told on IRC. I did the opposite of the professional: I made 10 changes at once, I can't afford so many restarts in a gradual change process: 1) Giving the system lots of parallel write opportunity without choking it innodb_read_io_threads = 16<br> innodb_write_io_threads = 16<br> innodb_thread_concurrency=64 # cpus*2<p>2) Speeding up the background sync: innodb_lru_scan_depth=100<p>3) Disabling highest reliability settings that have a hard performance impact performance_schema=OFF skip-log-bin sync_binlog=0 innodb_flush_log_at_trx_commit=0 # not crash safe, 0 is crash safe<p>4) More multithreading in backend memory innodb_buffer_pool_instances=12<p>5) Increasing logfiles significantly, increasing logfile buffer moderatly innodb_log_file_size = 3G # innodb_log_buffer_size = 64M<p>What happened: About 10 times increase in read performance,1.5x times write performance, I am not where I want to be but it's 15 times faster than before! IOPS usage doubled from ~5-6k to 9k-12k, so I am at 60% IO usage CPU usage increased from 7% to 50%<p><strong>Update</strong>\ I think the problem can be considered half solved, I've made another update after the previous successful one and the performance is acceptable now.<p>The last changes involved write/read threads. I've put them to 32 each. write buffer increased to 128M (for my heavy workload higher might be better) logfiles increased to 8GB buffer_pool_instances increased to 64 (max) for better memory fragmentation page_cleaners increased to 64 (max) to have one for each buffer instance.<p>write performance increased by another ~20%, read performance increased by another ~30%.<p>It's been a 24 hour ride to get mysql perform acceptable, definitely not a simple upgrade.<h2 id=limitations-of-the-mysql-query-optimizer>Limitations of the MySQL Query Optimizer<a title="Permanent link" class=headerlink href=#limitations-of-the-mysql-query-optimizer>¶</a></h2><h3 id=correlated-subqueries>Correlated subqueries<a title="Permanent link" class=headerlink href=#correlated-subqueries>¶</a></h3><p>bad:<div class=highlight><pre><span></span><code><a href=#__codelineno-4-1 id=__codelineno-4-1 name=__codelineno-4-1></a><span class=k>SELECT</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=n>sakila</span><span class=p>.</span><span class=n>film</span>
<a href=#__codelineno-4-2 id=__codelineno-4-2 name=__codelineno-4-2></a><span class=k>WHERE</span><span class=w> </span><span class=n>film_id</span><span class=w> </span><span class=k>IN</span>
<a href=#__codelineno-4-3 id=__codelineno-4-3 name=__codelineno-4-3></a><span class=p>(</span>
<a href=#__codelineno-4-4 id=__codelineno-4-4 name=__codelineno-4-4></a><span class=w>   </span><span class=k>SELECT</span><span class=w> </span><span class=n>film_id</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=n>sakila</span><span class=p>.</span><span class=n>film_actor</span><span class=w> </span><span class=k>WHERE</span><span class=w> </span><span class=n>actor_id</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>1</span>
<a href=#__codelineno-4-5 id=__codelineno-4-5 name=__codelineno-4-5></a><span class=p>);</span>
</code></pre></div><p>optimized to:<div class=highlight><pre><span></span><code><a href=#__codelineno-5-1 id=__codelineno-5-1 name=__codelineno-5-1></a><span class=k>SELECT</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=n>sakila</span><span class=p>.</span><span class=n>film</span>
<a href=#__codelineno-5-2 id=__codelineno-5-2 name=__codelineno-5-2></a><span class=k>WHERE</span><span class=w> </span><span class=k>EXISTS</span><span class=w> </span>
<a href=#__codelineno-5-3 id=__codelineno-5-3 name=__codelineno-5-3></a><span class=p>(</span>
<a href=#__codelineno-5-4 id=__codelineno-5-4 name=__codelineno-5-4></a><span class=w>   </span><span class=k>SELECT</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=n>sakila</span><span class=p>.</span><span class=n>film_actor</span><span class=w> </span><span class=k>WHERE</span><span class=w> </span><span class=n>actor_id</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>1</span>
<a href=#__codelineno-5-5 id=__codelineno-5-5 name=__codelineno-5-5></a><span class=w>   </span><span class=k>AND</span><span class=w> </span><span class=n>film_actor</span><span class=p>.</span><span class=n>film_id</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>film</span><span class=p>.</span><span class=n>film_id</span>
<a href=#__codelineno-5-6 id=__codelineno-5-6 name=__codelineno-5-6></a><span class=p>);</span>
</code></pre></div><p>good:<div class=highlight><pre><span></span><code><a href=#__codelineno-6-1 id=__codelineno-6-1 name=__codelineno-6-1></a><span class=k>SELECT</span><span class=w> </span><span class=n>film</span><span class=p>.</span><span class=o>*</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=n>sakila</span><span class=p>.</span><span class=n>film</span>
<a href=#__codelineno-6-2 id=__codelineno-6-2 name=__codelineno-6-2></a><span class=k>INNER</span><span class=w> </span><span class=k>JOIN</span><span class=w> </span><span class=n>sakila</span><span class=p>.</span><span class=n>film_actor</span><span class=w> </span><span class=k>USING</span><span class=p>(</span><span class=n>film_id</span><span class=p>)</span>
<a href=#__codelineno-6-3 id=__codelineno-6-3 name=__codelineno-6-3></a><span class=k>WHERE</span><span class=w> </span><span class=n>actor_id</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>1</span><span class=p>;</span>
</code></pre></div><p>Another good optimization is to manually generate the IN() list by executing the subquery as a separate query with GROUP_CONCAT(). Sometimes this can be faster than a JOIN.<h3 id=slow-limit-query>slow limit query<a title="Permanent link" class=headerlink href=#slow-limit-query>¶</a></h3><p>https://stackoverflow.com/questions/17747871/why-is-mysql-slow-when-using-limit-in-my-query<p>Same problem happened in my project, I did some test, and found out that LIMIT is slow because of row lookups<p>See: MySQL ORDER BY / LIMIT performance: late row lookups<p>So, the solution is: * when using LIMIT, select not all columns, but only the PK columns * Select all columns you need, and then join with the result set of PK cols<p>SQL should likes:<div class=highlight><pre><span></span><code><a href=#__codelineno-7-1 id=__codelineno-7-1 name=__codelineno-7-1></a><span class=k>SELECT</span><span class=w>  </span><span class=o>*</span><span class=w> </span><span class=k>FROM</span>
<a href=#__codelineno-7-2 id=__codelineno-7-2 name=__codelineno-7-2></a><span class=w>    </span><span class=n>orders</span><span class=w> </span><span class=n>t1</span><span class=w>   </span><span class=o>&lt;===</span><span class=w> </span><span class=n>this</span><span class=w> </span><span class=k>is</span><span class=w> </span><span class=n>what</span><span class=w> </span><span class=n>you</span><span class=w> </span><span class=n>want</span>
<a href=#__codelineno-7-3 id=__codelineno-7-3 name=__codelineno-7-3></a><span class=k>JOIN</span><span class=w> </span><span class=p>(</span><span class=w>  </span><span class=k>SELECT</span><span class=w> </span><span class=n>ID</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=n>orders</span><span class=w>     </span><span class=o>&lt;==</span><span class=w> </span><span class=k>fetch</span><span class=w> </span><span class=n>the</span><span class=w> </span><span class=n>PK</span><span class=w> </span><span class=k>column</span><span class=w> </span><span class=k>only</span><span class=p>,</span><span class=w> </span><span class=n>this</span><span class=w> </span><span class=n>should</span><span class=w> </span><span class=n>be</span><span class=w> </span><span class=n>fast</span><span class=w>        </span>
<a href=#__codelineno-7-4 id=__codelineno-7-4 name=__codelineno-7-4></a><span class=w>        </span><span class=k>WHERE</span><span class=w> </span><span class=p>[</span><span class=n>your</span><span class=w> </span><span class=n>query</span><span class=w> </span><span class=n>condition</span><span class=p>]</span><span class=w>        </span><span class=o>&lt;==</span><span class=w> </span><span class=n>filter</span><span class=w> </span><span class=n>record</span><span class=w> </span><span class=k>by</span><span class=w> </span><span class=n>condition</span>
<a href=#__codelineno-7-5 id=__codelineno-7-5 name=__codelineno-7-5></a><span class=w>        </span><span class=k>ORDER</span><span class=w> </span><span class=k>BY</span><span class=w> </span><span class=p>[</span><span class=n>your</span><span class=w> </span><span class=k>order</span><span class=w> </span><span class=k>by</span><span class=w> </span><span class=n>condition</span><span class=p>]</span><span class=w>  </span><span class=o>&lt;==</span><span class=w> </span><span class=n>control</span><span class=w> </span><span class=n>the</span><span class=w> </span><span class=n>record</span><span class=w> </span><span class=k>order</span>
<a href=#__codelineno-7-6 id=__codelineno-7-6 name=__codelineno-7-6></a><span class=w>        </span><span class=k>LIMIT</span><span class=w> </span><span class=mi>2000</span><span class=p>,</span><span class=w> </span><span class=mi>50</span><span class=w>                      </span><span class=o>&lt;==</span><span class=w> </span><span class=n>filter</span><span class=w> </span><span class=n>record</span><span class=w> </span><span class=k>by</span><span class=w> </span><span class=n>paging</span><span class=w> </span><span class=n>condition</span>
<a href=#__codelineno-7-7 id=__codelineno-7-7 name=__codelineno-7-7></a><span class=p>)</span><span class=w> </span><span class=k>as</span><span class=w> </span><span class=n>t2</span>
<a href=#__codelineno-7-8 id=__codelineno-7-8 name=__codelineno-7-8></a><span class=k>ON</span><span class=w> </span><span class=n>t1</span><span class=p>.</span><span class=n>ID</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>t2</span><span class=p>.</span><span class=n>ID</span>
<a href=#__codelineno-7-9 id=__codelineno-7-9 name=__codelineno-7-9></a><span class=k>ORDER</span><span class=w> </span><span class=k>BY</span><span class=w> </span><span class=p>[</span><span class=n>your</span><span class=w> </span><span class=k>order</span><span class=w> </span><span class=k>by</span><span class=w> </span><span class=n>condition</span><span class=p>]</span><span class=w>          </span><span class=o>&lt;==</span><span class=w> </span><span class=n>control</span><span class=w> </span><span class=n>the</span><span class=w> </span><span class=n>record</span><span class=w> </span><span class=k>order</span>
</code></pre></div> in my DB, the old SQL which select all columns using "LIMIT 21560, 20", costs about 4.484s. the new sql costs only 0.063s. The new one is about 71 times faster</article></div><script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script></div><button class="md-top md-icon" data-md-component=top hidden type=button><svg viewbox="0 0 24 24" xmlns=http://www.w3.org/2000/svg><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg> Back to top</button></main><footer class=md-footer><div class="md-footer-meta md-typeset"><div class="md-footer-meta__inner md-grid"><div class=md-copyright><div class=md-copyright__highlight><a title="Go to Main Home Page" href=/>🏠 Back to Home</a><br> Copyright © 2026 Sean Ma <br>Last updated on 17 Jan 2026</div> Made with <a href=https://squidfunk.github.io/mkdocs-material/ rel=noopener target=_blank> Material for MkDocs </a></div></div></div></footer></div><div class=md-dialog data-md-component=dialog><div class="md-dialog__inner md-typeset"></div></div><script id=__config type=application/json>{"base": "../../..", "features": ["navigation.tabs", "navigation.expand", "navigation.indexes", "navigation.top", "toc.follow", "search.suggest", "search.highlight", "content.code.copy", "navigation.prune"], "search": "../../../assets/javascripts/workers/search.d50fe291.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script><script src=../../../assets/javascripts/bundle.56ea9cef.min.js></script>