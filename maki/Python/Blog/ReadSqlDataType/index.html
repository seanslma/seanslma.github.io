<!doctype html><html class=no-js lang=en><meta charset=utf-8><meta content="width=device-width,initial-scale=1" name=viewport><link href=https://seanslma.github.io/maki/Python/Blog/ReadSqlDataType/ rel=canonical><link href=../ReadParquetPerf/ rel=prev><link href=../SqlSslSecurityLevel/ rel=next><link href=../../../assets/images/favicon.png rel=icon><meta content="mkdocs-1.6.1, mkdocs-material-9.6.15" name=generator><title>The Pandas Function pd.read_sql Returns An Empty DataFrame Without Correct Data Types - maki</title><link href=../../../assets/stylesheets/main.342714a4.min.css rel=stylesheet><link href=../../../assets/stylesheets/palette.06af60db.min.css rel=stylesheet><link crossorigin href=https://fonts.gstatic.com rel=preconnect><link href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback" rel=stylesheet><style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style><link href=../../../stylesheets/extra.css rel=stylesheet><script>__md_scope=new URL(`../../..`,location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+`.`+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+`.`+e,JSON.stringify(_))}catch{}};</script><body data-md-color-accent=indigo data-md-color-primary=indigo data-md-color-scheme=default dir=ltr><input autocomplete=off class=md-toggle data-md-toggle=drawer id=__drawer type=checkbox><input autocomplete=off class=md-toggle data-md-toggle=search id=__search type=checkbox><label class=md-overlay for=__drawer></label><div data-md-component=skip><a class=md-skip href=#the-pandas-function-pdread_sql-returns-an-empty-dataframe-without-correct-data-types> Skip to content </a></div><div data-md-component=announce></div><header class=md-header data-md-component=header><nav class="md-header__inner md-grid" aria-label=Header><a class="md-header__button md-logo" aria-label=maki data-md-component=logo href=../../.. title=maki> <svg viewbox="0 0 24 24" xmlns=http://www.w3.org/2000/svg><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg> </a><label class="md-header__button md-icon" for=__drawer><svg viewbox="0 0 24 24" xmlns=http://www.w3.org/2000/svg><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg></label><div class=md-header__title data-md-component=header-title><div class=md-header__ellipsis><div class=md-header__topic><span class=md-ellipsis> maki </span></div><div class=md-header__topic data-md-component=header-topic><span class=md-ellipsis> The Pandas Function pd.read_sql Returns An Empty DataFrame Without Correct Data Types </span></div></div></div><form class=md-header__option data-md-component=palette><input aria-label="Switch to dark mode" class=md-option data-md-color-accent=indigo data-md-color-media data-md-color-primary=indigo data-md-color-scheme=default id=__palette_0 name=__palette type=radio><label class="md-header__button md-icon" title="Switch to dark mode" for=__palette_1 hidden><svg viewbox="0 0 24 24" xmlns=http://www.w3.org/2000/svg><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg></label><input aria-label="Switch to light mode" class=md-option data-md-color-accent=indigo data-md-color-media data-md-color-primary=indigo data-md-color-scheme=slate id=__palette_1 name=__palette type=radio><label class="md-header__button md-icon" title="Switch to light mode" for=__palette_0 hidden><svg viewbox="0 0 24 24" xmlns=http://www.w3.org/2000/svg><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12s-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg></label></form><script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script><label class="md-header__button md-icon" for=__search><svg viewbox="0 0 24 24" xmlns=http://www.w3.org/2000/svg><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg></label><div class=md-search data-md-component=search role=dialog><label class=md-search__overlay for=__search></label><div class=md-search__inner role=search><form class=md-search__form name=search><input aria-label=Search autocapitalize=off autocomplete=off autocorrect=off class=md-search__input data-md-component=search-query name=query placeholder=Search required spellcheck=false><label class="md-search__icon md-icon" for=__search><svg viewbox="0 0 24 24" xmlns=http://www.w3.org/2000/svg><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg> <svg viewbox="0 0 24 24" xmlns=http://www.w3.org/2000/svg><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg></label><nav aria-label=Search class=md-search__options><button class="md-search__icon md-icon" aria-label=Clear tabindex=-1 title=Clear type=reset><svg viewbox="0 0 24 24" xmlns=http://www.w3.org/2000/svg><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg></button></nav><div class=md-search__suggest data-md-component=search-suggest></div></form><div class=md-search__output><div class=md-search__scrollwrap data-md-scrollfix tabindex=0><div class=md-search-result data-md-component=search-result><div class=md-search-result__meta>Initializing search</div><ol class=md-search-result__list role=presentation></ol></div></div></div></div></div><div class=md-header__source><a title="Go to repository" class=md-source data-md-component=source href=https://github.com/seanslma/maki> <div class="md-source__icon md-icon"><svg viewbox="0 0 448 512" xmlns=http://www.w3.org/2000/svg><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"/></svg></div> <div class=md-source__repository>GitHub</div> </a></div></nav></header><div class=md-container data-md-component=container><nav aria-label=Tabs class=md-tabs data-md-component=tabs><div class=md-grid><ul class=md-tabs__list><li class=md-tabs__item><a class=md-tabs__link href=../../..> About </a><li class=md-tabs__item><a class=md-tabs__link href=../../../AI/ChatGPT/> AI </a><li class=md-tabs__item><a class=md-tabs__link href=../../../AWS/CDN/> AWS </a><li class=md-tabs__item><a class=md-tabs__link href=../../../Azure/Advisor/> Azure </a><li class=md-tabs__item><a class=md-tabs__link href=../../../Coding/Notepad%2B%2B/> Coding </a><li class=md-tabs__item><a class=md-tabs__link href=../../../Cybersecurity/Cybersecurity/> Cybersecurity </a><li class=md-tabs__item><a class=md-tabs__link href=../../../Data/Data/> Data </a><li class=md-tabs__item><a class=md-tabs__link href=../../../DevOps/DevOps/> DevOps </a><li class=md-tabs__item><a class=md-tabs__link href=../../../Documentation/Jira/> Documentation </a><li class=md-tabs__item><a class=md-tabs__link href=../../../Energy/Inertia/> Energy </a><li class=md-tabs__item><a class=md-tabs__link href=../../../Learn/Book/> Learn </a><li class=md-tabs__item><a class=md-tabs__link href=../../../ML/Backtest/> ML </a><li class=md-tabs__item><a class=md-tabs__link href=../../../Optimizaton/Convex/> Optimizaton </a><li class=md-tabs__item><a class=md-tabs__link href=../../../PowerBI/Basic/> PowerBI </a><li class="md-tabs__item md-tabs__item--active"><a class=md-tabs__link href=../../NAN/> Python </a><li class=md-tabs__item><a class=md-tabs__link href=../../../SQL/Database/> SQL </a><li class=md-tabs__item><a class=md-tabs__link href=../../../System/Behavior/> System </a></ul></div></nav><main class=md-main data-md-component=main><div class="md-main__inner md-grid"><div class="md-sidebar md-sidebar--primary" data-md-component=sidebar data-md-type=navigation><div class=md-sidebar__scrollwrap><div class=md-sidebar__inner><nav class="md-nav md-nav--primary md-nav--lifted" aria-label=Navigation data-md-level=0><label class=md-nav__title for=__drawer><a class="md-nav__button md-logo" aria-label=maki data-md-component=logo href=../../.. title=maki> <svg viewbox="0 0 24 24" xmlns=http://www.w3.org/2000/svg><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg> </a> maki</label><div class=md-nav__source><a title="Go to repository" class=md-source data-md-component=source href=https://github.com/seanslma/maki> <div class="md-source__icon md-icon"><svg viewbox="0 0 448 512" xmlns=http://www.w3.org/2000/svg><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"/></svg></div> <div class=md-source__repository>GitHub</div> </a></div><ul class=md-nav__list data-md-scrollfix><li class=md-nav__item><a class=md-nav__link href=../../..> <span class=md-ellipsis> About </span> </a><li class="md-nav__item md-nav__item--pruned md-nav__item--nested"><a class=md-nav__link href=../../../AI/ChatGPT/> <span class=md-ellipsis> AI </span> <span class="md-nav__icon md-icon"></span> </a><li class="md-nav__item md-nav__item--pruned md-nav__item--nested"><a class=md-nav__link href=../../../AWS/CDN/> <span class=md-ellipsis> AWS </span> <span class="md-nav__icon md-icon"></span> </a><li class="md-nav__item md-nav__item--pruned md-nav__item--nested"><a class=md-nav__link href=../../../Azure/Advisor/> <span class=md-ellipsis> Azure </span> <span class="md-nav__icon md-icon"></span> </a><li class="md-nav__item md-nav__item--pruned md-nav__item--nested"><a class=md-nav__link href=../../../Coding/Notepad%2B%2B/> <span class=md-ellipsis> Coding </span> <span class="md-nav__icon md-icon"></span> </a><li class="md-nav__item md-nav__item--pruned md-nav__item--nested"><a class=md-nav__link href=../../../Cybersecurity/Cybersecurity/> <span class=md-ellipsis> Cybersecurity </span> <span class="md-nav__icon md-icon"></span> </a><li class="md-nav__item md-nav__item--pruned md-nav__item--nested"><a class=md-nav__link href=../../../Data/Data/> <span class=md-ellipsis> Data </span> <span class="md-nav__icon md-icon"></span> </a><li class="md-nav__item md-nav__item--pruned md-nav__item--nested"><a class=md-nav__link href=../../../DevOps/DevOps/> <span class=md-ellipsis> DevOps </span> <span class="md-nav__icon md-icon"></span> </a><li class="md-nav__item md-nav__item--pruned md-nav__item--nested"><a class=md-nav__link href=../../../Documentation/Jira/> <span class=md-ellipsis> Documentation </span> <span class="md-nav__icon md-icon"></span> </a><li class="md-nav__item md-nav__item--pruned md-nav__item--nested"><a class=md-nav__link href=../../../Energy/Inertia/> <span class=md-ellipsis> Energy </span> <span class="md-nav__icon md-icon"></span> </a><li class="md-nav__item md-nav__item--pruned md-nav__item--nested"><a class=md-nav__link href=../../../Learn/Book/> <span class=md-ellipsis> Learn </span> <span class="md-nav__icon md-icon"></span> </a><li class="md-nav__item md-nav__item--pruned md-nav__item--nested"><a class=md-nav__link href=../../../ML/Backtest/> <span class=md-ellipsis> ML </span> <span class="md-nav__icon md-icon"></span> </a><li class="md-nav__item md-nav__item--pruned md-nav__item--nested"><a class=md-nav__link href=../../../Optimizaton/Convex/> <span class=md-ellipsis> Optimizaton </span> <span class="md-nav__icon md-icon"></span> </a><li class="md-nav__item md-nav__item--pruned md-nav__item--nested"><a class=md-nav__link href=../../../PowerBI/Basic/> <span class=md-ellipsis> PowerBI </span> <span class="md-nav__icon md-icon"></span> </a><li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested"><input class="md-nav__toggle md-toggle" checked id=__nav_15 type=checkbox> <label class=md-nav__link for=__nav_15 id=__nav_15_label><span class=md-ellipsis> Python </span> <span class="md-nav__icon md-icon"></span></label> <nav aria-expanded=true aria-labelledby=__nav_15_label class=md-nav data-md-level=1><label class=md-nav__title for=__nav_15><span class="md-nav__icon md-icon"></span> Python</label><ul class=md-nav__list data-md-scrollfix><li class=md-nav__item><a class=md-nav__link href=../../NAN/> <span class=md-ellipsis> NaN </span> </a><li class=md-nav__item><a class=md-nav__link href=../../Python/> <span class=md-ellipsis> Python </span> </a><li class=md-nav__item><a class=md-nav__link href=../../basic/> <span class=md-ellipsis> basic </span> </a><li class="md-nav__item md-nav__item--pruned md-nav__item--nested"><a class=md-nav__link href=../../API/API/> <span class=md-ellipsis> API </span> <span class="md-nav__icon md-icon"></span> </a><li class="md-nav__item md-nav__item--pruned md-nav__item--nested"><a class=md-nav__link href=../../App/Module/> <span class=md-ellipsis> App </span> <span class="md-nav__icon md-icon"></span> </a><li class="md-nav__item md-nav__item--pruned md-nav__item--nested"><a class=md-nav__link href=../../Architect/Decorator/> <span class=md-ellipsis> Architect </span> <span class="md-nav__icon md-icon"></span> </a><li class="md-nav__item md-nav__item--pruned md-nav__item--nested"><a class=md-nav__link href=../../Async/Asyncio/> <span class=md-ellipsis> Async </span> <span class="md-nav__icon md-icon"></span> </a><li class="md-nav__item md-nav__item--active md-nav__item--nested"><input class="md-nav__toggle md-toggle" checked id=__nav_15_8 type=checkbox> <label class=md-nav__link for=__nav_15_8 id=__nav_15_8_label tabindex=0><span class=md-ellipsis> Blog </span> <span class="md-nav__icon md-icon"></span></label> <nav aria-expanded=true aria-labelledby=__nav_15_8_label class=md-nav data-md-level=2><label class=md-nav__title for=__nav_15_8><span class="md-nav__icon md-icon"></span> Blog</label><ul class=md-nav__list data-md-scrollfix><li class=md-nav__item><a class=md-nav__link href=../BestPractices/> <span class=md-ellipsis> Python Programing Bets Practice </span> </a><li class=md-nav__item><a class=md-nav__link href=../CachesinPython/> <span class=md-ellipsis> Caches used in Python </span> </a><li class=md-nav__item><a class=md-nav__link href=../GroupbyApplyPerf/> <span class=md-ellipsis> How I reduced a Python app run time from two hours to 20 seconds? </span> </a><li class=md-nav__item><a class=md-nav__link href=../NumbaPerf/> <span class=md-ellipsis> Make Python Loops 5x to 10x Faster Using Numba </span> </a><li class=md-nav__item><a class=md-nav__link href=../PackageManagement/> <span class=md-ellipsis> How to manage python package dependencies </span> </a><li class=md-nav__item><a class=md-nav__link href=../PandasExplodeDateRange/> <span class=md-ellipsis> How to explode date ranges in a Pandas DataFrame 30x faster </span> </a><li class=md-nav__item><a class=md-nav__link href=../PandasTestDataFrame/> <span class=md-ellipsis> How to create dummy Pandas DataFrames for testing </span> </a><li class=md-nav__item><a class=md-nav__link href=../ReadCSVPerf/> <span class=md-ellipsis> Read CSV Files 10x to 40x Faster Using pyarrow and polars </span> </a><li class=md-nav__item><a class=md-nav__link href=../ReadExcelPerf/> <span class=md-ellipsis> Read Excel performance </span> </a><li class=md-nav__item><a class=md-nav__link href=../ReadParquetPerf/> <span class=md-ellipsis> Read parquet performance </span> </a><li class="md-nav__item md-nav__item--active"><input class="md-nav__toggle md-toggle" id=__toc type=checkbox> <label class="md-nav__link md-nav__link--active" for=__toc><span class=md-ellipsis> The Pandas Function pd.read_sql Returns An Empty DataFrame Without Correct Data Types </span> <span class="md-nav__icon md-icon"></span></label> <a class="md-nav__link md-nav__link--active" href=./> <span class=md-ellipsis> The Pandas Function pd.read_sql Returns An Empty DataFrame Without Correct Data Types </span> </a> <nav aria-label="Table of contents" class="md-nav md-nav--secondary"><label class=md-nav__title for=__toc><span class="md-nav__icon md-icon"></span> Table of contents</label><ul class=md-nav__list data-md-component=toc data-md-scrollfix><li class=md-nav__item><a class=md-nav__link href=#get-the-data-types-from-the-query-statement> <span class=md-ellipsis> Get the data types from the query statement </span> </a> <nav aria-label="Get the data types from the query statement" class=md-nav><ul class=md-nav__list><li class=md-nav__item><a class=md-nav__link href=#option-1-resultcursordescription> <span class=md-ellipsis> Option 1: result.cursor.description </span> </a><li class=md-nav__item><a class=md-nav__link href=#option-2-querystatementselected_columns> <span class=md-ellipsis> Option 2: query.statement.selected_columns </span> </a></ul></nav><li class=md-nav__item><a class=md-nav__link href=#pass-the-data-type-information-to-pdread_sql> <span class=md-ellipsis> Pass the data type information to pd.read_sql </span> </a><li class=md-nav__item><a class=md-nav__link href=#why-did-i-get-nulltype-for-some-data-columns> <span class=md-ellipsis> Why did I get NullType for some data columns? </span> </a><li class=md-nav__item><a class=md-nav__link href=#reference> <span class=md-ellipsis> Reference </span> </a></ul></nav><li class=md-nav__item><a class=md-nav__link href=../SqlSslSecurityLevel/> <span class=md-ellipsis> Login Timeout From Ubuntu 22.04 To SQL Server Database </span> </a></ul></nav><li class="md-nav__item md-nav__item--pruned md-nav__item--nested"><a class=md-nav__link href=../../CLI/Click/> <span class=md-ellipsis> CLI </span> <span class="md-nav__icon md-icon"></span> </a><li class="md-nav__item md-nav__item--pruned md-nav__item--nested"><a class=md-nav__link href=../../Cache/Aiocache/> <span class=md-ellipsis> Cache </span> <span class="md-nav__icon md-icon"></span> </a><li class="md-nav__item md-nav__item--pruned md-nav__item--nested"><a class=md-nav__link href=../../Celery/Example/> <span class=md-ellipsis> Celery </span> <span class="md-nav__icon md-icon"></span> </a><li class="md-nav__item md-nav__item--pruned md-nav__item--nested"><a class=md-nav__link href=../../Class/ClassMethod/> <span class=md-ellipsis> Class </span> <span class="md-nav__icon md-icon"></span> </a><li class="md-nav__item md-nav__item--pruned md-nav__item--nested"><a class=md-nav__link href=../../Conda/Bashrc/> <span class=md-ellipsis> Conda </span> <span class="md-nav__icon md-icon"></span> </a><li class="md-nav__item md-nav__item--pruned md-nav__item--nested"><a class=md-nav__link href=../../Dash/Callback/> <span class=md-ellipsis> Dash </span> <span class="md-nav__icon md-icon"></span> </a><li class="md-nav__item md-nav__item--pruned md-nav__item--nested"><a class=md-nav__link href=../../Dask/Config/> <span class=md-ellipsis> Dask </span> <span class="md-nav__icon md-icon"></span> </a><li class="md-nav__item md-nav__item--pruned md-nav__item--nested"><a class=md-nav__link href=../../DataType/Dictionary/> <span class=md-ellipsis> DataType </span> <span class="md-nav__icon md-icon"></span> </a><li class="md-nav__item md-nav__item--pruned md-nav__item--nested"><a class=md-nav__link href=../../DateTime/Conversion/> <span class=md-ellipsis> DateTime </span> <span class="md-nav__icon md-icon"></span> </a><li class="md-nav__item md-nav__item--pruned md-nav__item--nested"><a class=md-nav__link href=../../Django/Django/> <span class=md-ellipsis> Django </span> <span class="md-nav__icon md-icon"></span> </a><li class="md-nav__item md-nav__item--pruned md-nav__item--nested"><a class=md-nav__link href=../../Email/ExchangeLib/> <span class=md-ellipsis> Email </span> <span class="md-nav__icon md-icon"></span> </a><li class="md-nav__item md-nav__item--pruned md-nav__item--nested"><a class=md-nav__link href=../../Env/Env/> <span class=md-ellipsis> Env </span> <span class="md-nav__icon md-icon"></span> </a><li class="md-nav__item md-nav__item--pruned md-nav__item--nested"><a class=md-nav__link href=../../ErrorHandling/Exception/> <span class=md-ellipsis> ErrorHandling </span> <span class="md-nav__icon md-icon"></span> </a><li class="md-nav__item md-nav__item--pruned md-nav__item--nested"><a class=md-nav__link href=../../Excel/Excel/> <span class=md-ellipsis> Excel </span> <span class="md-nav__icon md-icon"></span> </a><li class="md-nav__item md-nav__item--pruned md-nav__item--nested"><a class=md-nav__link href=../../Flask/Request/> <span class=md-ellipsis> Flask </span> <span class="md-nav__icon md-icon"></span> </a><li class="md-nav__item md-nav__item--pruned md-nav__item--nested"><a class=md-nav__link href=../../Format/Black/> <span class=md-ellipsis> Format </span> <span class="md-nav__icon md-icon"></span> </a><li class="md-nav__item md-nav__item--pruned md-nav__item--nested"><a class=md-nav__link href=../../Generator/Generator/> <span class=md-ellipsis> Generator </span> <span class="md-nav__icon md-icon"></span> </a><li class="md-nav__item md-nav__item--pruned md-nav__item--nested"><a class=md-nav__link href=../../IO/AzureBlob/> <span class=md-ellipsis> IO </span> <span class="md-nav__icon md-icon"></span> </a><li class="md-nav__item md-nav__item--pruned md-nav__item--nested"><a class=md-nav__link href=../../Issue/Main/> <span class=md-ellipsis> Issue </span> <span class="md-nav__icon md-icon"></span> </a><li class="md-nav__item md-nav__item--pruned md-nav__item--nested"><a class=md-nav__link href=../../Jupyter/Dashboard/> <span class=md-ellipsis> Jupyter </span> <span class="md-nav__icon md-icon"></span> </a><li class="md-nav__item md-nav__item--pruned md-nav__item--nested"><a class=md-nav__link href=../../Logging/AzureLibraries/> <span class=md-ellipsis> Logging </span> <span class="md-nav__icon md-icon"></span> </a><li class="md-nav__item md-nav__item--pruned md-nav__item--nested"><a class=md-nav__link href=../../MSOffice/Access/> <span class=md-ellipsis> MSOffice </span> <span class="md-nav__icon md-icon"></span> </a><li class="md-nav__item md-nav__item--pruned md-nav__item--nested"><a class=md-nav__link href=../../Math/Sparse/> <span class=md-ellipsis> Math </span> <span class="md-nav__icon md-icon"></span> </a><li class="md-nav__item md-nav__item--pruned md-nav__item--nested"><a class=md-nav__link href=../../NumPy/LinearFit/> <span class=md-ellipsis> NumPy </span> <span class="md-nav__icon md-icon"></span> </a><li class="md-nav__item md-nav__item--pruned md-nav__item--nested"><a class=md-nav__link href=../../Package/CondaBuild/> <span class=md-ellipsis> Package </span> <span class="md-nav__icon md-icon"></span> </a><li class="md-nav__item md-nav__item--pruned md-nav__item--nested"><a class=md-nav__link href=../../Pandas/Advance/> <span class=md-ellipsis> Pandas </span> <span class="md-nav__icon md-icon"></span> </a><li class="md-nav__item md-nav__item--pruned md-nav__item--nested"><a class=md-nav__link href=../../PandasUpgradeTest/Datetime/> <span class=md-ellipsis> PandasUpgradeTest </span> <span class="md-nav__icon md-icon"></span> </a><li class="md-nav__item md-nav__item--pruned md-nav__item--nested"><a class=md-nav__link href=../../Parallel/Example/> <span class=md-ellipsis> Parallel </span> <span class="md-nav__icon md-icon"></span> </a><li class="md-nav__item md-nav__item--pruned md-nav__item--nested"><a class=md-nav__link href=../../Performance/Deadlock/> <span class=md-ellipsis> Performance </span> <span class="md-nav__icon md-icon"></span> </a><li class="md-nav__item md-nav__item--pruned md-nav__item--nested"><a class=md-nav__link href=../../Pip/Pip/> <span class=md-ellipsis> Pip </span> <span class="md-nav__icon md-icon"></span> </a><li class="md-nav__item md-nav__item--pruned md-nav__item--nested"><a class=md-nav__link href=../../Polars/CSV/> <span class=md-ellipsis> Polars </span> <span class="md-nav__icon md-icon"></span> </a><li class="md-nav__item md-nav__item--pruned md-nav__item--nested"><a class=md-nav__link href=../../PyArrow/CSV/> <span class=md-ellipsis> PyArrow </span> <span class="md-nav__icon md-icon"></span> </a><li class="md-nav__item md-nav__item--pruned md-nav__item--nested"><a class=md-nav__link href=../../PySpark/Column/> <span class=md-ellipsis> PySpark </span> <span class="md-nav__icon md-icon"></span> </a><li class="md-nav__item md-nav__item--pruned md-nav__item--nested"><a class=md-nav__link href=../../Pytorch/Install/> <span class=md-ellipsis> Pytorch </span> <span class="md-nav__icon md-icon"></span> </a><li class="md-nav__item md-nav__item--pruned md-nav__item--nested"><a class=md-nav__link href=../../Regex/Regex/> <span class=md-ellipsis> Regex </span> <span class="md-nav__icon md-icon"></span> </a><li class="md-nav__item md-nav__item--pruned md-nav__item--nested"><a class=md-nav__link href=../../SQL/ADBC/> <span class=md-ellipsis> SQL </span> <span class="md-nav__icon md-icon"></span> </a><li class="md-nav__item md-nav__item--pruned md-nav__item--nested"><a class=md-nav__link href=../../SQLAlchemy/BindParam/> <span class=md-ellipsis> SQLAlchemy </span> <span class="md-nav__icon md-icon"></span> </a><li class="md-nav__item md-nav__item--pruned md-nav__item--nested"><a class=md-nav__link href=../../SSL/Cert/> <span class=md-ellipsis> SSL </span> <span class="md-nav__icon md-icon"></span> </a><li class="md-nav__item md-nav__item--pruned md-nav__item--nested"><a class=md-nav__link href=../../SciPy/SparseMatrix/> <span class=md-ellipsis> SciPy </span> <span class="md-nav__icon md-icon"></span> </a><li class="md-nav__item md-nav__item--pruned md-nav__item--nested"><a class=md-nav__link href=../../Serialization/Benchmark/> <span class=md-ellipsis> Serialization </span> <span class="md-nav__icon md-icon"></span> </a><li class="md-nav__item md-nav__item--pruned md-nav__item--nested"><a class=md-nav__link href=../../Tensorflow/Install/> <span class=md-ellipsis> Tensorflow </span> <span class="md-nav__icon md-icon"></span> </a><li class="md-nav__item md-nav__item--pruned md-nav__item--nested"><a class=md-nav__link href=../../Test/Config/> <span class=md-ellipsis> Test </span> <span class="md-nav__icon md-icon"></span> </a><li class="md-nav__item md-nav__item--pruned md-nav__item--nested"><a class=md-nav__link href=../../Typing/tips/> <span class=md-ellipsis> Typing </span> <span class="md-nav__icon md-icon"></span> </a><li class="md-nav__item md-nav__item--pruned md-nav__item--nested"><a class=md-nav__link href=../../Visualization/Chart/> <span class=md-ellipsis> Visualization </span> <span class="md-nav__icon md-icon"></span> </a><li class="md-nav__item md-nav__item--pruned md-nav__item--nested"><a class=md-nav__link href=../../Web/Cherrypy/> <span class=md-ellipsis> Web </span> <span class="md-nav__icon md-icon"></span> </a></ul></nav><li class="md-nav__item md-nav__item--pruned md-nav__item--nested"><a class=md-nav__link href=../../../SQL/Database/> <span class=md-ellipsis> SQL </span> <span class="md-nav__icon md-icon"></span> </a><li class="md-nav__item md-nav__item--pruned md-nav__item--nested"><a class=md-nav__link href=../../../System/Behavior/> <span class=md-ellipsis> System </span> <span class="md-nav__icon md-icon"></span> </a></ul></nav></div></div></div><div class="md-sidebar md-sidebar--secondary" data-md-component=sidebar data-md-type=toc><div class=md-sidebar__scrollwrap><div class=md-sidebar__inner><nav aria-label="Table of contents" class="md-nav md-nav--secondary"><label class=md-nav__title for=__toc><span class="md-nav__icon md-icon"></span> Table of contents</label><ul class=md-nav__list data-md-component=toc data-md-scrollfix><li class=md-nav__item><a class=md-nav__link href=#get-the-data-types-from-the-query-statement> <span class=md-ellipsis> Get the data types from the query statement </span> </a> <nav aria-label="Get the data types from the query statement" class=md-nav><ul class=md-nav__list><li class=md-nav__item><a class=md-nav__link href=#option-1-resultcursordescription> <span class=md-ellipsis> Option 1: result.cursor.description </span> </a><li class=md-nav__item><a class=md-nav__link href=#option-2-querystatementselected_columns> <span class=md-ellipsis> Option 2: query.statement.selected_columns </span> </a></ul></nav><li class=md-nav__item><a class=md-nav__link href=#pass-the-data-type-information-to-pdread_sql> <span class=md-ellipsis> Pass the data type information to pd.read_sql </span> </a><li class=md-nav__item><a class=md-nav__link href=#why-did-i-get-nulltype-for-some-data-columns> <span class=md-ellipsis> Why did I get NullType for some data columns? </span> </a><li class=md-nav__item><a class=md-nav__link href=#reference> <span class=md-ellipsis> Reference </span> </a></ul></nav></div></div></div><div class=md-content data-md-component=content><article class="md-content__inner md-typeset"><h1 id=the-pandas-function-pdread_sql-returns-an-empty-dataframe-without-correct-data-types>The Pandas Function <code>pd.read_sql</code> Returns An Empty DataFrame Without Correct Data Types<a title="Permanent link" class=headerlink href=#the-pandas-function-pdread_sql-returns-an-empty-dataframe-without-correct-data-types>¶</a></h1><p>We provide a solution to the issue you might need<p>When querying data from databases such as MS SQL Server via the Driver <code>pyodbc</code>, we can conveniently get the data as a pandas DataFrame by using <code>pd.read_sql</code>. Generally, the driver provides information about the column names, data types, and other metadata associated with the result set. However, when the query result set is empty, the data type information is not available and pandas returns an <code>empty</code> DataFrame with all column types as <code>object</code>.<p>An empty DataFrame with wrong data types can cause issues in your Python code. If you do not check whether the returned DataFrame is empty or not your code will crash in many cases such as trying to extract the year from a datetime column and doing aggregations on float columns. Here we explain how to get the data type information in this situation when using <code>sqlalchemy</code> to create the query.<h2 id=get-the-data-types-from-the-query-statement>Get the data types from the query statement<a title="Permanent link" class=headerlink href=#get-the-data-types-from-the-query-statement>¶</a></h2><p>There are multiple approaches to get the data types but they are not always available in most situations.<h3 id=option-1-resultcursordescription>Option 1: <code>result.cursor.description</code><a title="Permanent link" class=headerlink href=#option-1-resultcursordescription>¶</a></h3><p>The first approach is using the <code>.description</code> attribute of the database <code>cursor</code> object:<div class=highlight><pre><span></span><code><a href=#__codelineno-0-1 id=__codelineno-0-1 name=__codelineno-0-1></a><span class=kn>import</span><span class=w> </span><span class=nn>sqlalchemy</span>
<a href=#__codelineno-0-2 id=__codelineno-0-2 name=__codelineno-0-2></a>
<a href=#__codelineno-0-3 id=__codelineno-0-3 name=__codelineno-0-3></a><span class=n>conn_string</span> <span class=o>=</span> <span class=sa>f</span><span class=s1>'mssql+pyodbc://</span><span class=si>{</span><span class=n>username</span><span class=si>}</span><span class=s1>:</span><span class=si>{</span><span class=n>pwd</span><span class=si>}</span><span class=s1>@</span><span class=si>{</span><span class=n>server_name</span><span class=si>}</span><span class=s1>'</span>
<a href=#__codelineno-0-4 id=__codelineno-0-4 name=__codelineno-0-4></a><span class=n>conn_string</span> <span class=o>+=</span> <span class=sa>f</span><span class=s1>'/</span><span class=si>{</span><span class=n>database_name</span><span class=si>}</span><span class=s1>?driver=ODBC+Driver+17+for+SQL+Server'</span>
<a href=#__codelineno-0-5 id=__codelineno-0-5 name=__codelineno-0-5></a><span class=n>engine</span> <span class=o>=</span> <span class=n>sqlalchemy</span><span class=o>.</span><span class=n>create_engine</span><span class=p>(</span><span class=n>conn_string</span><span class=p>)</span>
<a href=#__codelineno-0-6 id=__codelineno-0-6 name=__codelineno-0-6></a><span class=n>connection</span> <span class=o>=</span> <span class=n>engine</span><span class=o>.</span><span class=n>connect</span><span class=p>()</span>
<a href=#__codelineno-0-7 id=__codelineno-0-7 name=__codelineno-0-7></a>
<a href=#__codelineno-0-8 id=__codelineno-0-8 name=__codelineno-0-8></a><span class=n>query</span> <span class=o>=</span> <span class=s1>'SELECT ID, Name, Price, StartDate FROM sales.Product;'</span>
<a href=#__codelineno-0-9 id=__codelineno-0-9 name=__codelineno-0-9></a><span class=n>result</span> <span class=o>=</span> <span class=n>connection</span><span class=o>.</span><span class=n>execute</span><span class=p>(</span><span class=n>query</span><span class=p>)</span>
<a href=#__codelineno-0-10 id=__codelineno-0-10 name=__codelineno-0-10></a><span class=nb>print</span><span class=p>(</span><span class=n>result</span><span class=o>.</span><span class=n>cursor</span><span class=o>.</span><span class=n>description</span><span class=p>)</span>
</code></pre></div><p>The output will be something like:<div class=highlight><pre><span></span><code><a href=#__codelineno-1-1 id=__codelineno-1-1 name=__codelineno-1-1></a>(
<a href=#__codelineno-1-2 id=__codelineno-1-2 name=__codelineno-1-2></a>    ('ID', &lt;class 'int'>, None, 10, 10, 0, False),
<a href=#__codelineno-1-3 id=__codelineno-1-3 name=__codelineno-1-3></a>    ('Name', &lt;class 'str'>, None, 50, 50, 0, False),
<a href=#__codelineno-1-4 id=__codelineno-1-4 name=__codelineno-1-4></a>    ('Price', &lt;class 'decimal.Decimal'>, None, 19, 19, 4, False),
<a href=#__codelineno-1-5 id=__codelineno-1-5 name=__codelineno-1-5></a>    ('StartDate', &lt;class 'datetime.datetime'>, None, 23, 23, 3, False),
<a href=#__codelineno-1-6 id=__codelineno-1-6 name=__codelineno-1-6></a>)
</code></pre></div><h3 id=option-2-querystatementselected_columns>Option 2: <code>query.statement.selected_columns</code><a title="Permanent link" class=headerlink href=#option-2-querystatementselected_columns>¶</a></h3><p>If the first approach does not work and you use <code>sqlalchemy</code> to create the query, you should still be able to get the data types.<p>Assume we defined the <code>sales.Product</code> Table as:<div class=highlight><pre><span></span><code><a href=#__codelineno-2-1 id=__codelineno-2-1 name=__codelineno-2-1></a><span class=kn>from</span><span class=w> </span><span class=nn>sqlalchemy.orm</span><span class=w> </span><span class=kn>import</span> <span class=n>declarative_base</span>
<a href=#__codelineno-2-2 id=__codelineno-2-2 name=__codelineno-2-2></a><span class=kn>from</span><span class=w> </span><span class=nn>sqlalchemy</span><span class=w> </span><span class=kn>import</span> <span class=n>create_engine</span><span class=p>,</span> <span class=n>Column</span><span class=p>,</span> <span class=n>DateTime</span><span class=p>,</span> <span class=n>DECIMAL</span><span class=p>,</span> <span class=n>Integer</span><span class=p>,</span> <span class=n>Unicode</span>
<a href=#__codelineno-2-3 id=__codelineno-2-3 name=__codelineno-2-3></a>
<a href=#__codelineno-2-4 id=__codelineno-2-4 name=__codelineno-2-4></a><span class=c1># Base classes and will hold the metadata about the tables</span>
<a href=#__codelineno-2-5 id=__codelineno-2-5 name=__codelineno-2-5></a><span class=n>Base</span> <span class=o>=</span> <span class=n>declarative_base</span><span class=p>()</span>
<a href=#__codelineno-2-6 id=__codelineno-2-6 name=__codelineno-2-6></a>
<a href=#__codelineno-2-7 id=__codelineno-2-7 name=__codelineno-2-7></a><span class=c1># A declarative class for Table `sales.Product` by inheriting from the Base class</span>
<a href=#__codelineno-2-8 id=__codelineno-2-8 name=__codelineno-2-8></a><span class=k>class</span><span class=w> </span><span class=nc>Product</span><span class=p>(</span><span class=n>Base</span><span class=p>):</span>
<a href=#__codelineno-2-9 id=__codelineno-2-9 name=__codelineno-2-9></a>    <span class=n>__tablename__</span> <span class=o>=</span> <span class=s1>'Product'</span>
<a href=#__codelineno-2-10 id=__codelineno-2-10 name=__codelineno-2-10></a>    <span class=n>__table_args__</span> <span class=o>=</span> <span class=p>{</span><span class=s1>'schema'</span><span class=p>:</span> <span class=s1>'sales'</span><span class=p>}</span>
<a href=#__codelineno-2-11 id=__codelineno-2-11 name=__codelineno-2-11></a>
<a href=#__codelineno-2-12 id=__codelineno-2-12 name=__codelineno-2-12></a>    <span class=n>ID</span> <span class=o>=</span> <span class=n>Column</span><span class=p>(</span><span class=n>Integer</span><span class=p>,</span> <span class=n>primary_key</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
<a href=#__codelineno-2-13 id=__codelineno-2-13 name=__codelineno-2-13></a>    <span class=n>Name</span> <span class=o>=</span> <span class=n>Name</span> <span class=o>=</span> <span class=n>Column</span><span class=p>(</span><span class=n>Unicode</span><span class=p>(</span><span class=mi>50</span><span class=p>),</span> <span class=n>nullable</span><span class=o>=</span><span class=kc>False</span><span class=p>)</span>
<a href=#__codelineno-2-14 id=__codelineno-2-14 name=__codelineno-2-14></a>    <span class=n>Price</span> <span class=o>=</span> <span class=n>Column</span><span class=p>(</span><span class=n>DECIMAL</span><span class=p>(</span><span class=mi>19</span><span class=p>,</span> <span class=mi>4</span><span class=p>))</span>
<a href=#__codelineno-2-15 id=__codelineno-2-15 name=__codelineno-2-15></a>    <span class=n>StartDate</span> <span class=o>=</span> <span class=n>Column</span><span class=p>(</span><span class=n>DateTime</span><span class=p>)</span>
<a href=#__codelineno-2-16 id=__codelineno-2-16 name=__codelineno-2-16></a>
<a href=#__codelineno-2-17 id=__codelineno-2-17 name=__codelineno-2-17></a>
<a href=#__codelineno-2-18 id=__codelineno-2-18 name=__codelineno-2-18></a><span class=c1># Create a SQLAlchemy engine</span>
<a href=#__codelineno-2-19 id=__codelineno-2-19 name=__codelineno-2-19></a><span class=n>engine</span> <span class=o>=</span> <span class=n>create_engine</span><span class=p>(</span><span class=sa>f</span><span class=s1>'</span><span class=si>{</span><span class=n>database_connection_url</span><span class=si>}</span><span class=s1>'</span><span class=p>)</span>
<a href=#__codelineno-2-20 id=__codelineno-2-20 name=__codelineno-2-20></a>
<a href=#__codelineno-2-21 id=__codelineno-2-21 name=__codelineno-2-21></a><span class=c1># Create tables in the database</span>
<a href=#__codelineno-2-22 id=__codelineno-2-22 name=__codelineno-2-22></a><span class=n>Base</span><span class=o>.</span><span class=n>metadata</span><span class=o>.</span><span class=n>create_all</span><span class=p>(</span><span class=n>engine</span><span class=p>)</span>
</code></pre></div><p>And we created the query in this way:<div class=highlight><pre><span></span><code><a href=#__codelineno-3-1 id=__codelineno-3-1 name=__codelineno-3-1></a><span class=kn>from</span><span class=w> </span><span class=nn>sqlalchemy</span><span class=w> </span><span class=kn>import</span> <span class=n>sql</span><span class=p>,</span> <span class=n>types</span>
<a href=#__codelineno-3-2 id=__codelineno-3-2 name=__codelineno-3-2></a><span class=kn>from</span><span class=w> </span><span class=nn>sqlalchemy.orm</span><span class=w> </span><span class=kn>import</span> <span class=n>Session</span>
<a href=#__codelineno-3-3 id=__codelineno-3-3 name=__codelineno-3-3></a>
<a href=#__codelineno-3-4 id=__codelineno-3-4 name=__codelineno-3-4></a><span class=n>session</span> <span class=o>=</span> <span class=n>Session</span><span class=p>(</span><span class=n>bind</span><span class=o>=</span><span class=n>engine</span><span class=p>)</span>
<a href=#__codelineno-3-5 id=__codelineno-3-5 name=__codelineno-3-5></a><span class=n>sp</span> <span class=o>=</span> <span class=n>Product</span>
<a href=#__codelineno-3-6 id=__codelineno-3-6 name=__codelineno-3-6></a><span class=n>query</span> <span class=o>=</span> <span class=n>session</span><span class=o>.</span><span class=n>query</span><span class=p>(</span>
<a href=#__codelineno-3-7 id=__codelineno-3-7 name=__codelineno-3-7></a>    <span class=n>sp</span><span class=o>.</span><span class=n>ID</span><span class=o>.</span><span class=n>label</span><span class=p>(</span><span class=s1>'id'</span><span class=p>),</span>
<a href=#__codelineno-3-8 id=__codelineno-3-8 name=__codelineno-3-8></a>    <span class=n>sp</span><span class=o>.</span><span class=n>Name</span><span class=o>.</span><span class=n>label</span><span class=p>(</span><span class=s1>'name'</span><span class=p>),</span>
<a href=#__codelineno-3-9 id=__codelineno-3-9 name=__codelineno-3-9></a>    <span class=n>sp</span><span class=o>.</span><span class=n>Price</span><span class=o>.</span><span class=n>label</span><span class=p>(</span><span class=s1>'price'</span><span class=p>),</span>
<a href=#__codelineno-3-10 id=__codelineno-3-10 name=__codelineno-3-10></a>    <span class=n>sp</span><span class=o>.</span><span class=n>StartDate</span><span class=o>.</span><span class=n>label</span><span class=p>(</span><span class=s1>'start_date'</span><span class=p>),</span>
<a href=#__codelineno-3-11 id=__codelineno-3-11 name=__codelineno-3-11></a><span class=p>)</span>
</code></pre></div><p>Finally we can get the data types from the query:<div class=highlight><pre><span></span><code><a href=#__codelineno-4-1 id=__codelineno-4-1 name=__codelineno-4-1></a><span class=k>if</span> <span class=nb>isinstance</span><span class=p>(</span><span class=n>query</span><span class=p>,</span> <span class=n>sqlalchemy</span><span class=o>.</span><span class=n>orm</span><span class=o>.</span><span class=n>query</span><span class=o>.</span><span class=n>Query</span><span class=p>):</span>
<a href=#__codelineno-4-2 id=__codelineno-4-2 name=__codelineno-4-2></a>    <span class=n>dtype</span> <span class=o>=</span> <span class=p>{</span>
<a href=#__codelineno-4-3 id=__codelineno-4-3 name=__codelineno-4-3></a>        <span class=n>c</span><span class=o>.</span><span class=n>name</span><span class=p>:</span> <span class=n>c</span><span class=o>.</span><span class=n>type</span><span class=o>.</span><span class=vm>__class__</span><span class=o>.</span><span class=vm>__name__</span>
<a href=#__codelineno-4-4 id=__codelineno-4-4 name=__codelineno-4-4></a>        <span class=k>for</span> <span class=n>c</span> <span class=ow>in</span> <span class=n>query</span><span class=o>.</span><span class=n>statement</span><span class=o>.</span><span class=n>selected_columns</span>
<a href=#__codelineno-4-5 id=__codelineno-4-5 name=__codelineno-4-5></a>    <span class=p>}</span>
</code></pre></div><p>The <code>dtype</code> is a dictionary with column names as keys and data types as values:<div class=highlight><pre><span></span><code><a href=#__codelineno-5-1 id=__codelineno-5-1 name=__codelineno-5-1></a>dtype = {
<a href=#__codelineno-5-2 id=__codelineno-5-2 name=__codelineno-5-2></a>    'id': 'Integer',
<a href=#__codelineno-5-3 id=__codelineno-5-3 name=__codelineno-5-3></a>    'Name': 'Unicode',
<a href=#__codelineno-5-4 id=__codelineno-5-4 name=__codelineno-5-4></a>    'price': 'DECIMAL',
<a href=#__codelineno-5-5 id=__codelineno-5-5 name=__codelineno-5-5></a>    'start_date': 'DateTime',
<a href=#__codelineno-5-6 id=__codelineno-5-6 name=__codelineno-5-6></a>}
</code></pre></div><p>Note that the items in <code>query.statement.selected_columns</code> can have different types, such as:<ul><li><p><class 'sqlalchemy.sql.elements.label'> <li><p><class 'sqlalchemy.sql.elements.cast'> <li><p><class 'sqlalchemy.sql.annotation.annotatedcolumn'> <p>The <code>Cast</code> class is from the <code>sql.func.cast</code> function:</p> <div class=highlight><pre><span></span><code><a href=#__codelineno-6-1 id=__codelineno-6-1 name=__codelineno-6-1></a><span class=n>query</span> <span class=o>=</span> <span class=n>session</span><span class=o>.</span><span class=n>query</span><span class=p>(</span>
<a href=#__codelineno-6-2 id=__codelineno-6-2 name=__codelineno-6-2></a>    <span class=n>sql</span><span class=o>.</span><span class=n>func</span><span class=o>.</span><span class=n>cast</span><span class=p>(</span><span class=n>sp</span><span class=o>.</span><span class=n>Price</span><span class=p>,</span> <span class=n>types</span><span class=o>.</span><span class=n>Float</span><span class=p>),</span>
<a href=#__codelineno-6-3 id=__codelineno-6-3 name=__codelineno-6-3></a><span class=p>)</span>
</code></pre></div> <p>However, the <code>Cast</code> class does not have the <code>name</code> property. To fix the issue we have to convert the <code>Cast</code> column to a <code>Lable</code> column:</p> <div class=highlight><pre><span></span><code><a href=#__codelineno-7-1 id=__codelineno-7-1 name=__codelineno-7-1></a><span class=n>query</span> <span class=o>=</span> <span class=n>session</span><span class=o>.</span><span class=n>query</span><span class=p>(</span>
<a href=#__codelineno-7-2 id=__codelineno-7-2 name=__codelineno-7-2></a>    <span class=n>sql</span><span class=o>.</span><span class=n>func</span><span class=o>.</span><span class=n>cast</span><span class=p>(</span><span class=n>sp</span><span class=o>.</span><span class=n>Price</span><span class=p>,</span> <span class=n>types</span><span class=o>.</span><span class=n>Float</span><span class=p>)</span><span class=o>.</span><span class=n>label</span><span class=p>(</span><span class=s1>'price'</span><span class=p>),</span>
<a href=#__codelineno-7-3 id=__codelineno-7-3 name=__codelineno-7-3></a><span class=p>)</span>
</code></pre></div> <h2 id=pass-the-data-type-information-to-pdread_sql>Pass the data type information to <code>pd.read_sql</code><a title="Permanent link" class=headerlink href=#pass-the-data-type-information-to-pdread_sql>¶</a></h2> <p>There is a parameter <code>dtype</code> in <code>pandas.read_sql(..., dtype=None)</code> that can be used to pass the data types for the query results.</p> <p>Note that in the previous section the extracted data types are the types defined in <code>sqlalchemy</code>. We need to convert them to the types that can be used in <code>pandas</code>. Here we provide a mapping for most of the data types:<div class=highlight><pre><span></span><code><a href=#__codelineno-8-1 id=__codelineno-8-1 name=__codelineno-8-1></a><span class=n>sa_to_pd_dtype</span> <span class=o>=</span> <span class=p>{</span>
<a href=#__codelineno-8-2 id=__codelineno-8-2 name=__codelineno-8-2></a>    <span class=s1>'BigInteger'</span><span class=p>:</span> <span class=s1>'int64'</span><span class=p>,</span>
<a href=#__codelineno-8-3 id=__codelineno-8-3 name=__codelineno-8-3></a>    <span class=s1>'BIT'</span><span class=p>:</span> <span class=s1>'bool'</span><span class=p>,</span>
<a href=#__codelineno-8-4 id=__codelineno-8-4 name=__codelineno-8-4></a>    <span class=s1>'Boolean'</span><span class=p>:</span> <span class=s1>'bool'</span><span class=p>,</span>
<a href=#__codelineno-8-5 id=__codelineno-8-5 name=__codelineno-8-5></a>    <span class=s1>'Date'</span><span class=p>:</span> <span class=s1>'datetime64[ns]'</span><span class=p>,</span>
<a href=#__codelineno-8-6 id=__codelineno-8-6 name=__codelineno-8-6></a>    <span class=s1>'DateTime'</span><span class=p>:</span> <span class=s1>'datetime64[ns]'</span><span class=p>,</span>
<a href=#__codelineno-8-7 id=__codelineno-8-7 name=__codelineno-8-7></a>    <span class=s1>'DECIMAL'</span><span class=p>:</span> <span class=s1>'float'</span><span class=p>,</span>
<a href=#__codelineno-8-8 id=__codelineno-8-8 name=__codelineno-8-8></a>    <span class=s1>'Enum'</span><span class=p>:</span> <span class=s1>'category'</span><span class=p>,</span>
<a href=#__codelineno-8-9 id=__codelineno-8-9 name=__codelineno-8-9></a>    <span class=s1>'Float'</span><span class=p>:</span> <span class=s1>'float'</span><span class=p>,</span>
<a href=#__codelineno-8-10 id=__codelineno-8-10 name=__codelineno-8-10></a>    <span class=s1>'Integer'</span><span class=p>:</span> <span class=s1>'int64'</span><span class=p>,</span>
<a href=#__codelineno-8-11 id=__codelineno-8-11 name=__codelineno-8-11></a>    <span class=s1>'Interval'</span><span class=p>:</span> <span class=s1>'timedelta64'</span><span class=p>,</span>
<a href=#__codelineno-8-12 id=__codelineno-8-12 name=__codelineno-8-12></a>    <span class=s1>'LargeBinary'</span><span class=p>:</span> <span class=s1>'str'</span><span class=p>,</span>
<a href=#__codelineno-8-13 id=__codelineno-8-13 name=__codelineno-8-13></a>    <span class=s1>'Numeric'</span><span class=p>:</span> <span class=s1>'float'</span><span class=p>,</span>
<a href=#__codelineno-8-14 id=__codelineno-8-14 name=__codelineno-8-14></a>    <span class=s1>'SmallInteger'</span><span class=p>:</span> <span class=s1>'int16'</span><span class=p>,</span>
<a href=#__codelineno-8-15 id=__codelineno-8-15 name=__codelineno-8-15></a>    <span class=s1>'String'</span><span class=p>:</span> <span class=s1>'str'</span><span class=p>,</span>
<a href=#__codelineno-8-16 id=__codelineno-8-16 name=__codelineno-8-16></a>    <span class=s1>'Time'</span><span class=p>:</span> <span class=s1>'datetime64[ns]'</span><span class=p>,</span>
<a href=#__codelineno-8-17 id=__codelineno-8-17 name=__codelineno-8-17></a>    <span class=s1>'TIMESTAMP'</span><span class=p>:</span> <span class=s1>'datetime64[ns]'</span><span class=p>,</span>
<a href=#__codelineno-8-18 id=__codelineno-8-18 name=__codelineno-8-18></a>    <span class=s1>'Unicode'</span><span class=p>:</span> <span class=s1>'str'</span><span class=p>,</span>
<a href=#__codelineno-8-19 id=__codelineno-8-19 name=__codelineno-8-19></a><span class=p>}</span>
</code></pre></div> <p>And we set the data types when extracting the data using <code>pd.read_sql</code>:<div class=highlight><pre><span></span><code><a href=#__codelineno-9-1 id=__codelineno-9-1 name=__codelineno-9-1></a><span class=n>dtype</span> <span class=o>=</span> <span class=p>{</span>
<a href=#__codelineno-9-2 id=__codelineno-9-2 name=__codelineno-9-2></a>    <span class=n>col</span><span class=p>:</span> <span class=n>sa_to_pd_dtype</span><span class=p>[</span><span class=n>typ</span><span class=p>]</span>
<a href=#__codelineno-9-3 id=__codelineno-9-3 name=__codelineno-9-3></a>    <span class=k>for</span> <span class=n>col</span><span class=p>,</span> <span class=n>typ</span> <span class=ow>in</span> <span class=n>dtype</span><span class=o>.</span><span class=n>items</span><span class=p>()</span>
<a href=#__codelineno-9-4 id=__codelineno-9-4 name=__codelineno-9-4></a>    <span class=k>if</span> <span class=n>typ</span> <span class=ow>in</span> <span class=n>sa_to_pd_dtype</span>
<a href=#__codelineno-9-5 id=__codelineno-9-5 name=__codelineno-9-5></a><span class=p>}</span>
<a href=#__codelineno-9-6 id=__codelineno-9-6 name=__codelineno-9-6></a><span class=n>df</span> <span class=o>=</span> <span class=n>pd</span><span class=o>.</span><span class=n>read_sql</span><span class=p>(</span><span class=o>...</span><span class=p>,</span> <span class=n>dtype</span><span class=o>=</span><span class=n>dtype</span><span class=p>)</span>
</code></pre></div> <h2 id=why-did-i-get-nulltype-for-some-data-columns>Why did I get <code>NullType</code> for some data columns?<a title="Permanent link" class=headerlink href=#why-did-i-get-nulltype-for-some-data-columns>¶</a></h2> <p>Assume the previous query has been changed to:<div class=highlight><pre><span></span><code><a href=#__codelineno-10-1 id=__codelineno-10-1 name=__codelineno-10-1></a><span class=n>query</span> <span class=o>=</span> <span class=n>session</span><span class=o>.</span><span class=n>query</span><span class=p>(</span>
<a href=#__codelineno-10-2 id=__codelineno-10-2 name=__codelineno-10-2></a>    <span class=n>sp</span><span class=o>.</span><span class=n>ID</span><span class=o>.</span><span class=n>label</span><span class=p>(</span><span class=s1>'id'</span><span class=p>),</span>
<a href=#__codelineno-10-3 id=__codelineno-10-3 name=__codelineno-10-3></a>    <span class=n>sp</span><span class=o>.</span><span class=n>Name</span><span class=o>.</span><span class=n>label</span><span class=p>(</span><span class=s1>'name'</span><span class=p>),</span>
<a href=#__codelineno-10-4 id=__codelineno-10-4 name=__codelineno-10-4></a>    <span class=n>sp</span><span class=o>.</span><span class=n>Price</span><span class=o>.</span><span class=n>label</span><span class=p>(</span><span class=s1>'price'</span><span class=p>),</span>
<a href=#__codelineno-10-5 id=__codelineno-10-5 name=__codelineno-10-5></a>    <span class=n>sql</span><span class=o>.</span><span class=n>func</span><span class=o>.</span><span class=n>dateadd</span><span class=p>(</span>
<a href=#__codelineno-10-6 id=__codelineno-10-6 name=__codelineno-10-6></a>        <span class=n>sql</span><span class=o>.</span><span class=n>text</span><span class=p>(</span><span class=s1>'day'</span><span class=p>),</span> <span class=mi>1</span><span class=p>,</span> <span class=n>sp</span><span class=o>.</span><span class=n>StartDate</span>
<a href=#__codelineno-10-7 id=__codelineno-10-7 name=__codelineno-10-7></a>    <span class=p>)</span><span class=o>.</span><span class=n>label</span><span class=p>(</span><span class=s1>'actual_start_date'</span><span class=p>),</span>
<a href=#__codelineno-10-8 id=__codelineno-10-8 name=__codelineno-10-8></a><span class=p>)</span>
</code></pre></div> In this case, the data type for the column <code>actual_start_date</code> will be <code>NullType</code> instead of <code>DateTime</code>. <p>By digging into the <code>sqlalchemy</code> documents we find out that this is caused by the <code>sql.func.dateadd</code>. Basically for functions that are not known, the type defaults to the <code>NullType</code>. There are also other functions such as <code>sql.func.rtrim</code>, <code>sql.func.replace</code>, <code>sql.func.year</code>, <code>sql.func.avg</code> and <code>sql.func.round</code> that might lead to the <code>NullType</code>.</p> <p>To fix the issue, we need to pass the data type directly to the function:<div class=highlight><pre><span></span><code><a href=#__codelineno-11-1 id=__codelineno-11-1 name=__codelineno-11-1></a><span class=n>sql</span><span class=o>.</span><span class=n>func</span><span class=o>.</span><span class=n>dateadd</span><span class=p>(</span>
<a href=#__codelineno-11-2 id=__codelineno-11-2 name=__codelineno-11-2></a>    <span class=n>sql</span><span class=o>.</span><span class=n>text</span><span class=p>(</span><span class=s1>'day'</span><span class=p>),</span> <span class=mi>1</span><span class=p>,</span> <span class=n>sp</span><span class=o>.</span><span class=n>StartDate</span><span class=p>,</span> <span class=n>type_</span><span class=o>=</span><span class=n>types</span><span class=o>.</span><span class=n>DateTime</span>
<a href=#__codelineno-11-3 id=__codelineno-11-3 name=__codelineno-11-3></a><span class=p>)</span><span class=o>.</span><span class=n>label</span><span class=p>(</span><span class=s1>'actual_start_date'</span><span class=p>)</span>
</code></pre></div> <h2 id=reference>Reference<a title="Permanent link" class=headerlink href=#reference>¶</a></h2> <ul><li><p><a href=https://stackoverflow.com/questions/64761911/sqlalchemy-accessing-column-types-from-query-results>SQLAlchemy accessing column types from query results</a></p><li><p><a href=https://stackoverflow.com/questions/2258072/sqlalchemy-getting-column-data-types-of-query-results>SQLAlchemy getting column data types of query results</a></p><li><p><a href=https://docs.sqlalchemy.org/en/gerrit/3941/core/functions.html>SQL and Generic Functions</a></p></ul> <script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script> <button class="md-top md-icon" data-md-component=top hidden type=button><svg viewbox="0 0 24 24" xmlns=http://www.w3.org/2000/svg><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg> Back to top</button> <footer class=md-footer><div class="md-footer-meta md-typeset"><div class="md-footer-meta__inner md-grid"><div class=md-copyright><div class=md-copyright__highlight><a title="Go to Main Home Page" href=/>🏠 Back to Home</a><br> Copyright © 2026 Sean Ma <br>Last updated on 17 Jan 2026</div> Made with <a href=https://squidfunk.github.io/mkdocs-material/ rel=noopener target=_blank> Material for MkDocs </a></div></div></div></footer> <div class=md-dialog data-md-component=dialog><div class="md-dialog__inner md-typeset"></div></div> <script id=__config type=application/json>{"base": "../../..", "features": ["navigation.tabs", "navigation.expand", "navigation.indexes", "navigation.top", "toc.follow", "search.suggest", "search.highlight", "content.code.copy", "navigation.prune"], "search": "../../../assets/javascripts/workers/search.d50fe291.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script> <script src=../../../assets/javascripts/bundle.56ea9cef.min.js></script> 