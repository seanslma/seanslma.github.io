<!doctype html><html class=no-js lang=en><meta charset=utf-8><meta content="width=device-width,initial-scale=1" name=viewport><link href=https://seanslma.github.io/maki/Python/SQL/DuckDB/ rel=canonical><link href=../Access/ rel=prev><link href=../MySQL/ rel=next><link href=../../../assets/images/favicon.png rel=icon><meta content="mkdocs-1.6.1, mkdocs-material-9.6.15" name=generator><title>DuckDB - maki</title><link href=../../../assets/stylesheets/main.342714a4.min.css rel=stylesheet><link href=../../../assets/stylesheets/palette.06af60db.min.css rel=stylesheet><link crossorigin href=https://fonts.gstatic.com rel=preconnect><link href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback" rel=stylesheet><style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style><link href=../../../stylesheets/extra.css rel=stylesheet><script>__md_scope=new URL(`../../..`,location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+`.`+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+`.`+e,JSON.stringify(_))}catch{}};</script><body data-md-color-accent=indigo data-md-color-primary=indigo data-md-color-scheme=default dir=ltr><input autocomplete=off class=md-toggle data-md-toggle=drawer id=__drawer type=checkbox><input autocomplete=off class=md-toggle data-md-toggle=search id=__search type=checkbox><label class=md-overlay for=__drawer></label><div data-md-component=skip><a class=md-skip href=#duckdb> Skip to content </a></div><div data-md-component=announce></div><header class=md-header data-md-component=header><nav class="md-header__inner md-grid" aria-label=Header><a class="md-header__button md-logo" aria-label=maki data-md-component=logo href=../../.. title=maki> <svg viewbox="0 0 24 24" xmlns=http://www.w3.org/2000/svg><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg> </a><label class="md-header__button md-icon" for=__drawer><svg viewbox="0 0 24 24" xmlns=http://www.w3.org/2000/svg><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg></label><div class=md-header__title data-md-component=header-title><div class=md-header__ellipsis><div class=md-header__topic><span class=md-ellipsis> maki </span></div><div class=md-header__topic data-md-component=header-topic><span class=md-ellipsis> DuckDB </span></div></div></div><form class=md-header__option data-md-component=palette><input aria-label="Switch to dark mode" class=md-option data-md-color-accent=indigo data-md-color-media data-md-color-primary=indigo data-md-color-scheme=default id=__palette_0 name=__palette type=radio><label class="md-header__button md-icon" title="Switch to dark mode" for=__palette_1 hidden><svg viewbox="0 0 24 24" xmlns=http://www.w3.org/2000/svg><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg></label><input aria-label="Switch to light mode" class=md-option data-md-color-accent=indigo data-md-color-media data-md-color-primary=indigo data-md-color-scheme=slate id=__palette_1 name=__palette type=radio><label class="md-header__button md-icon" title="Switch to light mode" for=__palette_0 hidden><svg viewbox="0 0 24 24" xmlns=http://www.w3.org/2000/svg><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12s-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg></label></form><script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script><label class="md-header__button md-icon" for=__search><svg viewbox="0 0 24 24" xmlns=http://www.w3.org/2000/svg><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg></label><div class=md-search data-md-component=search role=dialog><label class=md-search__overlay for=__search></label><div class=md-search__inner role=search><form class=md-search__form name=search><input aria-label=Search autocapitalize=off autocomplete=off autocorrect=off class=md-search__input data-md-component=search-query name=query placeholder=Search required spellcheck=false><label class="md-search__icon md-icon" for=__search><svg viewbox="0 0 24 24" xmlns=http://www.w3.org/2000/svg><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg> <svg viewbox="0 0 24 24" xmlns=http://www.w3.org/2000/svg><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg></label><nav aria-label=Search class=md-search__options><button class="md-search__icon md-icon" aria-label=Clear tabindex=-1 title=Clear type=reset><svg viewbox="0 0 24 24" xmlns=http://www.w3.org/2000/svg><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg></button></nav><div class=md-search__suggest data-md-component=search-suggest></div></form><div class=md-search__output><div class=md-search__scrollwrap data-md-scrollfix tabindex=0><div class=md-search-result data-md-component=search-result><div class=md-search-result__meta>Initializing search</div><ol class=md-search-result__list role=presentation></ol></div></div></div></div></div><div class=md-header__source><a title="Go to repository" class=md-source data-md-component=source href=https://github.com/seanslma/maki> <div class="md-source__icon md-icon"><svg viewbox="0 0 448 512" xmlns=http://www.w3.org/2000/svg><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"/></svg></div> <div class=md-source__repository>GitHub</div> </a></div></nav></header><div class=md-container data-md-component=container><nav aria-label=Tabs class=md-tabs data-md-component=tabs><div class=md-grid><ul class=md-tabs__list><li class=md-tabs__item><a class=md-tabs__link href=../../..> About </a><li class=md-tabs__item><a class=md-tabs__link href=../../../AI/ChatGPT/> AI </a><li class=md-tabs__item><a class=md-tabs__link href=../../../AWS/CDN/> AWS </a><li class=md-tabs__item><a class=md-tabs__link href=../../../Azure/Advisor/> Azure </a><li class=md-tabs__item><a class=md-tabs__link href=../../../Coding/Notepad%2B%2B/> Coding </a><li class=md-tabs__item><a class=md-tabs__link href=../../../Cybersecurity/Cybersecurity/> Cybersecurity </a><li class=md-tabs__item><a class=md-tabs__link href=../../../Data/Data/> Data </a><li class=md-tabs__item><a class=md-tabs__link href=../../../DevOps/DevOps/> DevOps </a><li class=md-tabs__item><a class=md-tabs__link href=../../../Documentation/Jira/> Documentation </a><li class=md-tabs__item><a class=md-tabs__link href=../../../Energy/Inertia/> Energy </a><li class=md-tabs__item><a class=md-tabs__link href=../../../Learn/Book/> Learn </a><li class=md-tabs__item><a class=md-tabs__link href=../../../ML/Backtest/> ML </a><li class=md-tabs__item><a class=md-tabs__link href=../../../Optimizaton/Convex/> Optimizaton </a><li class=md-tabs__item><a class=md-tabs__link href=../../../PowerBI/Basic/> PowerBI </a><li class="md-tabs__item md-tabs__item--active"><a class=md-tabs__link href=../../Basic/> Python </a><li class=md-tabs__item><a class=md-tabs__link href=../../../SQL/Database/> SQL </a><li class=md-tabs__item><a class=md-tabs__link href=../../../System/Behavior/> System </a></ul></div></nav><main class=md-main data-md-component=main><div class="md-main__inner md-grid"><div class="md-sidebar md-sidebar--primary" data-md-component=sidebar data-md-type=navigation><div class=md-sidebar__scrollwrap><div class=md-sidebar__inner><nav class="md-nav md-nav--primary md-nav--lifted" aria-label=Navigation data-md-level=0><label class=md-nav__title for=__drawer><a class="md-nav__button md-logo" aria-label=maki data-md-component=logo href=../../.. title=maki> <svg viewbox="0 0 24 24" xmlns=http://www.w3.org/2000/svg><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg> </a> maki</label><div class=md-nav__source><a title="Go to repository" class=md-source data-md-component=source href=https://github.com/seanslma/maki> <div class="md-source__icon md-icon"><svg viewbox="0 0 448 512" xmlns=http://www.w3.org/2000/svg><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"/></svg></div> <div class=md-source__repository>GitHub</div> </a></div><ul class=md-nav__list data-md-scrollfix><li class=md-nav__item><a class=md-nav__link href=../../..> <span class=md-ellipsis> About </span> </a><li class="md-nav__item md-nav__item--pruned md-nav__item--nested"><a class=md-nav__link href=../../../AI/ChatGPT/> <span class=md-ellipsis> AI </span> <span class="md-nav__icon md-icon"></span> </a><li class="md-nav__item md-nav__item--pruned md-nav__item--nested"><a class=md-nav__link href=../../../AWS/CDN/> <span class=md-ellipsis> AWS </span> <span class="md-nav__icon md-icon"></span> </a><li class="md-nav__item md-nav__item--pruned md-nav__item--nested"><a class=md-nav__link href=../../../Azure/Advisor/> <span class=md-ellipsis> Azure </span> <span class="md-nav__icon md-icon"></span> </a><li class="md-nav__item md-nav__item--pruned md-nav__item--nested"><a class=md-nav__link href=../../../Coding/Notepad%2B%2B/> <span class=md-ellipsis> Coding </span> <span class="md-nav__icon md-icon"></span> </a><li class="md-nav__item md-nav__item--pruned md-nav__item--nested"><a class=md-nav__link href=../../../Cybersecurity/Cybersecurity/> <span class=md-ellipsis> Cybersecurity </span> <span class="md-nav__icon md-icon"></span> </a><li class="md-nav__item md-nav__item--pruned md-nav__item--nested"><a class=md-nav__link href=../../../Data/Data/> <span class=md-ellipsis> Data </span> <span class="md-nav__icon md-icon"></span> </a><li class="md-nav__item md-nav__item--pruned md-nav__item--nested"><a class=md-nav__link href=../../../DevOps/DevOps/> <span class=md-ellipsis> DevOps </span> <span class="md-nav__icon md-icon"></span> </a><li class="md-nav__item md-nav__item--pruned md-nav__item--nested"><a class=md-nav__link href=../../../Documentation/Jira/> <span class=md-ellipsis> Documentation </span> <span class="md-nav__icon md-icon"></span> </a><li class="md-nav__item md-nav__item--pruned md-nav__item--nested"><a class=md-nav__link href=../../../Energy/Inertia/> <span class=md-ellipsis> Energy </span> <span class="md-nav__icon md-icon"></span> </a><li class="md-nav__item md-nav__item--pruned md-nav__item--nested"><a class=md-nav__link href=../../../Learn/Book/> <span class=md-ellipsis> Learn </span> <span class="md-nav__icon md-icon"></span> </a><li class="md-nav__item md-nav__item--pruned md-nav__item--nested"><a class=md-nav__link href=../../../ML/Backtest/> <span class=md-ellipsis> ML </span> <span class="md-nav__icon md-icon"></span> </a><li class="md-nav__item md-nav__item--pruned md-nav__item--nested"><a class=md-nav__link href=../../../Optimizaton/Convex/> <span class=md-ellipsis> Optimizaton </span> <span class="md-nav__icon md-icon"></span> </a><li class="md-nav__item md-nav__item--pruned md-nav__item--nested"><a class=md-nav__link href=../../../PowerBI/Basic/> <span class=md-ellipsis> PowerBI </span> <span class="md-nav__icon md-icon"></span> </a><li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested"><input class="md-nav__toggle md-toggle" checked id=__nav_15 type=checkbox> <label class=md-nav__link for=__nav_15 id=__nav_15_label><span class=md-ellipsis> Python </span> <span class="md-nav__icon md-icon"></span></label> <nav aria-expanded=true aria-labelledby=__nav_15_label class=md-nav data-md-level=1><label class=md-nav__title for=__nav_15><span class="md-nav__icon md-icon"></span> Python</label><ul class=md-nav__list data-md-scrollfix><li class=md-nav__item><a class=md-nav__link href=../../Basic/> <span class=md-ellipsis> Basic </span> </a><li class=md-nav__item><a class=md-nav__link href=../../NaN/> <span class=md-ellipsis> NaN </span> </a><li class=md-nav__item><a class=md-nav__link href=../../Python/> <span class=md-ellipsis> Python </span> </a><li class="md-nav__item md-nav__item--pruned md-nav__item--nested"><a class=md-nav__link href=../../API/API/> <span class=md-ellipsis> API </span> <span class="md-nav__icon md-icon"></span> </a><li class="md-nav__item md-nav__item--pruned md-nav__item--nested"><a class=md-nav__link href=../../App/Module/> <span class=md-ellipsis> App </span> <span class="md-nav__icon md-icon"></span> </a><li class="md-nav__item md-nav__item--pruned md-nav__item--nested"><a class=md-nav__link href=../../Architect/Decorator/> <span class=md-ellipsis> Architect </span> <span class="md-nav__icon md-icon"></span> </a><li class="md-nav__item md-nav__item--pruned md-nav__item--nested"><a class=md-nav__link href=../../Async/Asyncio/> <span class=md-ellipsis> Async </span> <span class="md-nav__icon md-icon"></span> </a><li class="md-nav__item md-nav__item--pruned md-nav__item--nested"><a class=md-nav__link href=../../Blog/BestPractices/> <span class=md-ellipsis> Blog </span> <span class="md-nav__icon md-icon"></span> </a><li class="md-nav__item md-nav__item--pruned md-nav__item--nested"><a class=md-nav__link href=../../CLI/Click/> <span class=md-ellipsis> CLI </span> <span class="md-nav__icon md-icon"></span> </a><li class="md-nav__item md-nav__item--pruned md-nav__item--nested"><a class=md-nav__link href=../../Cache/Aiocache/> <span class=md-ellipsis> Cache </span> <span class="md-nav__icon md-icon"></span> </a><li class="md-nav__item md-nav__item--pruned md-nav__item--nested"><a class=md-nav__link href=../../Celery/Example/> <span class=md-ellipsis> Celery </span> <span class="md-nav__icon md-icon"></span> </a><li class="md-nav__item md-nav__item--pruned md-nav__item--nested"><a class=md-nav__link href=../../Class/ClassMethod/> <span class=md-ellipsis> Class </span> <span class="md-nav__icon md-icon"></span> </a><li class="md-nav__item md-nav__item--pruned md-nav__item--nested"><a class=md-nav__link href=../../Conda/Bashrc/> <span class=md-ellipsis> Conda </span> <span class="md-nav__icon md-icon"></span> </a><li class="md-nav__item md-nav__item--pruned md-nav__item--nested"><a class=md-nav__link href=../../Dash/Callback/> <span class=md-ellipsis> Dash </span> <span class="md-nav__icon md-icon"></span> </a><li class="md-nav__item md-nav__item--pruned md-nav__item--nested"><a class=md-nav__link href=../../Dask/Config/> <span class=md-ellipsis> Dask </span> <span class="md-nav__icon md-icon"></span> </a><li class="md-nav__item md-nav__item--pruned md-nav__item--nested"><a class=md-nav__link href=../../DataType/Dictionary/> <span class=md-ellipsis> DataType </span> <span class="md-nav__icon md-icon"></span> </a><li class="md-nav__item md-nav__item--pruned md-nav__item--nested"><a class=md-nav__link href=../../DateTime/Conversion/> <span class=md-ellipsis> DateTime </span> <span class="md-nav__icon md-icon"></span> </a><li class="md-nav__item md-nav__item--pruned md-nav__item--nested"><a class=md-nav__link href=../../Django/Django/> <span class=md-ellipsis> Django </span> <span class="md-nav__icon md-icon"></span> </a><li class="md-nav__item md-nav__item--pruned md-nav__item--nested"><a class=md-nav__link href=../../Email/ExchangeLib/> <span class=md-ellipsis> Email </span> <span class="md-nav__icon md-icon"></span> </a><li class="md-nav__item md-nav__item--pruned md-nav__item--nested"><a class=md-nav__link href=../../Env/Env/> <span class=md-ellipsis> Env </span> <span class="md-nav__icon md-icon"></span> </a><li class="md-nav__item md-nav__item--pruned md-nav__item--nested"><a class=md-nav__link href=../../ErrorHandling/Exception/> <span class=md-ellipsis> ErrorHandling </span> <span class="md-nav__icon md-icon"></span> </a><li class="md-nav__item md-nav__item--pruned md-nav__item--nested"><a class=md-nav__link href=../../Excel/Excel/> <span class=md-ellipsis> Excel </span> <span class="md-nav__icon md-icon"></span> </a><li class="md-nav__item md-nav__item--pruned md-nav__item--nested"><a class=md-nav__link href=../../Flask/Request/> <span class=md-ellipsis> Flask </span> <span class="md-nav__icon md-icon"></span> </a><li class="md-nav__item md-nav__item--pruned md-nav__item--nested"><a class=md-nav__link href=../../Format/Black/> <span class=md-ellipsis> Format </span> <span class="md-nav__icon md-icon"></span> </a><li class="md-nav__item md-nav__item--pruned md-nav__item--nested"><a class=md-nav__link href=../../Generator/Generator/> <span class=md-ellipsis> Generator </span> <span class="md-nav__icon md-icon"></span> </a><li class="md-nav__item md-nav__item--pruned md-nav__item--nested"><a class=md-nav__link href=../../IO/AzureBlob/> <span class=md-ellipsis> IO </span> <span class="md-nav__icon md-icon"></span> </a><li class="md-nav__item md-nav__item--pruned md-nav__item--nested"><a class=md-nav__link href=../../Issue/Main/> <span class=md-ellipsis> Issue </span> <span class="md-nav__icon md-icon"></span> </a><li class="md-nav__item md-nav__item--pruned md-nav__item--nested"><a class=md-nav__link href=../../Jupyter/Dashboard/> <span class=md-ellipsis> Jupyter </span> <span class="md-nav__icon md-icon"></span> </a><li class="md-nav__item md-nav__item--pruned md-nav__item--nested"><a class=md-nav__link href=../../Logging/AzureLibraries/> <span class=md-ellipsis> Logging </span> <span class="md-nav__icon md-icon"></span> </a><li class="md-nav__item md-nav__item--pruned md-nav__item--nested"><a class=md-nav__link href=../../MSOffice/Access/> <span class=md-ellipsis> MSOffice </span> <span class="md-nav__icon md-icon"></span> </a><li class="md-nav__item md-nav__item--pruned md-nav__item--nested"><a class=md-nav__link href=../../Math/Sparse/> <span class=md-ellipsis> Math </span> <span class="md-nav__icon md-icon"></span> </a><li class="md-nav__item md-nav__item--pruned md-nav__item--nested"><a class=md-nav__link href=../../NumPy/CSmooth/> <span class=md-ellipsis> NumPy </span> <span class="md-nav__icon md-icon"></span> </a><li class="md-nav__item md-nav__item--pruned md-nav__item--nested"><a class=md-nav__link href=../../Package/CondaBuild/> <span class=md-ellipsis> Package </span> <span class="md-nav__icon md-icon"></span> </a><li class="md-nav__item md-nav__item--pruned md-nav__item--nested"><a class=md-nav__link href=../../Pandas/Advance/> <span class=md-ellipsis> Pandas </span> <span class="md-nav__icon md-icon"></span> </a><li class="md-nav__item md-nav__item--pruned md-nav__item--nested"><a class=md-nav__link href=../../PandasUpgradeTest/Datetime/> <span class=md-ellipsis> PandasUpgradeTest </span> <span class="md-nav__icon md-icon"></span> </a><li class="md-nav__item md-nav__item--pruned md-nav__item--nested"><a class=md-nav__link href=../../Parallel/Example/> <span class=md-ellipsis> Parallel </span> <span class="md-nav__icon md-icon"></span> </a><li class="md-nav__item md-nav__item--pruned md-nav__item--nested"><a class=md-nav__link href=../../Performance/Deadlock/> <span class=md-ellipsis> Performance </span> <span class="md-nav__icon md-icon"></span> </a><li class="md-nav__item md-nav__item--pruned md-nav__item--nested"><a class=md-nav__link href=../../Pip/Pip/> <span class=md-ellipsis> Pip </span> <span class="md-nav__icon md-icon"></span> </a><li class="md-nav__item md-nav__item--pruned md-nav__item--nested"><a class=md-nav__link href=../../Polars/CSV/> <span class=md-ellipsis> Polars </span> <span class="md-nav__icon md-icon"></span> </a><li class="md-nav__item md-nav__item--pruned md-nav__item--nested"><a class=md-nav__link href=../../PyArrow/CSV/> <span class=md-ellipsis> PyArrow </span> <span class="md-nav__icon md-icon"></span> </a><li class="md-nav__item md-nav__item--pruned md-nav__item--nested"><a class=md-nav__link href=../../PySpark/Column/> <span class=md-ellipsis> PySpark </span> <span class="md-nav__icon md-icon"></span> </a><li class="md-nav__item md-nav__item--pruned md-nav__item--nested"><a class=md-nav__link href=../../Pytorch/Install/> <span class=md-ellipsis> Pytorch </span> <span class="md-nav__icon md-icon"></span> </a><li class="md-nav__item md-nav__item--pruned md-nav__item--nested"><a class=md-nav__link href=../../Regex/Regex/> <span class=md-ellipsis> Regex </span> <span class="md-nav__icon md-icon"></span> </a><li class="md-nav__item md-nav__item--active md-nav__item--nested"><input class="md-nav__toggle md-toggle" checked id=__nav_15_44 type=checkbox> <label class=md-nav__link for=__nav_15_44 id=__nav_15_44_label tabindex=0><span class=md-ellipsis> SQL </span> <span class="md-nav__icon md-icon"></span></label> <nav aria-expanded=true aria-labelledby=__nav_15_44_label class=md-nav data-md-level=2><label class=md-nav__title for=__nav_15_44><span class="md-nav__icon md-icon"></span> SQL</label><ul class=md-nav__list data-md-scrollfix><li class=md-nav__item><a class=md-nav__link href=../ADBC/> <span class=md-ellipsis> ADBC </span> </a><li class=md-nav__item><a class=md-nav__link href=../Access/> <span class=md-ellipsis> Access </span> </a><li class="md-nav__item md-nav__item--active"><input class="md-nav__toggle md-toggle" id=__toc type=checkbox> <label class="md-nav__link md-nav__link--active" for=__toc><span class=md-ellipsis> DuckDB </span> <span class="md-nav__icon md-icon"></span></label> <a class="md-nav__link md-nav__link--active" href=./> <span class=md-ellipsis> DuckDB </span> </a> <nav aria-label="Table of contents" class="md-nav md-nav--secondary"><label class=md-nav__title for=__toc><span class="md-nav__icon md-icon"></span> Table of contents</label><ul class=md-nav__list data-md-component=toc data-md-scrollfix><li class=md-nav__item><a class=md-nav__link href=#install> <span class=md-ellipsis> install </span> </a><li class=md-nav__item><a class=md-nav__link href=#python-api> <span class=md-ellipsis> python api </span> </a><li class=md-nav__item><a class=md-nav__link href=#connection> <span class=md-ellipsis> connection </span> </a><li class=md-nav__item><a class=md-nav__link href=#query> <span class=md-ellipsis> query </span> </a><li class=md-nav__item><a class=md-nav__link href=#pandas> <span class=md-ellipsis> pandas </span> </a><li class=md-nav__item><a class=md-nav__link href=#force-utc-timezone> <span class=md-ellipsis> force utc timezone </span> </a><li class=md-nav__item><a class=md-nav__link href=#register-vs-create-table-df-as-select-from-df> <span class=md-ellipsis> register vs CREATE TABLE df AS SELECT * FROM df </span> </a><li class=md-nav__item><a class=md-nav__link href=#performance> <span class=md-ellipsis> performance </span> </a></ul></nav><li class=md-nav__item><a class=md-nav__link href=../MySQL/> <span class=md-ellipsis> MySQL </span> </a><li class=md-nav__item><a class=md-nav__link href=../ODBC/> <span class=md-ellipsis> ODBC </span> </a><li class=md-nav__item><a class=md-nav__link href=../Oracle/> <span class=md-ellipsis> Oracle </span> </a><li class=md-nav__item><a class=md-nav__link href=../Postgre/> <span class=md-ellipsis> Postgre </span> </a><li class=md-nav__item><a class=md-nav__link href=../PyODBC/> <span class=md-ellipsis> PyODBC </span> </a></ul></nav><li class="md-nav__item md-nav__item--pruned md-nav__item--nested"><a class=md-nav__link href=../../SQLAlchemy/BindParam/> <span class=md-ellipsis> SQLAlchemy </span> <span class="md-nav__icon md-icon"></span> </a><li class="md-nav__item md-nav__item--pruned md-nav__item--nested"><a class=md-nav__link href=../../SSL/Cert/> <span class=md-ellipsis> SSL </span> <span class="md-nav__icon md-icon"></span> </a><li class="md-nav__item md-nav__item--pruned md-nav__item--nested"><a class=md-nav__link href=../../SciPy/SparseMatrix/> <span class=md-ellipsis> SciPy </span> <span class="md-nav__icon md-icon"></span> </a><li class="md-nav__item md-nav__item--pruned md-nav__item--nested"><a class=md-nav__link href=../../Serialization/Benchmark/> <span class=md-ellipsis> Serialization </span> <span class="md-nav__icon md-icon"></span> </a><li class="md-nav__item md-nav__item--pruned md-nav__item--nested"><a class=md-nav__link href=../../Tensorflow/Install/> <span class=md-ellipsis> Tensorflow </span> <span class="md-nav__icon md-icon"></span> </a><li class="md-nav__item md-nav__item--pruned md-nav__item--nested"><a class=md-nav__link href=../../Test/Caplog/> <span class=md-ellipsis> Test </span> <span class="md-nav__icon md-icon"></span> </a><li class="md-nav__item md-nav__item--pruned md-nav__item--nested"><a class=md-nav__link href=../../Typing/Tips/> <span class=md-ellipsis> Typing </span> <span class="md-nav__icon md-icon"></span> </a><li class="md-nav__item md-nav__item--pruned md-nav__item--nested"><a class=md-nav__link href=../../Visualization/Chart/> <span class=md-ellipsis> Visualization </span> <span class="md-nav__icon md-icon"></span> </a><li class="md-nav__item md-nav__item--pruned md-nav__item--nested"><a class=md-nav__link href=../../Web/Cherrypy/> <span class=md-ellipsis> Web </span> <span class="md-nav__icon md-icon"></span> </a></ul></nav><li class="md-nav__item md-nav__item--pruned md-nav__item--nested"><a class=md-nav__link href=../../../SQL/Database/> <span class=md-ellipsis> SQL </span> <span class="md-nav__icon md-icon"></span> </a><li class="md-nav__item md-nav__item--pruned md-nav__item--nested"><a class=md-nav__link href=../../../System/Behavior/> <span class=md-ellipsis> System </span> <span class="md-nav__icon md-icon"></span> </a></ul></nav></div></div></div><div class="md-sidebar md-sidebar--secondary" data-md-component=sidebar data-md-type=toc><div class=md-sidebar__scrollwrap><div class=md-sidebar__inner><nav aria-label="Table of contents" class="md-nav md-nav--secondary"><label class=md-nav__title for=__toc><span class="md-nav__icon md-icon"></span> Table of contents</label><ul class=md-nav__list data-md-component=toc data-md-scrollfix><li class=md-nav__item><a class=md-nav__link href=#install> <span class=md-ellipsis> install </span> </a><li class=md-nav__item><a class=md-nav__link href=#python-api> <span class=md-ellipsis> python api </span> </a><li class=md-nav__item><a class=md-nav__link href=#connection> <span class=md-ellipsis> connection </span> </a><li class=md-nav__item><a class=md-nav__link href=#query> <span class=md-ellipsis> query </span> </a><li class=md-nav__item><a class=md-nav__link href=#pandas> <span class=md-ellipsis> pandas </span> </a><li class=md-nav__item><a class=md-nav__link href=#force-utc-timezone> <span class=md-ellipsis> force utc timezone </span> </a><li class=md-nav__item><a class=md-nav__link href=#register-vs-create-table-df-as-select-from-df> <span class=md-ellipsis> register vs CREATE TABLE df AS SELECT * FROM df </span> </a><li class=md-nav__item><a class=md-nav__link href=#performance> <span class=md-ellipsis> performance </span> </a></ul></nav></div></div></div><div class=md-content data-md-component=content><article class="md-content__inner md-typeset"><h1 id=duckdb>DuckDB<a title="Permanent link" class=headerlink href=#duckdb>¶</a></h1><p>DuckDB is an in-process SQL OLAP database management system<p>When to use DuckDB<ul><li><p>Processing and storing tabular datasets, e.g. from CSV or Parquet files</p><li><p>Interactive data analysis, e.g. Joining & aggregate multiple large tables</p><li><p>Concurrent large changes, to multiple large tables, e.g. appending rows, adding/removing/updating columns</p><li><p>Large result set transfer to client</p></ul><p>When to not use DuckDB<ul><li><p>Non-rectangular data sets, e.g. graphs</p><li><p>High-volume transactional use cases (e.g. tracking orders in a webshop)</p><li><p>Large client/server installations for centralized enterprise data warehousing</p><li><p>Writing to a single database from multiple concurrent processes</p></ul><h2 id=install>install<a title="Permanent link" class=headerlink href=#install>¶</a></h2><div class=highlight><pre><span></span><code><a href=#__codelineno-0-1 id=__codelineno-0-1 name=__codelineno-0-1></a>mamba<span class=w> </span>install<span class=w> </span>python-duckdb<span class=w> </span>-y
</code></pre></div><h2 id=python-api>python api<a title="Permanent link" class=headerlink href=#python-api>¶</a></h2><p>https://duckdb.org/docs/api/python/overview.html<h2 id=connection>connection<a title="Permanent link" class=headerlink href=#connection>¶</a></h2><div class=highlight><pre><span></span><code><a href=#__codelineno-1-1 id=__codelineno-1-1 name=__codelineno-1-1></a><span class=kn>import</span><span class=w> </span><span class=nn>duckdb</span>
<a href=#__codelineno-1-2 id=__codelineno-1-2 name=__codelineno-1-2></a><span class=n>con</span> <span class=o>=</span> <span class=n>duckdb</span><span class=o>.</span><span class=n>connect</span><span class=p>(</span><span class=n>database</span><span class=o>=</span><span class=s1>':memory:'</span><span class=p>)</span> <span class=c1>#in-memory database</span>
<a href=#__codelineno-1-3 id=__codelineno-1-3 name=__codelineno-1-3></a><span class=n>con</span> <span class=o>=</span> <span class=n>duckdb</span><span class=o>.</span><span class=n>connect</span><span class=p>(</span><span class=n>database</span><span class=o>=</span><span class=s1>'my-db.duckdb'</span><span class=p>,</span> <span class=n>read_only</span><span class=o>=</span><span class=kc>False</span><span class=p>)</span> <span class=c1>#database file (not shared between processes)</span>
<a href=#__codelineno-1-4 id=__codelineno-1-4 name=__codelineno-1-4></a><span class=n>con</span> <span class=o>=</span> <span class=n>duckdb</span><span class=o>.</span><span class=n>connect</span><span class=p>(</span><span class=n>database</span><span class=o>=</span><span class=s1>'my-db.duckdb'</span><span class=p>,</span> <span class=n>read_only</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>  <span class=c1>#database file (shared between processes)</span>
</code></pre></div><h2 id=query>query<a title="Permanent link" class=headerlink href=#query>¶</a></h2><div class=highlight><pre><span></span><code><a href=#__codelineno-2-1 id=__codelineno-2-1 name=__codelineno-2-1></a><span class=n>con</span><span class=o>.</span><span class=n>execute</span><span class=p>(</span><span class=s2>"CREATE TABLE items(item VARCHAR, value DECIMAL(10,2), count INTEGER)"</span><span class=p>)</span>
<a href=#__codelineno-2-2 id=__codelineno-2-2 name=__codelineno-2-2></a><span class=n>con</span><span class=o>.</span><span class=n>execute</span><span class=p>(</span><span class=s2>"INSERT INTO items VALUES ('jeans', 20.0, 1), ('hammer', 42.2, 2)"</span><span class=p>)</span>
<a href=#__codelineno-2-3 id=__codelineno-2-3 name=__codelineno-2-3></a>
<a href=#__codelineno-2-4 id=__codelineno-2-4 name=__codelineno-2-4></a><span class=n>con</span><span class=o>.</span><span class=n>execute</span><span class=p>(</span><span class=s2>"SELECT * FROM items"</span><span class=p>)</span>
<a href=#__codelineno-2-5 id=__codelineno-2-5 name=__codelineno-2-5></a><span class=nb>print</span><span class=p>(</span><span class=n>con</span><span class=o>.</span><span class=n>fetchall</span><span class=p>())</span>
<a href=#__codelineno-2-6 id=__codelineno-2-6 name=__codelineno-2-6></a><span class=c1># [('jeans', 20.0, 1), ('hammer', 42.2, 2)]</span>
<a href=#__codelineno-2-7 id=__codelineno-2-7 name=__codelineno-2-7></a>
<a href=#__codelineno-2-8 id=__codelineno-2-8 name=__codelineno-2-8></a><span class=n>con</span><span class=o>.</span><span class=n>execute</span><span class=p>(</span><span class=s2>"INSERT INTO items VALUES (?, ?, ?)"</span><span class=p>,</span> <span class=p>[</span><span class=s1>'laptop'</span><span class=p>,</span> <span class=mi>2000</span><span class=p>,</span> <span class=mi>1</span><span class=p>])</span>
<a href=#__codelineno-2-9 id=__codelineno-2-9 name=__codelineno-2-9></a><span class=n>con</span><span class=o>.</span><span class=n>executemany</span><span class=p>(</span><span class=s2>"INSERT INTO items VALUES (?, ?, ?)"</span><span class=p>,</span> <span class=p>[[</span><span class=s1>'chainsaw'</span><span class=p>,</span> <span class=mi>500</span><span class=p>,</span> <span class=mi>10</span><span class=p>],</span> <span class=p>[</span><span class=s1>'iphone'</span><span class=p>,</span> <span class=mi>300</span><span class=p>,</span> <span class=mi>2</span><span class=p>]]</span> <span class=p>)</span>
<a href=#__codelineno-2-10 id=__codelineno-2-10 name=__codelineno-2-10></a><span class=n>con</span><span class=o>.</span><span class=n>execute</span><span class=p>(</span><span class=s2>"SELECT item FROM items WHERE value > ?"</span><span class=p>,</span> <span class=p>[</span><span class=mi>400</span><span class=p>])</span>
</code></pre></div><h2 id=pandas>pandas<a title="Permanent link" class=headerlink href=#pandas>¶</a></h2><div class=highlight><pre><span></span><code><a href=#__codelineno-3-1 id=__codelineno-3-1 name=__codelineno-3-1></a><span class=kn>import</span><span class=w> </span><span class=nn>pandas</span><span class=w> </span><span class=k>as</span><span class=w> </span><span class=nn>pd</span>
<a href=#__codelineno-3-2 id=__codelineno-3-2 name=__codelineno-3-2></a><span class=n>con</span><span class=o>.</span><span class=n>register</span><span class=p>(</span><span class=s1>'df_view'</span><span class=p>,</span> <span class=n>df</span><span class=p>)</span>
<a href=#__codelineno-3-3 id=__codelineno-3-3 name=__codelineno-3-3></a><span class=n>con</span><span class=o>.</span><span class=n>execute</span><span class=p>(</span><span class=s1>'SELECT * FROM df_view'</span><span class=p>)</span>
<a href=#__codelineno-3-4 id=__codelineno-3-4 name=__codelineno-3-4></a><span class=n>con</span><span class=o>.</span><span class=n>fetchall</span><span class=p>()</span>
<a href=#__codelineno-3-5 id=__codelineno-3-5 name=__codelineno-3-5></a>
<a href=#__codelineno-3-6 id=__codelineno-3-6 name=__codelineno-3-6></a><span class=c1># fetch as pandas data frame</span>
<a href=#__codelineno-3-7 id=__codelineno-3-7 name=__codelineno-3-7></a><span class=n>df</span> <span class=o>=</span> <span class=n>con</span><span class=o>.</span><span class=n>execute</span><span class=p>(</span><span class=s2>"SELECT * FROM items"</span><span class=p>)</span><span class=o>.</span><span class=n>fetchdf</span><span class=p>()</span>
<a href=#__codelineno-3-8 id=__codelineno-3-8 name=__codelineno-3-8></a><span class=c1># fetch as dictionary of numpy arrays</span>
<a href=#__codelineno-3-9 id=__codelineno-3-9 name=__codelineno-3-9></a><span class=n>arr</span> <span class=o>=</span> <span class=n>con</span><span class=o>.</span><span class=n>execute</span><span class=p>(</span><span class=s2>"SELECT * FROM items"</span><span class=p>)</span><span class=o>.</span><span class=n>fetchnumpy</span><span class=p>()</span>
</code></pre></div><h2 id=force-utc-timezone>force utc timezone<a title="Permanent link" class=headerlink href=#force-utc-timezone>¶</a></h2><p>otherwize <code>datetime64[us, UTC]</code> will be converted to local timezone such as <code>datetime64[us, Australia/Brisbane]</code><div class=highlight><pre><span></span><code><a href=#__codelineno-4-1 id=__codelineno-4-1 name=__codelineno-4-1></a><span class=n>conn</span><span class=o>.</span><span class=n>execute</span><span class=p>(</span><span class=s2>"SET timezone = 'UTC'"</span><span class=p>)</span>  <span class=c1># Force UTC timezone in DuckDB</span>
<a href=#__codelineno-4-2 id=__codelineno-4-2 name=__codelineno-4-2></a><span class=n>conn</span><span class=o>.</span><span class=n>register</span><span class=p>(</span><span class=s2>"delta_table"</span><span class=p>,</span> <span class=n>delta_table</span><span class=p>)</span> <span class=c1># Register as a view</span>
</code></pre></div><h2 id=register-vs-create-table-df-as-select-from-df><code>register</code> vs <code>CREATE TABLE df AS SELECT * FROM df</code><a title="Permanent link" class=headerlink href=#register-vs-create-table-df-as-select-from-df>¶</a></h2><div class=highlight><pre><span></span><code><a href=#__codelineno-5-1 id=__codelineno-5-1 name=__codelineno-5-1></a><span class=n>con</span> <span class=o>=</span> <span class=n>duckdb</span><span class=o>.</span><span class=n>connect</span><span class=p>(</span><span class=s1>':memory:'</span><span class=p>)</span>
<a href=#__codelineno-5-2 id=__codelineno-5-2 name=__codelineno-5-2></a><span class=n>con</span><span class=o>.</span><span class=n>register</span><span class=p>(</span><span class=s1>'df'</span><span class=p>,</span> <span class=n>df</span><span class=p>)</span>
<a href=#__codelineno-5-3 id=__codelineno-5-3 name=__codelineno-5-3></a><span class=n>con</span><span class=o>.</span><span class=n>execute</span><span class=p>(</span><span class=s2>"CREATE TABLE my_table AS SELECT * FROM df"</span><span class=p>)</span>
</code></pre></div><p><strong><code>duckdb.register('df', df)</code>:</strong><ul><li><p><strong>Registers a virtual table:</strong> Makes a DataFrame accessible within DuckDB without physically copying data.</p><li><p><strong>No persistence:</strong> Virtual table disappears when DuckDB connection closes.</p><li><p><strong>Query-only:</strong> Changes to the virtual table don't affect the original DataFrame.</p><li><p><strong>Ideal for:</strong> Quick queries and exploration without data duplication.</p></ul><p><strong><code>conn.execute("CREATE TABLE df AS SELECT * FROM df")</code>:</strong><ul><li><p><strong>Creates a persistent table:</strong> Stores data physically in DuckDB's database.</p><li><p><strong>Data copied:</strong> Data is copied from the DataFrame into DuckDB's storage.</p><li><p><strong>Independent table:</strong> Changes to the table within DuckDB don't affect the original DataFrame.</p><li><p><strong>Ideal for:</strong> Persisting data, complex queries, sharing data across sessions.</p></ul><h2 id=performance>performance<a title="Permanent link" class=headerlink href=#performance>¶</a></h2><p>have some data (e.g., NEM demand data for different generators and days/intervals). Now there are some new data that can be either updated demand or demand in new days. We need update/insert the new data into the original data.<p>In this case, will it be faster by using duckdb to hold the original data then upsert the new data to duckdb, compared to directly using pandas? write the code to test it!<p>For a parquet file about 10MB, the pandas code is 2-3x faster compared to duckdb.<p><strong>pandas outer merge</strong><div class=highlight><pre><span></span><code><a href=#__codelineno-6-1 id=__codelineno-6-1 name=__codelineno-6-1></a><span class=c1># %%timeit</span>
<a href=#__codelineno-6-2 id=__codelineno-6-2 name=__codelineno-6-2></a><span class=c1># Merge DataFrames, prioritizing df2's values</span>
<a href=#__codelineno-6-3 id=__codelineno-6-3 name=__codelineno-6-3></a><span class=n>df</span> <span class=o>=</span> <span class=n>pd</span><span class=o>.</span><span class=n>merge</span><span class=p>(</span><span class=n>d1</span><span class=p>,</span> <span class=n>d3</span><span class=p>,</span> <span class=n>how</span><span class=o>=</span><span class=s1>'outer'</span><span class=p>,</span> <span class=n>on</span><span class=o>=</span><span class=n>d1</span><span class=o>.</span><span class=n>index</span><span class=o>.</span><span class=n>names</span><span class=p>,</span> <span class=n>suffixes</span><span class=o>=</span><span class=p>(</span><span class=s1>''</span><span class=p>,</span> <span class=s1>'_update'</span><span class=p>))</span>
<a href=#__codelineno-6-4 id=__codelineno-6-4 name=__codelineno-6-4></a>
<a href=#__codelineno-6-5 id=__codelineno-6-5 name=__codelineno-6-5></a><span class=c1># Update sales_amount where values are present in df2</span>
<a href=#__codelineno-6-6 id=__codelineno-6-6 name=__codelineno-6-6></a><span class=n>cols_update</span> <span class=o>=</span> <span class=p>[]</span>
<a href=#__codelineno-6-7 id=__codelineno-6-7 name=__codelineno-6-7></a><span class=k>for</span> <span class=n>col</span> <span class=ow>in</span> <span class=n>d1</span><span class=o>.</span><span class=n>columns</span><span class=p>:</span>
<a href=#__codelineno-6-8 id=__codelineno-6-8 name=__codelineno-6-8></a>    <span class=n>col_update</span> <span class=o>=</span> <span class=sa>f</span><span class=s1>'</span><span class=si>{</span><span class=n>col</span><span class=si>}</span><span class=s1>_update'</span>
<a href=#__codelineno-6-9 id=__codelineno-6-9 name=__codelineno-6-9></a>    <span class=n>cols_update</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>col_update</span><span class=p>)</span>
<a href=#__codelineno-6-10 id=__codelineno-6-10 name=__codelineno-6-10></a>    <span class=n>df</span><span class=p>[</span><span class=n>col</span><span class=p>]</span> <span class=o>=</span> <span class=n>df</span><span class=p>[</span><span class=n>col_update</span><span class=p>]</span><span class=o>.</span><span class=n>fillna</span><span class=p>(</span><span class=n>df</span><span class=p>[</span><span class=n>col</span><span class=p>])</span>
<a href=#__codelineno-6-11 id=__codelineno-6-11 name=__codelineno-6-11></a>
<a href=#__codelineno-6-12 id=__codelineno-6-12 name=__codelineno-6-12></a><span class=c1># Drop unnecessary columns</span>
<a href=#__codelineno-6-13 id=__codelineno-6-13 name=__codelineno-6-13></a><span class=n>df1</span> <span class=o>=</span> <span class=n>df</span><span class=o>.</span><span class=n>drop</span><span class=p>(</span><span class=n>columns</span><span class=o>=</span><span class=n>cols_update</span><span class=p>)</span>
</code></pre></div><p><strong>duckdb upsert</strong>: cannot register d1 as a virtual table because it will be modified<div class=highlight><pre><span></span><code><a href=#__codelineno-7-1 id=__codelineno-7-1 name=__codelineno-7-1></a><span class=c1># %%timeit</span>
<a href=#__codelineno-7-2 id=__codelineno-7-2 name=__codelineno-7-2></a><span class=c1># Connect to a DuckDB database</span>
<a href=#__codelineno-7-3 id=__codelineno-7-3 name=__codelineno-7-3></a><span class=n>conn</span> <span class=o>=</span> <span class=n>duckdb</span><span class=o>.</span><span class=n>connect</span><span class=p>()</span>
<a href=#__codelineno-7-4 id=__codelineno-7-4 name=__codelineno-7-4></a>
<a href=#__codelineno-7-5 id=__codelineno-7-5 name=__codelineno-7-5></a><span class=c1># Load DataFrames into DuckDB</span>
<a href=#__codelineno-7-6 id=__codelineno-7-6 name=__codelineno-7-6></a><span class=n>d1t</span> <span class=o>=</span> <span class=n>d1</span><span class=o>.</span><span class=n>reset_index</span><span class=p>()</span>
<a href=#__codelineno-7-7 id=__codelineno-7-7 name=__codelineno-7-7></a><span class=n>conn</span><span class=o>.</span><span class=n>execute</span><span class=p>(</span><span class=s1>'CREATE TABLE d1 AS SELECT * FROM d1t'</span><span class=p>)</span>
<a href=#__codelineno-7-8 id=__codelineno-7-8 name=__codelineno-7-8></a><span class=n>conn</span><span class=o>.</span><span class=n>register</span><span class=p>(</span><span class=s1>'d2'</span><span class=p>,</span> <span class=n>d3</span><span class=o>.</span><span class=n>reset_index</span><span class=p>())</span>
<a href=#__codelineno-7-9 id=__codelineno-7-9 name=__codelineno-7-9></a>
<a href=#__codelineno-7-10 id=__codelineno-7-10 name=__codelineno-7-10></a><span class=c1># Perform the upsert using SQL</span>
<a href=#__codelineno-7-11 id=__codelineno-7-11 name=__codelineno-7-11></a><span class=n>id_cols</span> <span class=o>=</span> <span class=s1>', '</span><span class=o>.</span><span class=n>join</span><span class=p>(</span><span class=n>d1</span><span class=o>.</span><span class=n>index</span><span class=o>.</span><span class=n>names</span><span class=p>)</span>
<a href=#__codelineno-7-12 id=__codelineno-7-12 name=__codelineno-7-12></a><span class=n>dat_cols</span> <span class=o>=</span> <span class=s1>', '</span><span class=o>.</span><span class=n>join</span><span class=p>(</span><span class=n>d1</span><span class=o>.</span><span class=n>columns</span><span class=p>)</span>
<a href=#__codelineno-7-13 id=__codelineno-7-13 name=__codelineno-7-13></a><span class=n>upd_vals</span> <span class=o>=</span> <span class=s1>', '</span><span class=o>.</span><span class=n>join</span><span class=p>([</span><span class=sa>f</span><span class=s1>'</span><span class=si>{</span><span class=n>col</span><span class=si>}</span><span class=s1> = EXCLUDED.</span><span class=si>{</span><span class=n>col</span><span class=si>}</span><span class=s1>'</span> <span class=k>for</span> <span class=n>col</span> <span class=ow>in</span> <span class=n>d1</span><span class=o>.</span><span class=n>columns</span><span class=p>])</span>
<a href=#__codelineno-7-14 id=__codelineno-7-14 name=__codelineno-7-14></a><span class=n>conn</span><span class=o>.</span><span class=n>execute</span><span class=p>(</span><span class=sa>f</span><span class=s1>'CREATE UNIQUE INDEX i1 ON d1 (</span><span class=si>{</span><span class=n>id_cols</span><span class=si>}</span><span class=s1>)'</span><span class=p>)</span>
<a href=#__codelineno-7-15 id=__codelineno-7-15 name=__codelineno-7-15></a>
<a href=#__codelineno-7-16 id=__codelineno-7-16 name=__codelineno-7-16></a><span class=n>conn</span><span class=o>.</span><span class=n>execute</span><span class=p>(</span><span class=sa>f</span><span class=s1>'''</span>
<a href=#__codelineno-7-17 id=__codelineno-7-17 name=__codelineno-7-17></a><span class=s1>    INSERT INTO d1 (</span><span class=si>{</span><span class=n>id_cols</span><span class=si>}</span><span class=s1>, </span><span class=si>{</span><span class=n>dat_cols</span><span class=si>}</span><span class=s1>)</span>
<a href=#__codelineno-7-18 id=__codelineno-7-18 name=__codelineno-7-18></a><span class=s1>    SELECT </span><span class=si>{</span><span class=n>id_cols</span><span class=si>}</span><span class=s1>, </span><span class=si>{</span><span class=n>dat_cols</span><span class=si>}</span>
<a href=#__codelineno-7-19 id=__codelineno-7-19 name=__codelineno-7-19></a><span class=s1>    FROM d2</span>
<a href=#__codelineno-7-20 id=__codelineno-7-20 name=__codelineno-7-20></a><span class=s1>    ON CONFLICT (</span><span class=si>{</span><span class=n>id_cols</span><span class=si>}</span><span class=s1>) DO UPDATE SET </span><span class=si>{</span><span class=n>upd_vals</span><span class=si>}</span>
<a href=#__codelineno-7-21 id=__codelineno-7-21 name=__codelineno-7-21></a><span class=s1>'''</span><span class=p>)</span>
<a href=#__codelineno-7-22 id=__codelineno-7-22 name=__codelineno-7-22></a>
<a href=#__codelineno-7-23 id=__codelineno-7-23 name=__codelineno-7-23></a><span class=c1># Retrieve the updated DataFrame</span>
<a href=#__codelineno-7-24 id=__codelineno-7-24 name=__codelineno-7-24></a><span class=n>df2</span> <span class=o>=</span> <span class=n>conn</span><span class=o>.</span><span class=n>execute</span><span class=p>(</span><span class=s1>'SELECT * FROM d1'</span><span class=p>)</span><span class=o>.</span><span class=n>fetchdf</span><span class=p>()</span>
<a href=#__codelineno-7-25 id=__codelineno-7-25 name=__codelineno-7-25></a>
<a href=#__codelineno-7-26 id=__codelineno-7-26 name=__codelineno-7-26></a><span class=c1># Close the connection</span>
<a href=#__codelineno-7-27 id=__codelineno-7-27 name=__codelineno-7-27></a><span class=n>conn</span><span class=o>.</span><span class=n>close</span><span class=p>()</span>
</code></pre></div></article></div><script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script></div><button class="md-top md-icon" data-md-component=top hidden type=button><svg viewbox="0 0 24 24" xmlns=http://www.w3.org/2000/svg><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg> Back to top</button></main><footer class=md-footer><div class="md-footer-meta md-typeset"><div class="md-footer-meta__inner md-grid"><div class=md-copyright><div class=md-copyright__highlight><a title="Go to Main Home Page" href=/>🏠 Back to Home</a><br> Copyright © 2026 Sean Ma <br>Last updated on <span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-custom" title="February 17, 2025 03:50:04 UTC">17 Feb 2025</span></div> Made with <a href=https://squidfunk.github.io/mkdocs-material/ rel=noopener target=_blank> Material for MkDocs </a></div></div></div></footer></div><div class=md-dialog data-md-component=dialog><div class="md-dialog__inner md-typeset"></div></div><script id=__config type=application/json>{"base": "../../..", "features": ["navigation.tabs", "navigation.expand", "navigation.indexes", "navigation.top", "toc.follow", "search.suggest", "search.highlight", "content.code.copy", "navigation.prune"], "search": "../../../assets/javascripts/workers/search.d50fe291.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script><script src=../../../assets/javascripts/bundle.56ea9cef.min.js></script>