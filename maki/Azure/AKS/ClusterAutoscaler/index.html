<!doctype html><html class=no-js lang=en><meta charset=utf-8><meta content="width=device-width,initial-scale=1" name=viewport><link href=https://seanslma.github.io/maki/Azure/AKS/ClusterAutoscaler/ rel=canonical><link href=../Cluster/ rel=prev><link href=../ClusterAutoscalerProfile/ rel=next><link href=../../../assets/images/favicon.png rel=icon><meta content="mkdocs-1.6.1, mkdocs-material-9.6.15" name=generator><title>Cluster Autoscaler - maki</title><link href=../../../assets/stylesheets/main.342714a4.min.css rel=stylesheet><link href=../../../assets/stylesheets/palette.06af60db.min.css rel=stylesheet><link crossorigin href=https://fonts.gstatic.com rel=preconnect><link href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback" rel=stylesheet><style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style><link href=../../../stylesheets/extra.css rel=stylesheet><script>__md_scope=new URL(`../../..`,location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+`.`+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+`.`+e,JSON.stringify(_))}catch{}};</script><body data-md-color-accent=indigo data-md-color-primary=indigo data-md-color-scheme=default dir=ltr><input autocomplete=off class=md-toggle data-md-toggle=drawer id=__drawer type=checkbox><input autocomplete=off class=md-toggle data-md-toggle=search id=__search type=checkbox><label class=md-overlay for=__drawer></label><div data-md-component=skip><a class=md-skip href=#cluster-autoscaler> Skip to content </a></div><div data-md-component=announce></div><header class=md-header data-md-component=header><nav class="md-header__inner md-grid" aria-label=Header><a class="md-header__button md-logo" aria-label=maki data-md-component=logo href=../../.. title=maki> <svg viewbox="0 0 24 24" xmlns=http://www.w3.org/2000/svg><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg> </a><label class="md-header__button md-icon" for=__drawer><svg viewbox="0 0 24 24" xmlns=http://www.w3.org/2000/svg><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg></label><div class=md-header__title data-md-component=header-title><div class=md-header__ellipsis><div class=md-header__topic><span class=md-ellipsis> maki </span></div><div class=md-header__topic data-md-component=header-topic><span class=md-ellipsis> Cluster Autoscaler </span></div></div></div><form class=md-header__option data-md-component=palette><input aria-label="Switch to dark mode" class=md-option data-md-color-accent=indigo data-md-color-media data-md-color-primary=indigo data-md-color-scheme=default id=__palette_0 name=__palette type=radio><label class="md-header__button md-icon" title="Switch to dark mode" for=__palette_1 hidden><svg viewbox="0 0 24 24" xmlns=http://www.w3.org/2000/svg><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg></label><input aria-label="Switch to light mode" class=md-option data-md-color-accent=indigo data-md-color-media data-md-color-primary=indigo data-md-color-scheme=slate id=__palette_1 name=__palette type=radio><label class="md-header__button md-icon" title="Switch to light mode" for=__palette_0 hidden><svg viewbox="0 0 24 24" xmlns=http://www.w3.org/2000/svg><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12s-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg></label></form><script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script><label class="md-header__button md-icon" for=__search><svg viewbox="0 0 24 24" xmlns=http://www.w3.org/2000/svg><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg></label><div class=md-search data-md-component=search role=dialog><label class=md-search__overlay for=__search></label><div class=md-search__inner role=search><form class=md-search__form name=search><input aria-label=Search autocapitalize=off autocomplete=off autocorrect=off class=md-search__input data-md-component=search-query name=query placeholder=Search required spellcheck=false><label class="md-search__icon md-icon" for=__search><svg viewbox="0 0 24 24" xmlns=http://www.w3.org/2000/svg><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg> <svg viewbox="0 0 24 24" xmlns=http://www.w3.org/2000/svg><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg></label><nav aria-label=Search class=md-search__options><button class="md-search__icon md-icon" aria-label=Clear tabindex=-1 title=Clear type=reset><svg viewbox="0 0 24 24" xmlns=http://www.w3.org/2000/svg><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg></button></nav><div class=md-search__suggest data-md-component=search-suggest></div></form><div class=md-search__output><div class=md-search__scrollwrap data-md-scrollfix tabindex=0><div class=md-search-result data-md-component=search-result><div class=md-search-result__meta>Initializing search</div><ol class=md-search-result__list role=presentation></ol></div></div></div></div></div><div class=md-header__source><a title="Go to repository" class=md-source data-md-component=source href=https://github.com/seanslma/maki> <div class="md-source__icon md-icon"><svg viewbox="0 0 448 512" xmlns=http://www.w3.org/2000/svg><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"/></svg></div> <div class=md-source__repository>GitHub</div> </a></div></nav></header><div class=md-container data-md-component=container><nav aria-label=Tabs class=md-tabs data-md-component=tabs><div class=md-grid><ul class=md-tabs__list><li class=md-tabs__item><a class=md-tabs__link href=../../..> About </a><li class=md-tabs__item><a class=md-tabs__link href=../../../AI/ChatGPT/> AI </a><li class=md-tabs__item><a class=md-tabs__link href=../../../AWS/CDN/> AWS </a><li class="md-tabs__item md-tabs__item--active"><a class=md-tabs__link href=../../Advisor/> Azure </a><li class=md-tabs__item><a class=md-tabs__link href=../../../Coding/Notepad%2B%2B/> Coding </a><li class=md-tabs__item><a class=md-tabs__link href=../../../Cybersecurity/Cybersecurity/> Cybersecurity </a><li class=md-tabs__item><a class=md-tabs__link href=../../../Data/Data/> Data </a><li class=md-tabs__item><a class=md-tabs__link href=../../../DevOps/DevOps/> DevOps </a><li class=md-tabs__item><a class=md-tabs__link href=../../../Documentation/Jira/> Documentation </a><li class=md-tabs__item><a class=md-tabs__link href=../../../Energy/Inertia/> Energy </a><li class=md-tabs__item><a class=md-tabs__link href=../../../Learn/Book/> Learn </a><li class=md-tabs__item><a class=md-tabs__link href=../../../ML/Backtest/> ML </a><li class=md-tabs__item><a class=md-tabs__link href=../../../Optimizaton/Convex/> Optimizaton </a><li class=md-tabs__item><a class=md-tabs__link href=../../../PowerBI/Basic/> PowerBI </a><li class=md-tabs__item><a class=md-tabs__link href=../../../Python/Basic/> Python </a><li class=md-tabs__item><a class=md-tabs__link href=../../../SQL/Database/> SQL </a><li class=md-tabs__item><a class=md-tabs__link href=../../../System/Behavior/> System </a></ul></div></nav><main class=md-main data-md-component=main><div class="md-main__inner md-grid"><div class="md-sidebar md-sidebar--primary" data-md-component=sidebar data-md-type=navigation><div class=md-sidebar__scrollwrap><div class=md-sidebar__inner><nav class="md-nav md-nav--primary md-nav--lifted" aria-label=Navigation data-md-level=0><label class=md-nav__title for=__drawer><a class="md-nav__button md-logo" aria-label=maki data-md-component=logo href=../../.. title=maki> <svg viewbox="0 0 24 24" xmlns=http://www.w3.org/2000/svg><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg> </a> maki</label><div class=md-nav__source><a title="Go to repository" class=md-source data-md-component=source href=https://github.com/seanslma/maki> <div class="md-source__icon md-icon"><svg viewbox="0 0 448 512" xmlns=http://www.w3.org/2000/svg><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"/></svg></div> <div class=md-source__repository>GitHub</div> </a></div><ul class=md-nav__list data-md-scrollfix><li class=md-nav__item><a class=md-nav__link href=../../..> <span class=md-ellipsis> About </span> </a><li class="md-nav__item md-nav__item--pruned md-nav__item--nested"><a class=md-nav__link href=../../../AI/ChatGPT/> <span class=md-ellipsis> AI </span> <span class="md-nav__icon md-icon"></span> </a><li class="md-nav__item md-nav__item--pruned md-nav__item--nested"><a class=md-nav__link href=../../../AWS/CDN/> <span class=md-ellipsis> AWS </span> <span class="md-nav__icon md-icon"></span> </a><li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested"><input class="md-nav__toggle md-toggle" checked id=__nav_4 type=checkbox> <label class=md-nav__link for=__nav_4 id=__nav_4_label><span class=md-ellipsis> Azure </span> <span class="md-nav__icon md-icon"></span></label> <nav aria-expanded=true aria-labelledby=__nav_4_label class=md-nav data-md-level=1><label class=md-nav__title for=__nav_4><span class="md-nav__icon md-icon"></span> Azure</label><ul class=md-nav__list data-md-scrollfix><li class=md-nav__item><a class=md-nav__link href=../../Advisor/> <span class=md-ellipsis> Advisor </span> </a><li class=md-nav__item><a class=md-nav__link href=../../AppInsight/> <span class=md-ellipsis> Application Insights </span> </a><li class=md-nav__item><a class=md-nav__link href=../../Azure/> <span class=md-ellipsis> azure </span> </a><li class=md-nav__item><a class=md-nav__link href=../../Env/> <span class=md-ellipsis> Env </span> </a><li class=md-nav__item><a class=md-nav__link href=../../Learn/> <span class=md-ellipsis> Learn </span> </a><li class=md-nav__item><a class=md-nav__link href=../../ResourceProvider/> <span class=md-ellipsis> Resource Provider </span> </a><li class=md-nav__item><a class=md-nav__link href=../../Services/> <span class=md-ellipsis> Services </span> </a><li class="md-nav__item md-nav__item--pruned md-nav__item--nested"><a class=md-nav__link href=../../AAD/Account/> <span class=md-ellipsis> AAD </span> <span class="md-nav__icon md-icon"></span> </a><li class="md-nav__item md-nav__item--pruned md-nav__item--nested"><a class=md-nav__link href=../../ACR/ACR/> <span class=md-ellipsis> ACR </span> <span class="md-nav__icon md-icon"></span> </a><li class="md-nav__item md-nav__item--active md-nav__item--nested"><input class="md-nav__toggle md-toggle" checked id=__nav_4_10 type=checkbox> <label class=md-nav__link for=__nav_4_10 id=__nav_4_10_label tabindex=0><span class=md-ellipsis> AKS </span> <span class="md-nav__icon md-icon"></span></label> <nav aria-expanded=true aria-labelledby=__nav_4_10_label class=md-nav data-md-level=2><label class=md-nav__title for=__nav_4_10><span class="md-nav__icon md-icon"></span> AKS</label><ul class=md-nav__list data-md-scrollfix><li class=md-nav__item><a class=md-nav__link href=../ACR/> <span class=md-ellipsis> ACR </span> </a><li class=md-nav__item><a class=md-nav__link href=../AKS/> <span class=md-ellipsis> AKS </span> </a><li class=md-nav__item><a class=md-nav__link href=../API/> <span class=md-ellipsis> API </span> </a><li class=md-nav__item><a class=md-nav__link href=../Authorization/> <span class=md-ellipsis> Authorization </span> </a><li class=md-nav__item><a class=md-nav__link href=../Certificate/> <span class=md-ellipsis> Certificate </span> </a><li class=md-nav__item><a class=md-nav__link href=../Cluster/> <span class=md-ellipsis> Cluster </span> </a><li class="md-nav__item md-nav__item--active"><input class="md-nav__toggle md-toggle" id=__toc type=checkbox> <label class="md-nav__link md-nav__link--active" for=__toc><span class=md-ellipsis> Cluster Autoscaler </span> <span class="md-nav__icon md-icon"></span></label> <a class="md-nav__link md-nav__link--active" href=./> <span class=md-ellipsis> Cluster Autoscaler </span> </a> <nav aria-label="Table of contents" class="md-nav md-nav--secondary"><label class=md-nav__title for=__toc><span class="md-nav__icon md-icon"></span> Table of contents</label><ul class=md-nav__list data-md-component=toc data-md-scrollfix><li class=md-nav__item><a class=md-nav__link href=#when-nodes-are-scaled-down> <span class=md-ellipsis> when nodes are scaled down </span> </a><li class=md-nav__item><a class=md-nav__link href=#reasons-nodes-not-scaled-down> <span class=md-ellipsis> reasons nodes not scaled down </span> </a> <nav aria-label="reasons nodes not scaled down" class=md-nav><ul class=md-nav__list><li class=md-nav__item><a class=md-nav__link href=#autoscaler-logs> <span class=md-ellipsis> autoscaler logs </span> </a><li class=md-nav__item><a class=md-nav__link href=#autoscaler-configmap> <span class=md-ellipsis> Autoscaler configmap </span> </a></ul></nav><li class=md-nav__item><a class=md-nav__link href=#cannot-control-which-node-to-delete> <span class=md-ellipsis> cannot control which node to delete </span> </a><li class=md-nav__item><a class=md-nav__link href=#custom-metrics> <span class=md-ellipsis> custom metrics </span> </a><li class=md-nav__item><a class=md-nav__link href=#cluster-autoscaler-settings> <span class=md-ellipsis> Cluster autoscaler settings </span> </a><li class=md-nav__item><a class=md-nav__link href=#autoscale-pods> <span class=md-ellipsis> Autoscale pods </span> </a><li class=md-nav__item><a class=md-nav__link href=#manually-scale-down-nodes> <span class=md-ellipsis> Manually scale down nodes </span> </a><li class=md-nav__item><a class=md-nav__link href=#metrics> <span class=md-ellipsis> Metrics </span> </a> <nav aria-label=Metrics class=md-nav><ul class=md-nav__list><li class=md-nav__item><a class=md-nav__link href=#scale-down-utilization-threshold> <span class=md-ellipsis> scale-down-utilization-threshold </span> </a></ul></nav><li class=md-nav__item><a class=md-nav__link href=#prevent-autoscaler-deleting-node-which-runs-a-specific-pod> <span class=md-ellipsis> Prevent autoscaler deleting node which runs a specific pod </span> </a> <nav aria-label="Prevent autoscaler deleting node which runs a specific pod" class=md-nav><ul class=md-nav__list><li class=md-nav__item><a class=md-nav__link href=#solution-1> <span class=md-ellipsis> Solution 1: </span> </a><li class=md-nav__item><a class=md-nav__link href=#solution-2> <span class=md-ellipsis> Solution 2: </span> </a><li class=md-nav__item><a class=md-nav__link href=#solutions-3> <span class=md-ellipsis> Solutions 3: </span> </a></ul></nav></ul></nav><li class=md-nav__item><a class=md-nav__link href=../ClusterAutoscalerProfile/> <span class=md-ellipsis> Cluster Autoscaler profile </span> </a><li class=md-nav__item><a class=md-nav__link href=../Deploy/> <span class=md-ellipsis> deploy app </span> </a><li class=md-nav__item><a class=md-nav__link href=../Disk/> <span class=md-ellipsis> Disk </span> </a><li class=md-nav__item><a class=md-nav__link href=../Docker/> <span class=md-ellipsis> Docker </span> </a><li class=md-nav__item><a class=md-nav__link href=../Failure/> <span class=md-ellipsis> AKS Failure </span> </a><li class=md-nav__item><a class=md-nav__link href=../HTTPS/> <span class=md-ellipsis> https </span> </a><li class=md-nav__item><a class=md-nav__link href=../Issue/> <span class=md-ellipsis> Issue </span> </a><li class=md-nav__item><a class=md-nav__link href=../Learn/> <span class=md-ellipsis> Learn </span> </a><li class=md-nav__item><a class=md-nav__link href=../Links/> <span class=md-ellipsis> Links </span> </a><li class=md-nav__item><a class=md-nav__link href=../Logs/> <span class=md-ellipsis> Logs </span> </a><li class=md-nav__item><a class=md-nav__link href=../MaintConfig/> <span class=md-ellipsis> Maintenance Configure </span> </a><li class=md-nav__item><a class=md-nav__link href=../ManagedIdentity/> <span class=md-ellipsis> Managed identity </span> </a><li class=md-nav__item><a class=md-nav__link href=../Monitor/> <span class=md-ellipsis> Monitor </span> </a><li class=md-nav__item><a class=md-nav__link href=../Network/> <span class=md-ellipsis> Network </span> </a><li class=md-nav__item><a class=md-nav__link href=../NodePool/> <span class=md-ellipsis> Node Pool </span> </a><li class=md-nav__item><a class=md-nav__link href=../PipelineAgent/> <span class=md-ellipsis> Pipeline agent </span> </a><li class=md-nav__item><a class=md-nav__link href=../PrivateCluster/> <span class=md-ellipsis> Private Cluster </span> </a><li class=md-nav__item><a class=md-nav__link href=../Scale/> <span class=md-ellipsis> Builing scalable apps </span> </a><li class=md-nav__item><a class=md-nav__link href=../Upgrade/> <span class=md-ellipsis> upgrade app </span> </a><li class=md-nav__item><a class=md-nav__link href=../VolumeBlob/> <span class=md-ellipsis> Volume blob stoarge </span> </a><li class=md-nav__item><a class=md-nav__link href=../VolumeFile/> <span class=md-ellipsis> Volume files storage </span> </a></ul></nav><li class="md-nav__item md-nav__item--pruned md-nav__item--nested"><a class=md-nav__link href=../../AKV/KeyVault/> <span class=md-ellipsis> AKV </span> <span class="md-nav__icon md-icon"></span> </a><li class="md-nav__item md-nav__item--pruned md-nav__item--nested"><a class=md-nav__link href=../../ARM/ARM/> <span class=md-ellipsis> ARM </span> <span class="md-nav__icon md-icon"></span> </a><li class="md-nav__item md-nav__item--pruned md-nav__item--nested"><a class=md-nav__link href=../../Architecture/LandingZone/> <span class=md-ellipsis> Architecture </span> <span class="md-nav__icon md-icon"></span> </a><li class="md-nav__item md-nav__item--pruned md-nav__item--nested"><a class=md-nav__link href=../../Automation/Account/> <span class=md-ellipsis> Automation </span> <span class="md-nav__icon md-icon"></span> </a><li class="md-nav__item md-nav__item--pruned md-nav__item--nested"><a class=md-nav__link href=../../AzCLI/AzCopy/> <span class=md-ellipsis> AzCLI </span> <span class="md-nav__icon md-icon"></span> </a><li class="md-nav__item md-nav__item--pruned md-nav__item--nested"><a class=md-nav__link href=../../AzPwsh/Blob/> <span class=md-ellipsis> AzPwsh </span> <span class="md-nav__icon md-icon"></span> </a><li class="md-nav__item md-nav__item--pruned md-nav__item--nested"><a class=md-nav__link href=../../Blog/PrivateDNSZone/> <span class=md-ellipsis> Blog </span> <span class="md-nav__icon md-icon"></span> </a><li class="md-nav__item md-nav__item--pruned md-nav__item--nested"><a class=md-nav__link href=../../Compute/Function/> <span class=md-ellipsis> Compute </span> <span class="md-nav__icon md-icon"></span> </a><li class="md-nav__item md-nav__item--pruned md-nav__item--nested"><a class=md-nav__link href=../../Data/Data/> <span class=md-ellipsis> Data </span> <span class="md-nav__icon md-icon"></span> </a><li class="md-nav__item md-nav__item--pruned md-nav__item--nested"><a class=md-nav__link href=../../DevOps/Agent/> <span class=md-ellipsis> DevOps </span> <span class="md-nav__icon md-icon"></span> </a><li class="md-nav__item md-nav__item--pruned md-nav__item--nested"><a class=md-nav__link href=../../Func/Functions/> <span class=md-ellipsis> Func </span> <span class="md-nav__icon md-icon"></span> </a><li class="md-nav__item md-nav__item--pruned md-nav__item--nested"><a class=md-nav__link href=../../ML/AutoML/> <span class=md-ellipsis> ML </span> <span class="md-nav__icon md-icon"></span> </a><li class="md-nav__item md-nav__item--pruned md-nav__item--nested"><a class=md-nav__link href=../../Manage/Blueprint/> <span class=md-ellipsis> Manage </span> <span class="md-nav__icon md-icon"></span> </a><li class="md-nav__item md-nav__item--pruned md-nav__item--nested"><a class=md-nav__link href=../../Monitor/Alert/> <span class=md-ellipsis> Monitor </span> <span class="md-nav__icon md-icon"></span> </a><li class="md-nav__item md-nav__item--pruned md-nav__item--nested"><a class=md-nav__link href=../../Network/Architecture/> <span class=md-ellipsis> Network </span> <span class="md-nav__icon md-icon"></span> </a><li class="md-nav__item md-nav__item--pruned md-nav__item--nested"><a class=md-nav__link href=../../Pipeline/Agent/> <span class=md-ellipsis> Pipeline </span> <span class="md-nav__icon md-icon"></span> </a><li class="md-nav__item md-nav__item--pruned md-nav__item--nested"><a class=md-nav__link href=../../Route/Balancer/> <span class=md-ellipsis> Route </span> <span class="md-nav__icon md-icon"></span> </a><li class="md-nav__item md-nav__item--pruned md-nav__item--nested"><a class=md-nav__link href=../../SQLServer/SQLServer/> <span class=md-ellipsis> SQLServer </span> <span class="md-nav__icon md-icon"></span> </a><li class="md-nav__item md-nav__item--pruned md-nav__item--nested"><a class=md-nav__link href=../../Security/Bastion/> <span class=md-ellipsis> Security </span> <span class="md-nav__icon md-icon"></span> </a><li class="md-nav__item md-nav__item--pruned md-nav__item--nested"><a class=md-nav__link href=../../Storage/Access/> <span class=md-ellipsis> Storage </span> <span class="md-nav__icon md-icon"></span> </a><li class="md-nav__item md-nav__item--pruned md-nav__item--nested"><a class=md-nav__link href=../../Synapse/Pipeline/> <span class=md-ellipsis> Synapse </span> <span class="md-nav__icon md-icon"></span> </a></ul></nav><li class="md-nav__item md-nav__item--pruned md-nav__item--nested"><a class=md-nav__link href=../../../Coding/Notepad%2B%2B/> <span class=md-ellipsis> Coding </span> <span class="md-nav__icon md-icon"></span> </a><li class="md-nav__item md-nav__item--pruned md-nav__item--nested"><a class=md-nav__link href=../../../Cybersecurity/Cybersecurity/> <span class=md-ellipsis> Cybersecurity </span> <span class="md-nav__icon md-icon"></span> </a><li class="md-nav__item md-nav__item--pruned md-nav__item--nested"><a class=md-nav__link href=../../../Data/Data/> <span class=md-ellipsis> Data </span> <span class="md-nav__icon md-icon"></span> </a><li class="md-nav__item md-nav__item--pruned md-nav__item--nested"><a class=md-nav__link href=../../../DevOps/DevOps/> <span class=md-ellipsis> DevOps </span> <span class="md-nav__icon md-icon"></span> </a><li class="md-nav__item md-nav__item--pruned md-nav__item--nested"><a class=md-nav__link href=../../../Documentation/Jira/> <span class=md-ellipsis> Documentation </span> <span class="md-nav__icon md-icon"></span> </a><li class="md-nav__item md-nav__item--pruned md-nav__item--nested"><a class=md-nav__link href=../../../Energy/Inertia/> <span class=md-ellipsis> Energy </span> <span class="md-nav__icon md-icon"></span> </a><li class="md-nav__item md-nav__item--pruned md-nav__item--nested"><a class=md-nav__link href=../../../Learn/Book/> <span class=md-ellipsis> Learn </span> <span class="md-nav__icon md-icon"></span> </a><li class="md-nav__item md-nav__item--pruned md-nav__item--nested"><a class=md-nav__link href=../../../ML/Backtest/> <span class=md-ellipsis> ML </span> <span class="md-nav__icon md-icon"></span> </a><li class="md-nav__item md-nav__item--pruned md-nav__item--nested"><a class=md-nav__link href=../../../Optimizaton/Convex/> <span class=md-ellipsis> Optimizaton </span> <span class="md-nav__icon md-icon"></span> </a><li class="md-nav__item md-nav__item--pruned md-nav__item--nested"><a class=md-nav__link href=../../../PowerBI/Basic/> <span class=md-ellipsis> PowerBI </span> <span class="md-nav__icon md-icon"></span> </a><li class="md-nav__item md-nav__item--pruned md-nav__item--nested"><a class=md-nav__link href=../../../Python/Basic/> <span class=md-ellipsis> Python </span> <span class="md-nav__icon md-icon"></span> </a><li class="md-nav__item md-nav__item--pruned md-nav__item--nested"><a class=md-nav__link href=../../../SQL/Database/> <span class=md-ellipsis> SQL </span> <span class="md-nav__icon md-icon"></span> </a><li class="md-nav__item md-nav__item--pruned md-nav__item--nested"><a class=md-nav__link href=../../../System/Behavior/> <span class=md-ellipsis> System </span> <span class="md-nav__icon md-icon"></span> </a></ul></nav></div></div></div><div class="md-sidebar md-sidebar--secondary" data-md-component=sidebar data-md-type=toc><div class=md-sidebar__scrollwrap><div class=md-sidebar__inner><nav aria-label="Table of contents" class="md-nav md-nav--secondary"><label class=md-nav__title for=__toc><span class="md-nav__icon md-icon"></span> Table of contents</label><ul class=md-nav__list data-md-component=toc data-md-scrollfix><li class=md-nav__item><a class=md-nav__link href=#when-nodes-are-scaled-down> <span class=md-ellipsis> when nodes are scaled down </span> </a><li class=md-nav__item><a class=md-nav__link href=#reasons-nodes-not-scaled-down> <span class=md-ellipsis> reasons nodes not scaled down </span> </a> <nav aria-label="reasons nodes not scaled down" class=md-nav><ul class=md-nav__list><li class=md-nav__item><a class=md-nav__link href=#autoscaler-logs> <span class=md-ellipsis> autoscaler logs </span> </a><li class=md-nav__item><a class=md-nav__link href=#autoscaler-configmap> <span class=md-ellipsis> Autoscaler configmap </span> </a></ul></nav><li class=md-nav__item><a class=md-nav__link href=#cannot-control-which-node-to-delete> <span class=md-ellipsis> cannot control which node to delete </span> </a><li class=md-nav__item><a class=md-nav__link href=#custom-metrics> <span class=md-ellipsis> custom metrics </span> </a><li class=md-nav__item><a class=md-nav__link href=#cluster-autoscaler-settings> <span class=md-ellipsis> Cluster autoscaler settings </span> </a><li class=md-nav__item><a class=md-nav__link href=#autoscale-pods> <span class=md-ellipsis> Autoscale pods </span> </a><li class=md-nav__item><a class=md-nav__link href=#manually-scale-down-nodes> <span class=md-ellipsis> Manually scale down nodes </span> </a><li class=md-nav__item><a class=md-nav__link href=#metrics> <span class=md-ellipsis> Metrics </span> </a> <nav aria-label=Metrics class=md-nav><ul class=md-nav__list><li class=md-nav__item><a class=md-nav__link href=#scale-down-utilization-threshold> <span class=md-ellipsis> scale-down-utilization-threshold </span> </a></ul></nav><li class=md-nav__item><a class=md-nav__link href=#prevent-autoscaler-deleting-node-which-runs-a-specific-pod> <span class=md-ellipsis> Prevent autoscaler deleting node which runs a specific pod </span> </a> <nav aria-label="Prevent autoscaler deleting node which runs a specific pod" class=md-nav><ul class=md-nav__list><li class=md-nav__item><a class=md-nav__link href=#solution-1> <span class=md-ellipsis> Solution 1: </span> </a><li class=md-nav__item><a class=md-nav__link href=#solution-2> <span class=md-ellipsis> Solution 2: </span> </a><li class=md-nav__item><a class=md-nav__link href=#solutions-3> <span class=md-ellipsis> Solutions 3: </span> </a></ul></nav></ul></nav></div></div></div><div class=md-content data-md-component=content><article class="md-content__inner md-typeset"><h1 id=cluster-autoscaler>Cluster Autoscaler<a title="Permanent link" class=headerlink href=#cluster-autoscaler>¬∂</a></h1><p>https://docs.microsoft.com/en-us/azure/aks/scale-cluster?tabs=azure-cli<p>https://www.danielstechblog.io/azure-kubernetes-service-cluster-autoscaler-configurations/<p>https://betterprogramming.pub/build-kubernetes-autoscaling-for-cluster-nodes-and-application-pods-bb7f2d716b07<p>Pod not deleted preventing scaling down on all nodes: https://github.com/kubernetes/autoscaler/issues/248 Fix: After many month of period debugging found the issue to be signal handling. Installed https://github.com/Yelp/dumb-init in all the pods and the issue as cleared. I am closing this.<h2 id=when-nodes-are-scaled-down>when nodes are scaled down<a title="Permanent link" class=headerlink href=#when-nodes-are-scaled-down>¬∂</a></h2><p>AKS > Monitoring > Metrics > Unneeded Nodes<h2 id=reasons-nodes-not-scaled-down>reasons nodes not scaled down<a title="Permanent link" class=headerlink href=#reasons-nodes-not-scaled-down>¬∂</a></h2><p>https://github.com/kubernetes/autoscaler/issues/525<h3 id=autoscaler-logs>autoscaler logs<a title="Permanent link" class=headerlink href=#autoscaler-logs>¬∂</a></h3><div class=highlight><pre><span></span><code><a href=#__codelineno-0-1 id=__codelineno-0-1 name=__codelineno-0-1></a>kubectl<span class=w> </span>-n<span class=w> </span>kube-system<span class=w> </span>logs<span class=w> </span>--follow<span class=w> </span>kube-dns-autoscaler-7xxxxb7-lxxxp
</code></pre></div><h3 id=autoscaler-configmap>Autoscaler configmap<a title="Permanent link" class=headerlink href=#autoscaler-configmap>¬∂</a></h3><div class=highlight><pre><span></span><code><a href=#__codelineno-1-1 id=__codelineno-1-1 name=__codelineno-1-1></a>kubectl<span class=w> </span>get<span class=w> </span>configmap<span class=w> </span>cluster-autoscaler-status<span class=w> </span>-n<span class=w> </span>kube-system<span class=w> </span>-o<span class=w> </span>yaml
</code></pre></div><h2 id=cannot-control-which-node-to-delete>cannot control which node to delete<a title="Permanent link" class=headerlink href=#cannot-control-which-node-to-delete>¬∂</a></h2><ul><li><p>nodes are being removed starting from the highest IDs</p><li><p>You cannot control which node will be removed when scaling down the AKS cluster - the cordoned node will not be selected.</p></ul><p><strong>Workaround</strong>: first manually scale the nodes to zero then scale back.<h2 id=custom-metrics>custom metrics<a title="Permanent link" class=headerlink href=#custom-metrics>¬∂</a></h2><p>If both CPU and memory usages are not high, you might want to consider using custom metrics or external metrics for Horizontal Pod Autoscaler (HPA) in aks. This allows you to scale your application based on metrics other than just CPU and memory.<p>Instrument your application code to expose the relevant metric (in this case, the number of requests) as an <strong>endpoint</strong>. This can be done by using a metrics library or directly exposing a custom metric through an HTTP endpoint.<h2 id=cluster-autoscaler-settings>Cluster autoscaler settings<a title="Permanent link" class=headerlink href=#cluster-autoscaler-settings>¬∂</a></h2><p>https://github.com/Azure/AKS/issues/2766<p>https://docs.microsoft.com/en-us/azure/azure-monitor/autoscale/autoscale-overview<p>Cannot scale down to zero? seems fixed - test it<h2 id=autoscale-pods>Autoscale pods<a title="Permanent link" class=headerlink href=#autoscale-pods>¬∂</a></h2><p>https://docs.microsoft.com/en-us/azure/aks/tutorial-kubernetes-scale?tabs=azure-cli#autoscale-pods<p>manually scale pods:<div class=highlight><pre><span></span><code><a href=#__codelineno-2-1 id=__codelineno-2-1 name=__codelineno-2-1></a>kubectl<span class=w> </span>scale<span class=w> </span>--replicas<span class=o>=</span><span class=m>5</span><span class=w> </span>deployment/&lt;deployment-name>
</code></pre></div><p>Kubernetes supports horizontal pod autoscaling (HPA) to adjust the number of pods in a deployment depending on CPU utilization or other select metrics.<p>To use the autoscaler, all containers in your pods and your pods must have CPU requests and limits defined.<p>If average CPU utilization across all pods exceeds 50% of their requested usage, the autoscaler increases the pods up to a maximum of 10 instances.<div class=highlight><pre><span></span><code><a href=#__codelineno-3-1 id=__codelineno-3-1 name=__codelineno-3-1></a>kubectl<span class=w> </span>autoscale<span class=w> </span>deployment<span class=w> </span>&lt;container-app-name><span class=w> </span>--cpu-percent<span class=o>=</span><span class=m>50</span><span class=w> </span>--min<span class=o>=</span><span class=m>3</span><span class=w> </span>--max<span class=o>=</span><span class=m>10</span>
</code></pre></div><div class=highlight><pre><span></span><code><a href=#__codelineno-4-1 id=__codelineno-4-1 name=__codelineno-4-1></a><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">autoscaling/v1</span>
<a href=#__codelineno-4-2 id=__codelineno-4-2 name=__codelineno-4-2></a><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">HorizontalPodAutoscaler</span>
<a href=#__codelineno-4-3 id=__codelineno-4-3 name=__codelineno-4-3></a><span class=nt>metadata</span><span class=p>:</span>
<a href=#__codelineno-4-4 id=__codelineno-4-4 name=__codelineno-4-4></a><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">&lt;container-app-name>-hpa</span>
<a href=#__codelineno-4-5 id=__codelineno-4-5 name=__codelineno-4-5></a><span class=nt>spec</span><span class=p>:</span>
<a href=#__codelineno-4-6 id=__codelineno-4-6 name=__codelineno-4-6></a><span class=w>  </span><span class=nt>minReplicas</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">3</span><span class=w>  </span><span class=c1># define min replica count</span>
<a href=#__codelineno-4-7 id=__codelineno-4-7 name=__codelineno-4-7></a><span class=w>  </span><span class=nt>maxReplicas</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">10</span><span class=w> </span><span class=c1># define max replica count</span>
<a href=#__codelineno-4-8 id=__codelineno-4-8 name=__codelineno-4-8></a><span class=w>  </span><span class=nt>scaleTargetRef</span><span class=p>:</span>
<a href=#__codelineno-4-9 id=__codelineno-4-9 name=__codelineno-4-9></a><span class=w>    </span><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">apps/v1</span>
<a href=#__codelineno-4-10 id=__codelineno-4-10 name=__codelineno-4-10></a><span class=w>    </span><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">Deployment</span>
<a href=#__codelineno-4-11 id=__codelineno-4-11 name=__codelineno-4-11></a><span class=w>    </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">&lt;container-app-name></span>
<a href=#__codelineno-4-12 id=__codelineno-4-12 name=__codelineno-4-12></a><span class=w>  </span><span class=nt>targetCPUUtilizationPercentage</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">50</span><span class=w> </span><span class=c1># target CPU utilization</span>
</code></pre></div><h2 id=manually-scale-down-nodes>Manually scale down nodes<a title="Permanent link" class=headerlink href=#manually-scale-down-nodes>¬∂</a></h2><p>https://docs.microsoft.com/en-us/azure/aks/scale-cluster?tabs=azure-cli<div class=highlight><pre><span></span><code><a href=#__codelineno-5-1 id=__codelineno-5-1 name=__codelineno-5-1></a><span class=c1>#show nodepool profiles</span>
<a href=#__codelineno-5-2 id=__codelineno-5-2 name=__codelineno-5-2></a>az<span class=w> </span>aks<span class=w> </span>show<span class=w> </span>--resource-group<span class=w> </span>&lt;resource-group><span class=w> </span><span class=se>\</span>
<a href=#__codelineno-5-3 id=__codelineno-5-3 name=__codelineno-5-3></a><span class=w>    </span>--name<span class=w> </span>&lt;cluster-name><span class=w> </span>--query<span class=w> </span>agentPoolProfiles
<a href=#__codelineno-5-4 id=__codelineno-5-4 name=__codelineno-5-4></a>
<a href=#__codelineno-5-5 id=__codelineno-5-5 name=__codelineno-5-5></a><span class=c1>#scale nodepool</span>
<a href=#__codelineno-5-6 id=__codelineno-5-6 name=__codelineno-5-6></a>az<span class=w> </span>aks<span class=w> </span>scale<span class=w> </span>--resource-group<span class=w> </span>&lt;resource-group><span class=w> </span><span class=se>\</span>
<a href=#__codelineno-5-7 id=__codelineno-5-7 name=__codelineno-5-7></a><span class=w>    </span>--name<span class=w> </span>&lt;cluster-name><span class=w> </span>--node-count<span class=w> </span><span class=m>1</span><span class=w> </span>--nodepool-name<span class=w> </span>&lt;nodepool-name>
<a href=#__codelineno-5-8 id=__codelineno-5-8 name=__codelineno-5-8></a>
<a href=#__codelineno-5-9 id=__codelineno-5-9 name=__codelineno-5-9></a><span class=c1>#can scale user nodepool to zero node</span>
<a href=#__codelineno-5-10 id=__codelineno-5-10 name=__codelineno-5-10></a>az<span class=w> </span>aks<span class=w> </span>nodepool<span class=w> </span>scale<span class=w> </span>--resource-group<span class=w> </span>&lt;resource-group><span class=w> </span><span class=se>\</span>
<a href=#__codelineno-5-11 id=__codelineno-5-11 name=__codelineno-5-11></a><span class=w>    </span>--cluster-name<span class=w> </span>&lt;cluster-name><span class=w> </span>--name<span class=w> </span>&lt;nodepool-name><span class=w> </span><span class=se>\</span>
<a href=#__codelineno-5-12 id=__codelineno-5-12 name=__codelineno-5-12></a><span class=w>    </span>--node-count<span class=w> </span><span class=m>0</span>
<a href=#__codelineno-5-13 id=__codelineno-5-13 name=__codelineno-5-13></a>
<a href=#__codelineno-5-14 id=__codelineno-5-14 name=__codelineno-5-14></a><span class=c1>#disable ca</span>
<a href=#__codelineno-5-15 id=__codelineno-5-15 name=__codelineno-5-15></a>az<span class=w> </span>aks<span class=w> </span>nodepool<span class=w> </span>update<span class=w> </span>--resource-group<span class=w> </span>&lt;resource-group><span class=w> </span><span class=se>\</span>
<a href=#__codelineno-5-16 id=__codelineno-5-16 name=__codelineno-5-16></a><span class=w>    </span>--cluster-name<span class=w> </span>&lt;cluster-name><span class=w> </span>--name<span class=w> </span>&lt;nodepool-name><span class=w> </span><span class=se>\</span>
<a href=#__codelineno-5-17 id=__codelineno-5-17 name=__codelineno-5-17></a><span class=w>    </span>--disable-cluster-autoscaler
<a href=#__codelineno-5-18 id=__codelineno-5-18 name=__codelineno-5-18></a>
<a href=#__codelineno-5-19 id=__codelineno-5-19 name=__codelineno-5-19></a><span class=c1>#enable ca</span>
<a href=#__codelineno-5-20 id=__codelineno-5-20 name=__codelineno-5-20></a>az<span class=w> </span>aks<span class=w> </span>nodepool<span class=w> </span>update<span class=w> </span>--resource-group<span class=w> </span>&lt;resource-group><span class=w> </span><span class=se>\</span>
<a href=#__codelineno-5-21 id=__codelineno-5-21 name=__codelineno-5-21></a><span class=w>    </span>--cluster-name<span class=w> </span>&lt;cluster-name><span class=w> </span>--name<span class=w> </span>&lt;nodepool-name><span class=w> </span><span class=se>\</span>
<a href=#__codelineno-5-22 id=__codelineno-5-22 name=__codelineno-5-22></a><span class=w>    </span>--enable-cluster-autoscaler<span class=w> </span>--min-count<span class=w> </span><span class=m>0</span><span class=w> </span>--max-count<span class=w> </span><span class=m>4</span>
<a href=#__codelineno-5-23 id=__codelineno-5-23 name=__codelineno-5-23></a>
<a href=#__codelineno-5-24 id=__codelineno-5-24 name=__codelineno-5-24></a><span class=c1>#change node pool count</span>
<a href=#__codelineno-5-25 id=__codelineno-5-25 name=__codelineno-5-25></a>az<span class=w> </span>aks<span class=w> </span>update<span class=w> </span>--resource-group<span class=w> </span>&lt;resource-group><span class=w> </span><span class=se>\</span>
<a href=#__codelineno-5-26 id=__codelineno-5-26 name=__codelineno-5-26></a><span class=w>    </span>--cluster-name<span class=w> </span>&lt;cluster-name><span class=w> </span>--name<span class=w> </span>&lt;nodepool-name><span class=w> </span><span class=se>\</span>
<a href=#__codelineno-5-27 id=__codelineno-5-27 name=__codelineno-5-27></a><span class=w>    </span>--update-cluster-autoscaler<span class=w> </span>--min-count<span class=w> </span><span class=m>0</span><span class=w> </span>--max-count<span class=w> </span><span class=m>4</span>
</code></pre></div><h2 id=metrics>Metrics<a title="Permanent link" class=headerlink href=#metrics>¬∂</a></h2><p>https://docs.microsoft.com/en-us/azure/azure-monitor/autoscale/autoscale-common-metrics<h3 id=scale-down-utilization-threshold>scale-down-utilization-threshold<a title="Permanent link" class=headerlink href=#scale-down-utilization-threshold>¬∂</a></h3><p>https://docs.microsoft.com/en-us/azure/aks/cluster-autoscaler#set-the-cluster-autoscaler-profile-on-an-existing-aks-cluster<div class=highlight><pre><span></span><code><a href=#__codelineno-6-1 id=__codelineno-6-1 name=__codelineno-6-1></a>az aks update \
<a href=#__codelineno-6-2 id=__codelineno-6-2 name=__codelineno-6-2></a>  --resource-group myResourceGroup \
<a href=#__codelineno-6-3 id=__codelineno-6-3 name=__codelineno-6-3></a>  --name myAKSCluster \
<a href=#__codelineno-6-4 id=__codelineno-6-4 name=__codelineno-6-4></a>  --cluster-autoscaler-profile scale-down-utilization-threshold=&lt;percentage value>
</code></pre></div><h2 id=prevent-autoscaler-deleting-node-which-runs-a-specific-pod>Prevent autoscaler deleting node which runs a specific pod<a title="Permanent link" class=headerlink href=#prevent-autoscaler-deleting-node-which-runs-a-specific-pod>¬∂</a></h2><p>https://faun.pub/how-to-make-sure-kubernetes-autoscaler-not-deleting-the-nodes-which-run-a-specific-pod-8df3f2c28c46<h3 id=solution-1>Solution 1:<a title="Permanent link" class=headerlink href=#solution-1>¬∂</a></h3><p>Can add the annotation to the critical pods or deployments:<div class=highlight><pre><span></span><code><a href=#__codelineno-7-1 id=__codelineno-7-1 name=__codelineno-7-1></a><span class=s>"cluster-autoscaler.kubernetes.io/safe-to-evict"</span><span class="p p-Indicator">:</span><span class=w> </span><span class=s>"false"</span>
</code></pre></div><p>Update a running deployment with the below command:<div class=highlight><pre><span></span><code><a href=#__codelineno-8-1 id=__codelineno-8-1 name=__codelineno-8-1></a>kubectl<span class=w> </span>annotate<span class=w> </span>deployment.apps/efs-provisioner<span class=w> </span>cluster-autoscaler.kubernetes.io/safe-to-evict<span class=s2>": "</span>false<span class=s2>"</span>
</code></pre></div><h3 id=solution-2>Solution 2:<a title="Permanent link" class=headerlink href=#solution-2>¬∂</a></h3><p>Autoscaler provides an option to exclude nodes from the scale-down process. This annotation is applied to a specific node so make sure the critical pods running on this Kubernetes node.<div class=highlight><pre><span></span><code><a href=#__codelineno-9-1 id=__codelineno-9-1 name=__codelineno-9-1></a><span class=s>"cluster-autoscaler.kubernetes.io/scale-down-disabled"</span><span class="p p-Indicator">:</span><span class=w> </span><span class=s>"true"</span>
</code></pre></div><h3 id=solutions-3>Solutions 3:<a title="Permanent link" class=headerlink href=#solutions-3>¬∂</a></h3><p>If a pod is using local storage AutoScaler will skip that node from deletion. So mounting local storage to a pod also can use as a trick to protect the nodes which run our critical pods.</article></div><script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script></div><button class="md-top md-icon" data-md-component=top hidden type=button><svg viewbox="0 0 24 24" xmlns=http://www.w3.org/2000/svg><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg> Back to top</button></main><footer class=md-footer><div class="md-footer-meta md-typeset"><div class="md-footer-meta__inner md-grid"><div class=md-copyright><div class=md-copyright__highlight><a title="Go to Main Home Page" href=/>üè† Back to Home</a><br> Copyright ¬© 2026 Sean Ma <br>Last updated on <span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-custom" title="March 13, 2024 12:41:31 UTC">13 Mar 2024</span></div> Made with <a href=https://squidfunk.github.io/mkdocs-material/ rel=noopener target=_blank> Material for MkDocs </a></div></div></div></footer></div><div class=md-dialog data-md-component=dialog><div class="md-dialog__inner md-typeset"></div></div><script id=__config type=application/json>{"base": "../../..", "features": ["navigation.tabs", "navigation.expand", "navigation.indexes", "navigation.top", "toc.follow", "search.suggest", "search.highlight", "content.code.copy", "navigation.prune"], "search": "../../../assets/javascripts/workers/search.d50fe291.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script><script src=../../../assets/javascripts/bundle.56ea9cef.min.js></script>